<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="title" content="Duel Shooting Demo" />
    <title>Duel Shooting Demo</title>
    <meta name="keywords" content="javascript,prototype.js,css3,html5,game,offline,duel,shooting,one to one,fighting,demo" />
    <meta name="description" content="Duel Shooting. This is a one to one fighting game. NPC vs NPC demo." />
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">google.load('prototype', '1.7')</script>
    <script type="text/javascript">
var Action=Class.create({hasTouchEvent:null,nextCommand:null,sprite:null,initialize:function(){this.hasTouchEvent=this.checkTouchEvent();this.sprite=new Sprite;this.setEventListener()},checkTouchEvent:function(){return"function"==typeof(new Element("div",{ontouchstart:"return;"})).ontouchstart},setEventListener:function(){this.hasTouchEvent?$(document).observe("touchstart",this.handlerSmart.bindAsEventListener(this)):($(document).observe("keydown",this.handler.bindAsEventListener(this)),$(document).observe("mousedown",
this.handlerMouse.bindAsEventListener(this)))},stop:function(){this.hasTouchEvent?$(document).stopObserving("touchstart"):($(document).stopObserving("keydown"),$(document).stopObserving("mousedown"))},getCommand:function(){var a=this.nextCommand;this.nextCommand=null;return a},handlerMouse:function(a){this.convertToAction(a.pageX,a.pageY)&&a.stop()},handlerSmart:function(a){this.convertToAction(a.touches[0].pageX,a.touches[0].pageY)&&a.stop()}}),AI=Class.create({ship:null,enemy:null,enemyWeapon:null,
height:null,shipTop:null,risksByArea:null,wait:null,stayAreaIndexes:null,seekAreaIndex:null,initialize:function(a,b,c){this.ship=a;this.enemy=b;this.enemyWeapon=c;this.height=a.getClientHeight();this.shipTop=a.getTop();this.wait=0;this.stayAreaIndexes={}},getCommand:function(){if(0<this.wait)return--this.wait,null;this.wait+=Math.floor(100*Math.random())%this.WAIT_MAX;this.updateStayAreaIndexes();this.updateRisksByArea();this.updateSeekAreaIndex();return this.getNextCommand(this.getRecommendedCommand())},
updateStayAreaIndexes:function(){this.stayAreaIndexes.ship=Math.floor((this.ship.getLeft()+45)/90);this.stayAreaIndexes.enemy=Math.floor((this.enemy.getLeft()+45)/90)},updateRisksByArea:function(){this.risksByArea=[0,0,0,0,0,0,0,0];this.enemyWeapon.elms.each(function(a){if(a.instanceOfBullet&&a.instanceOfBullet()){var b=a.getTop();a=a.getLeft();b=Math.floor(this.height-Math.abs(b-this.shipTop));a=Math.floor((a+15)/90);this.risksByArea[7<a?7:a]+=b}}.bind(this))},updateSeekAreaIndex:function(){for(var a=
null,b=null,c=null,d=0,e=this.risksByArea.size();d<e;++d){var f=Math.abs(d-this.stayAreaIndexes.enemy);if(null===c||this.risksByArea[d]<c||this.risksByArea[d]===c&&f<b)a=d,b=f,c=this.risksByArea[d]}this.seekAreaIndex=a},getRecommendedCommand:function(){var a=Math.floor(this.ship.getLeft()/90),b=Math.floor((this.ship.getLeft()+89)/90);return this.seekAreaIndex<this.stayAreaIndexes.ship||this.seekAreaIndex<a||this.seekAreaIndex<b?this.ship.isEnemy?"stepRight":"stepLeft":this.stayAreaIndexes.ship<this.seekAreaIndex||
a<this.seekAreaIndex||b<this.seekAreaIndex?this.ship.isEnemy?"stepLeft":"stepRight":"attack"}}),Command=Class.create({ship:null,weapon:null,initialize:function(a,b){this.ship=a;this.weapon=b},execute:function(a){if(a&&a in this)this[a]()}}),ShipCreater=Class.create({sounds:null,isEnemy:null,ship:null,weapon:null,initialize:function(a,b){this.sounds=a;this.isEnemy=b},createShip:Prototype.emptyFunction,createWeapon:Prototype.emptyFunction,createAction:Prototype.emptyFunction,createAI:Prototype.emptyFunction,
createCommand:Prototype.emptyFunction}),Sprite=Class.create({Z_INDEX_BASE:3E3,clientHeight:null,clientWidth:null,elm:null,initTop:null,initLeft:null,initTransformRotate:null,currentTop:null,currentLeft:null,currentTransformRotate:null,initialize:function(){this.clientHeight=this.getClientHeight();this.clientWidth=this.getClientWidth();this.elm=this.createElement();this.initTop=this.getInitTop();this.initLeft=this.getInitLeft();this.initTransformRotate=this.getInitTransformRotate();this.setupPosition()},
createElement:function(){return new Element("div")},getInitTop:function(){return 0},getInitLeft:function(){return 0},getInitTransformRotate:function(){return 0},setupPosition:function(){this.setPos({top:this.initTop,left:this.initLeft})},resetPosition:function(){this.clientHeight=this.getClientHeight();this.clientWidth=this.getClientWidth();this.setupPosition()},getClientHeight:function(){return 480},getClientWidth:function(){return 720},renderElement:function(){$(document.body).insert(this.elm)},
getTop:function(){return this.currentTop},getLeft:function(){return this.currentLeft},getPos:function(){return{top:this.currentTop,left:this.currentLeft}},getTransformRotate:function(){return this.currentTransformRotate},setTop:function(a){this.elm.setStyle({top:a+"px"});this.currentTop=a},setLeft:function(a){this.elm.setStyle({left:a+"px"});this.currentLeft=a},setPos:function(a){void 0!==a.top&&this.setTop(a.top);void 0!==a.left&&this.setLeft(a.left)},setTransformRotate:function(a){this.elm.setStyle({webkitTransform:"rotate("+
a+"deg)",MozTransform:"rotate("+a+"deg)",msTransform:"rotate("+a+"deg)",transform:"rotate("+a+"deg)"});this.currentTransformRotate=a},setOpacity:function(a){this.elm.setOpacity(a)},remove:function(){this.elm.remove()}}),ActionShipNavy=Class.create(Action,{KEY_A:65,KEY_S:83,KEY_D:68,KEY_F:70,KEY_Z:90,KEY_X:88,KEY_C:67,KEY_V:86,handler:function(a){if(!a.altGraphKey&&!a.altKey&&!a.ctrlKey&&!a.metaKey&&!a.shiftKey)switch(a.keyCode){case Event.KEY_RIGHT:this.nextCommand="stepRight";a.stop();break;case Event.KEY_LEFT:this.nextCommand=
"stepLeft";a.stop();break;case Event.KEY_UP:this.nextCommand="attack";a.stop();break;case this.KEY_A:this.nextCommand="attack1";a.stop();break;case this.KEY_S:this.nextCommand="attack2";a.stop();break;case this.KEY_D:this.nextCommand="attack3";a.stop();break;case this.KEY_F:this.nextCommand="attack4";a.stop();break;case this.KEY_Z:this.nextCommand="attack5";a.stop();break;case this.KEY_X:this.nextCommand="attack6";a.stop();break;case this.KEY_C:this.nextCommand="attack7";a.stop();break;case this.KEY_V:this.nextCommand=
"attack8",a.stop()}},convertToAction:function(a,b){var c=0<b&&b<this.sprite.clientHeight/2,d=this.sprite.clientHeight/2<b&&b<this.sprite.clientHeight,e=0<a&&a<this.sprite.clientWidth/3,f=this.sprite.clientWidth/3<a&&a<2*(this.sprite.clientWidth/3),g=2*(this.sprite.clientWidth/3)<a&&a<this.sprite.clientWidth;return d&&e?(this.nextCommand="stepLeft",!0):d&&f?(this.nextCommand="attack",!0):d&&g?(this.nextCommand="stepRight",!0):c&&e?(this.nextCommand="stepLeft",!0):c&&f?(this.nextCommand="attack",!0):
c&&g?(this.nextCommand="stepRight",!0):!1}}),ActionShipRed=Class.create(Action,{KEY_F:70,KEY_I:73,KEY_N:78,handler:function(a){if(!a.altGraphKey&&!a.altKey&&!a.ctrlKey&&!a.metaKey&&!a.shiftKey)switch(a.keyCode){case Event.KEY_RIGHT:this.nextCommand="stepRight";a.stop();break;case Event.KEY_LEFT:this.nextCommand="stepLeft";a.stop();break;case Event.KEY_UP:this.nextCommand="attack";a.stop();break;case this.KEY_I:this.nextCommand="barrier";a.stop();break;case this.KEY_F:this.nextCommand="funnel";a.stop();
break;case this.KEY_N:this.nextCommand="avoid",a.stop()}},convertToAction:function(a,b){var c=0<b&&b<this.sprite.clientHeight/2,d=this.sprite.clientHeight/2<b&&b<this.sprite.clientHeight,e=0<a&&a<this.sprite.clientWidth/3,f=this.sprite.clientWidth/3<a&&a<2*(this.sprite.clientWidth/3),g=2*(this.sprite.clientWidth/3)<a&&a<this.sprite.clientWidth;return d&&e?(this.nextCommand="stepLeft",!0):d&&f?(this.nextCommand="avoid",!0):d&&g?(this.nextCommand="stepRight",!0):c&&e?(this.nextCommand="funnel",!0):
c&&f?(this.nextCommand="attack",!0):c&&g?(this.nextCommand="barrier",!0):!1}}),ActionShipWhite=Class.create(Action,{KEY_F:70,KEY_M:77,handler:function(a){if(!a.altGraphKey&&!a.altKey&&!a.ctrlKey&&!a.metaKey&&!a.shiftKey)switch(a.keyCode){case Event.KEY_RIGHT:this.nextCommand="stepRight";a.stop();break;case Event.KEY_LEFT:this.nextCommand="stepLeft";a.stop();break;case Event.KEY_UP:this.nextCommand="attack";a.stop();break;case Event.KEY_DOWN:this.nextCommand="wait";a.stop();break;case this.KEY_F:this.nextCommand=
"funnel";a.stop();break;case this.KEY_M:this.nextCommand="megaCannon",a.stop()}},convertToAction:function(a,b){var c=0<b&&b<this.sprite.clientHeight/2,d=this.sprite.clientHeight/2<b&&b<this.sprite.clientHeight,e=0<a&&a<this.sprite.clientWidth/3,f=this.sprite.clientWidth/3<a&&a<2*(this.sprite.clientWidth/3),g=2*(this.sprite.clientWidth/3)<a&&a<this.sprite.clientWidth;return d&&e?(this.nextCommand="stepLeft",!0):d&&f?(this.nextCommand="wait",!0):d&&g?(this.nextCommand="stepRight",!0):c&&e?(this.nextCommand=
"funnel",!0):c&&f?(this.nextCommand="attack",!0):c&&g?(this.nextCommand="megaCannon",!0):!1}}),AIShipNavy=Class.create(AI,{WAIT_MAX:3,getNextCommand:function(a){if("attack"!==a||(2).isTiming())return a;var b;switch(this.stayAreaIndexes.enemy){case 0:b=this.ship.isEnemy?[5,4,3]:[2,3,4];break;case 1:b=this.ship.isEnemy?[4,3,2]:[3,4,5];break;case 2:b=this.ship.isEnemy?[7,3,2]:[0,4,5];break;case 3:b=this.ship.isEnemy?[6,2,1]:[1,5,6];break;case 4:b=this.ship.isEnemy?[6,5,1]:[1,2,6];break;case 5:b=this.ship.isEnemy?
[5,4,0]:[3,4,7];break;case 6:b=this.ship.isEnemy?[5,4,3]:[2,3,4];break;case 7:b=this.ship.isEnemy?[4,3,2]:[3,4,5]}return"attack"+(b[Math.floor(100*Math.random())%3]+1)}}),AIShipRed=Class.create(AI,{WAIT_MAX:7,funnelCount:0,getNextCommand:function(a){this.updateFunnelCount();return 2>this.funnelCount?this.isShipFixedOnArea()?"funnel":"stepLeft":"attack"!==a?this.isAvoidTiming(a)?"avoid":a:this.ship.isIFieldEnable()?"barrier":this.ship.getIFieldInfo().isActive||(13).isTiming()?"funnel":a},updateFunnelCount:function(){var a=
this.ship.getFunnelInfo();this.funnelCount=null!==a.firstLeft&&null!==a.secondLeft?2:null!==a.firstLeft&&null===a.secondLeft?1:0},isShipFixedOnArea:function(){return 0===this.funnelCount&&this.stayAreaIndexes.ship===(this.ship.isEnemy?1:6)||1===this.funnelCount&&this.stayAreaIndexes.ship===(this.ship.isEnemy?6:1)},isAvoidTiming:function(a){return(49).isTiming()&&(!this.ship.isEnemy&&"stepLeft"===a&&3<this.stayAreaIndexes.ship||!this.ship.isEnemy&&"stepRight"===a&&4>this.stayAreaIndexes.ship||this.ship.isEnemy&&
"stepLeft"===a&&4>this.stayAreaIndexes.ship||this.ship.isEnemy&&"stepRight"===a&&3<this.stayAreaIndexes.ship)}}),AIShipWhite=Class.create(AI,{WAIT_MAX:3,getNextCommand:function(a){return"attack"!==a?a:this.ship.isMegaCannonEnabled&&3>Math.abs(this.stayAreaIndexes.enemy-this.stayAreaIndexes.ship)?"megaCannon":this.ship.isNotFunnelEmpty&&this.stayAreaIndexes.ship!==this.stayAreaIndexes.enemy?"funnel":(49).isTiming()&&(13).isTiming()?"wait":a}}),Background=Class.create(Sprite,{createElement:function(){return(new Element("div")).setStyle({display:"block",
position:"fixed",zIndex:this.Z_INDEX_BASE,backgroundColor:"#333333",height:this.clientHeight+"px",width:this.clientWidth+"px",borderRight:"solid 1px #AAAAAA",borderBottom:"solid 1px #AAAAAA"}).setOpacity(0.8)},resetPosition:function($super){$super();this.elm.setStyle({height:this.clientHeight+"px",width:this.clientWidth+"px"})}}),Bullet=Class.create(Sprite,{ship:null,enemy:null,isFall:null,isDelete:null,initialize:function($super,b,c){this.ship=b;this.enemy=c;this.isFall=b.isEnemy;this.isDelete=!1;
$super()},getInitTop:function(){return this.isFall?60:this.clientHeight-90},getInitLeft:function(){return this.ship.getLeft()+30},createElement:function(){var a=this.getColor(),b=(new Element("div")).setStyle({width:"30px",height:"30px",zIndex:this.Z_INDEX_BASE+6,position:"fixed"});return(new Element("div")).setStyle({width:"20px",height:"20px",margin:"5px",backgroundColor:a,borderRadius:"20px",boxShadow:"0px 0px 10px "+a}).wrap(b)},instanceOfBullet:function(){return!0}}),BulletBezier=Class.create(Bullet,
{ATTAINABLE_COUNT:40,pos:null,leftRange:null,topRange:null,count:null,initialize:function($super,b,c,d){$super(b,c);this.pos={ship:{top:b.getTop()+(this.isFall?60:-30),left:b.getLeft()+30},enemy:{top:c.getTop()+(this.isFall?-30:60),left:d}};this.leftRange=-(this.pos.ship.left-this.pos.enemy.left)/this.ATTAINABLE_COUNT;this.topRange=-(this.pos.ship.top-this.pos.enemy.top)/this.ATTAINABLE_COUNT;this.count=0},getColor:function(){return"#FFFF33"},move:function(){++this.count;if(this.enemy.isHit(this,
this.topRange))this.isDelete=!0,this.elm.remove();else{var a=this.pos.ship.left+this.leftRange*this.count;this.setPos({top:this.pos.ship.top+this.topRange*this.count*this.count/this.ATTAINABLE_COUNT,left:a+(this.pos.enemy.left-a)*this.count/this.ATTAINABLE_COUNT})}}}),BulletHoming=Class.create(Bullet,{getColor:function(){return"#FF55FF"},move:function(){var a=this.isFall?5:-5;if(this.enemy.isHit(this,a))this.isDelete=!0,this.elm.remove();else{var b=this.getTop(),c=this.getLeft(),d=this.enemy.getLeft();
(this.isFall?this.clientHeight/2<b:this.clientHeight/2>b)?(a*=3,distance=0):distance=c<d?10:d+60<c?-10:0;this.setPos({top:b+a,left:c+distance})}}}),BulletLinear=Class.create(Bullet,{getColor:function(){return"#55FF55"},move:function(){var a=this.isFall?10:-10;this.enemy.isHit(this,a)?(this.isDelete=!0,this.elm.remove()):this.setTop(this.getTop()+a)}}),Chat=Class.create({elms:null,initialize:function(){this.elms=[]},add:function(a){a=new NicoNico(a);a.renderElement();this.elms.push(a)},move:function(){for(var a=
0,b=this.elms.size();a<b;a++)this.elms[a].move(),this.elms[a].isDelete&&(this.elms[a]=null);this.elms=this.elms.compact()}}),ChatForm=Class.create(Sprite,{textField:null,createElement:function(){var a=(new Element("form",{action:"#",method:"post"})).setStyle({zIndex:this.Z_INDEX_BASE+2E3,position:"fixed",backgroundColor:"#EFEFEF"});this.textField=(new Element("input",{type:"text",value:""})).setStyle({width:"400px"});var b=new Element("input",{type:"submit",value:"send"});a.insert(this.textField).insert(b);
return a},getInitTop:function(){return this.clientHeight+10},getInitLeft:function(){return 270},getValue:function(){return $F(this.textField)}}),CommandShipNavy=Class.create(Command,{stepRight:function(){this.ship.stepRight()},stepLeft:function(){this.ship.stepLeft()},attack:function(){this.weapon.addBulletBezierAuto()},attack1:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?660:30)},attack2:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?570:120)},attack3:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?
480:210)},attack4:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?390:300)},attack5:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?300:390)},attack6:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?210:480)},attack7:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?120:570)},attack8:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?30:660)}}),CommandShipRed=Class.create(Command,{stepRight:function(){this.ship.stepRight()},stepLeft:function(){this.ship.stepLeft()},
avoid:function(){this.ship.avoid()},barrier:function(){this.ship.barrier()},attack:function(){(!this.ship.iField||!this.ship.iField.isActive)&&this.weapon.addBulletHoming()},funnel:function(){this.weapon.addFunnelCircle()}}),CommandShipWhite=Class.create(Command,{stepRight:function(){this.ship.stepRight()},stepLeft:function(){this.ship.stepLeft()},wait:Prototype.emptyFunction,attack:function(){this.weapon.addBulletLinear()},funnel:function(){this.weapon.addFunnelSlider()},megaCannon:function(){this.weapon.fireMegaCannon()}}),
Condition=Class.create(Sprite,{timerId:null,createElement:function(){return(new Element("div")).setStyle({display:"none",position:"fixed",zIndex:this.Z_INDEX_BASE+101,fontSize:"20px",fontWeight:800,top:"0px",left:"0px"})},setupPosition:function(){var a=this.elm.getDimensions();this.elm.setStyle({display:"block",top:this.clientHeight/2-(a.height/2-0)+100+"px",left:this.clientWidth/2-(a.width/2-0)+"px"})},update:function(a,b){this.timerId&&clearTimeout(this.timerId);this.elm.update(a);this.elm.setStyle({color:b});
this.setupPosition();this.elm.show()},updateAndDelayHide:function(a,b){this.update(a,b);this.timerId=this.elm.hide.bind(this.elm).delay(7)}}),DuelistCounter=Class.create(Sprite,{createElement:function(){return(new Element("div")).setStyle({position:"fixed",zIndex:this.Z_INDEX_BASE,fontSize:"20px",fontWeight:800})},getInitTop:function(){return this.clientHeight+10},getInitLeft:function(){return 10},update:function(a){this.elm.update(a);this.remove();this.renderElement()}}),DuelShootingDemo=Class.create({opening:null,
colors:null,sounds:null,factories:null,ships:null,weapons:null,actions:null,ais:null,cmds:null,background:null,timekeeper:null,condition:null,game:null,initialize:function(){this.opening=new Opening(new Title);this.opening.show();Number.prototype.isTiming=function(a){return 0===Math.floor(100*Math.random())%a}.methodize();this.setupColor();this.setupSound();this.setupFactories();this.setupShips();this.setupWeapons();this.setupActions();this.setupAIs();this.setupCommands();this.background=new Background;
this.timekeeper=new TimeKeeper;this.condition=new Condition;this.game=new Game(this.routine.bind(this));this.renderElements();(function(){this.opening.hide();this.start()}).bind(this).delay(3)},setupColor:function(){this.colors={a:["white","red","navy"][Math.floor(100*Math.random())%3],b:["white","red","navy"][Math.floor(100*Math.random())%3]}},setupSound:function(){new Sound;this.sounds={}},setupFactories:function(){this.factories={};this.factories.a=ShipFactory.getCreater(this.colors.a,!1,this.sounds);
this.factories.b=ShipFactory.getCreater(this.colors.b,!0,this.sounds)},setupShips:function(){this.ships={};this.ships.a=this.factories.a.createShip();this.ships.b=this.factories.b.createShip()},setupWeapons:function(){this.weapons={};this.weapons.a=this.factories.a.createWeapon(this.ships.b);this.weapons.b=this.factories.b.createWeapon(this.ships.a)},setupActions:function(){this.actions={};this.actions.a=null;this.actions.b=null},setupAIs:function(){this.ais={};this.ais.a=this.factories.a.createAI(this.ships.b,
this.weapons.b);this.ais.b=this.factories.b.createAI(this.ships.a,this.weapons.a)},setupCommands:function(){this.cmds={};this.cmds.a=this.factories.a.createCommand();this.cmds.b=this.factories.b.createCommand()},routine:function(){this.ships.a.move();this.ships.b.move();this.weapons.a.move();this.weapons.b.move();this.ships.b.getHitPoint()||(this.condition.update("You win.","#9999FF"),(new ForkMeOnGitHub).renderElement(),this.stop());this.ships.a.getHitPoint()||(this.condition.update("You lose.",
"#FF9999"),(new ForkMeOnGitHub).renderElement(),this.stop());var a=this.ais.a.getCommand(),b=this.ais.b.getCommand();this.ships.a.nextCmd=a;this.ships.b.nextCmd=b;this.cmds.a.execute(a);this.cmds.b.execute(b)},renderElements:function(){this.background.renderElement();this.timekeeper.renderElement();this.condition.renderElement();this.ships.a.renderElement();this.ships.b.renderElement()},start:function(){this.game.start();this.timekeeper.start()},stop:function(){this.timekeeper.stop();this.game.stop()}}),
DuelShootingOffline=Class.create(DuelShootingDemo,{setupSound:function(){var a=new Sound;this.sounds={};this.sounds.hit=a.createAudio("/se/hit.mp3");this.sounds.lose=a.createAudio("/se/lose.mp3");this.sounds.newtype=a.createAudio("/se/newtype.mp3");this.sounds.attack=a.createAudio("/se/attack.mp3");this.sounds.megaCannon=a.createAudio("/se/mega.mp3");this.sounds.funnelGo=a.createAudio("/se/funnel1.mp3");this.sounds.funnelAtk=a.createAudio("/se/funnel2.mp3");this.sounds.iField=a.createAudio("/se/at_field.mp3")},
setupActions:function(){this.actions={};this.actions.a=this.factories.a.createAction();this.actions.b=null},setupAIs:function(){this.ais={};this.ais.a=null;this.ais.b=this.factories.b.createAI(this.ships.a,this.weapons.a)},routine:function(){this.ships.a.move();this.ships.b.move();this.weapons.a.move();this.weapons.b.move();this.ships.b.getHitPoint()||(this.condition.update("You win.","#9999FF"),(new ForkMeOnGitHub).renderElement(),this.stop());this.ships.a.getHitPoint()||(this.condition.update("You lose.",
"#FF9999"),this.stop());var a=this.actions.a.getCommand(),b=this.ais.b.getCommand();this.ships.a.nextCmd=a;this.ships.b.nextCmd=b;this.cmds.a.execute(a);this.cmds.b.execute(b)},stop:function(){this.actions.a.stop();this.timekeeper.stop();this.game.stop()}}),DuelShootingOnline=Class.create({sounds:null,weapons:null,cmds:null,opening:null,condition:null,sync:null,timeKeeper:null,ship:null,enemy:null,action:null,game:null,initialize:function(){this.weapons={};this.cmds={};this.opening=new Opening(new Title);
this.condition=new Condition;this.opening.show();this.condition.renderElement();this.condition.update("Please wait for player matching.","#99FF99");this.setupSoundEffect();this.sync=new Synchronizer("/",this.callback.bind(this),this.finish.bind(this))},callback:function(a){var b,c;b=ShipFactory.getCreater(a.ship,!1,this.sounds);c=ShipFactory.getCreater(a.enemy,!0,this.sounds);this.ship=b.createShip();this.enemy=c.createShip();this.weapons.ship=b.createWeapon(this.enemy);this.weapons.enemy=c.createWeapon(this.ship);
this.action=b.createAction();this.cmds.ship=b.createCommand();this.cmds.enemy=c.createCommand();this.sync.setShipAndCommand(a.ship,this.ship,this.cmds.ship);this.sync.setShipAndCommand(a.enemy,this.enemy,this.cmds.enemy);this.sync.listenShipCommand();this.setShipRedWeaponForSync(a);this.setupTimeKeeper();this.setupGame();this.renderElements();this.game.start();this.timeKeeper.start();this.condition.updateAndDelayHide("Engaged!","#FF9999");this.opening.hide()},setupSoundEffect:function(){var a=new Sound;
this.sounds={};this.sounds.hit=a.createAudio("/se/hit.mp3");this.sounds.lose=a.createAudio("/se/lose.mp3");this.sounds.newtype=a.createAudio("/se/newtype.mp3");this.sounds.attack=a.createAudio("/se/attack.mp3");this.sounds.megaCannon=a.createAudio("/se/mega.mp3");this.sounds.funnelGo=a.createAudio("/se/funnel1.mp3");this.sounds.funnelAtk=a.createAudio("/se/funnel2.mp3");this.sounds.iField=a.createAudio("/se/at_field.mp3")},setShipRedWeaponForSync:function(a){var b;"red"==a.ship&&(b="ship");"red"==
a.enemy&&(b="enemy");b&&this.sync.setShipRedWeapon(this.weapons[b])},setupTimeKeeper:function(){this.timeKeeper=new TimeKeeper},setupGame:function(){this.game=new Game(this.routine.bind(this))},routine:function(){this.sync.chat.move();this.ship.move();this.enemy.move();this.weapons.ship.move();this.weapons.enemy.move();this.action&&(0===this.ship.getHitPoint()?this.finish(!1):this.pushCommand(this.action.getCommand()))},finish:function(a){this.action.stop();this.timeKeeper.stop();this.game.stop();
this.sync.stop();this.condition.update(a?"You win.":"You lose.",a?"#9999FF":"#FF9999");a&&(new ForkMeOnGitHub).renderElement()},pushCommand:function(a){this.sync.pushAttackInfo(a)},renderElements:function(){(new Background).renderElement();this.timeKeeper.renderElement();this.ship.renderElement();this.enemy.renderElement()}}),ForkMeOnGitHub=Class.create(Sprite,{createElement:function(){return(new Element("img",{src:"https://s3.amazonaws.com/github/ribbons/forkme_left_white_ffffff.png",alt:"Fork me on GitHub"})).setStyle({border:"none"}).wrap(new Element("a",
{href:"https://github.com/supercaracal/duelshooting_online"})).setStyle({position:"fixed",zIndex:this.Z_INDEX_BASE+4E3})},getInitTop:function(){return 0},getInitLeft:function(){return 0}}),Funnel=Class.create(Sprite,{carrier:null,isEnemy:null,isDelete:null,initialize:function($super,b){this.carrier=b;this.isEnemy=b.isEnemy;this.isDelete=!1;$super()},createElement:function(){var a=this.getColor();return this.isEnemy?this.createForEnemy(a):this.createForShip(a)},createForShip:function(a){var b=(new Element("div")).setStyle({width:"30px",
height:"30px",zIndex:this.Z_INDEX_BASE+4,position:"fixed"});b.insert((new Element("div")).setStyle({width:"6px",height:"20px",marginLeft:"12px",backgroundColor:a,borderRadius:"2px",boxShadow:"0px 0px 10px "+a}));b.insert((new Element("div")).setStyle({width:"20px",height:"10px",margin:"0px 5px 0px 5px",backgroundColor:a,borderRadius:"20px",boxShadow:"0px 0px 10px "+a}));return b},createForEnemy:function(a){var b=(new Element("div")).setStyle({width:"30px",height:"30px",zIndex:this.Z_INDEX_BASE+4,
position:"fixed"});b.insert((new Element("div")).setStyle({width:"20px",height:"10px",margin:"0px 5px 0px 5px",backgroundColor:a,borderRadius:"20px",boxShadow:"0px 0px 10px "+a}));b.insert((new Element("div")).setStyle({width:"6px",height:"20px",marginLeft:"12px",backgroundColor:a,borderRadius:"2px",boxShadow:"0px 0px 10px "+a}));return b}}),FunnelCircle=Class.create(Funnel,{r:null,theta:null,speed:null,isClockwise:null,initialize:function($super,b){$super(b);this.r=70;this.theta=this.isEnemy?0:180;
this.speed=3;this.isCloclwise=this.isEnemy},getInitTop:function(){return this.carrier.getTop()+(this.isEnemy?60:-30)},getInitLeft:function(){return this.carrier.getLeft()+30},getColor:function(){return"#FF9900"},move:function(){var a=this.initLeft+Math.sin(Math.PI/180*this.theta)*this.r,b=this.initTop+(this.isEnemy?0:-140)+this.r-Math.cos(Math.PI/180*this.theta)*this.r;this.setPos({top:b,left:a});this.theta+=this.isClockwise?this.speed:-this.speed;if(0>this.theta||360<this.theta)this.theta=this.isClockwise?
0:360}}),FunnelDefenceLeft=Class.create(Funnel,{iField:null,initialize:function($super,b,c){this.iField=c;$super(b);this.setTransformRotate(this.getInitTransformRotate())},getInitTop:function(){return this.carrier.getTop()+(this.isEnemy?60:-30)},getInitLeft:function(){return this.carrier.getLeft()-40},getInitTransformRotate:function(){return 135},getColor:function(){return"#FF9900"},move:function(){if(this.iField.isActive)this.setTransformRotate(this.isEnemy?270:90);else{var a=this.getTransformRotate(),
a=360<a?0:a;this.setTransformRotate(++a)}this.setPos({top:this.getInitTop(),left:this.getInitLeft()})}}),FunnelDefenceRight=Class.create(Funnel,{iField:null,initialize:function($super,b,c){this.iField=c;$super(b);this.setTransformRotate(this.getInitTransformRotate())},getInitTop:function(){return this.carrier.getTop()+(this.isEnemy?60:-30)},getInitLeft:function(){return this.carrier.getLeft()+100},getInitTransformRotate:function(){return 225},getColor:function(){return"#FF9900"},move:function(){if(this.iField.isActive)this.setTransformRotate(this.isEnemy?
90:270);else{var a=this.getTransformRotate(),a=0>a?360:a;this.setTransformRotate(--a)}this.setPos({top:this.getInitTop(),left:this.getInitLeft()})}}),FunnelSlider=Class.create(Funnel,{target:null,isComeback:null,isFunnelSliderAttack:null,isFunnelSlider:null,initialize:function($super,b,c){this.isFunnelSliderAttack=this.isComeback=!1;this.isFunnelSlider=!0;this.target=c;$super(b)},getInitTop:function(){return this.carrier.getTop()+(this.isEnemy?60:-30)},getInitLeft:function(){return this.carrier.getLeft()+
30},getColor:function(){return"#9999FF"},move:function(){this.isComeback?this.moveComeback():this.moveChase()},moveComeback:function(){var a=this.carrier.getLeft()+30,b=this.getLeft();30>Math.abs(a-b)?(this.isDelete=!0,this.elm.remove()):this.setLeft(b+(0<a-b?10:-10))},moveChase:function(){var a=this.target.getLeft()+30,b=this.getLeft();30>Math.abs(a-b)?this.isFunnelSliderAttack=this.isComeback=!0:this.setLeft(b+(0<a-b?10:-10))}}),Game=Class.create({INTERVAL_WAIT_MSEC:16,timerId:null,routine:null,
initialize:function(a){this.routine=a},start:function(){null===this.timerId&&(this.timerId=setInterval(this.routine,this.INTERVAL_WAIT_MSEC))},pause:function(){null===this.timerId?this.start():this.stop()},stop:function(){clearInterval(this.timerId);this.timerId=null}}),IField=Class.create(Sprite,{WAIT:250,isActive:null,carrier:null,isEnemy:null,waitCount:null,sound:null,waitStatus:null,initialize:function($super,b){this.isActive=!1;this.carrier=b;this.isEnemy=b.isEnemy;this.waitCount=0;$super();
this.carrier.setIField(this)},createElement:function(){return(new Element("div")).setStyle({width:"100px",height:"20px",backgroundColor:"#FFFFFF",zIndex:this.Z_INDEX_BASE+11,position:"fixed",boxShadow:"0px 0px 10px #FFFFFF",borderRadius:"10px",display:"none"}).setOpacity(0.5)},getInitTop:function(){return this.carrier.getTop()+(this.isEnemy?65:-25)},getInitLeft:function(){return this.carrier.getLeft()-5},getHeight:function(){return this.elm.getHeight()},setHeight:function(a){this.elm.setStyle({height:a+
"px"});this.setTop(this.getInitTop()+(20-a)/2)},setSound:function(a){this.sound=a},setWaitStatus:function(a){this.waitStatus=a},playSound:function(){this.sound&&this.sound.replay()},hit:function(){h=this.getHeight();h-=2;this.setHeight(h);0>=h&&(this.cancel(),this.waitCount=this.WAIT)},isHit:function(a,b,c){var d=a.getTop(),e=a.getLeft();if(this.isActive&&(a.isFall?d+b>this.clientHeight-110:80>d+b)&&c-25<e&&e<c+95)return this.hit(),!0},barrier:function(){0<this.waitCount||this.isActive||(this.setHeight(20),
this.invoke(),this.playSound())},invoke:function(){this.isActive=!0;this.elm.show()},cancel:function(){this.isActive=!1;this.elm.hide()},move:function(){this.setLeft(this.carrier.getLeft()-5);this.isActive&&this.changeColor();0<this.waitCount&&--this.waitCount;this.waitStatus.setWidth(this.waitCount,this.WAIT)},changeColor:function(){var a="#"+Math.floor(100*Math.random()).toColorPart()+Math.floor(100*Math.random()).toColorPart()+Math.floor(100*Math.random()).toColorPart();this.elm.setStyle({backgroundColor:a})}}),
NicoNico=Class.create(Sprite,{text:null,dim:null,seed:null,initialize:function($super,b){this.text=b;this.seed=this.getSeed();$super()},createElement:function(){return(new Element("span")).setStyle({color:this.getColor(),fontSize:this.getSeed()+8+"px",fontWeight:"bolder",zIndex:this.Z_INDEX_BASE+1E3+this.getSeed()+1,position:"fixed",whiteSpace:"nowrap"}).update(this.text)},getInitTop:function(){return Math.floor(this.clientHeight*(this.getSeed()/100))},getInitLeft:function(){return document.viewport.getWidth()||
document.documentElement.clientWidth||document.body.clientWidth||document.body.scrollWidth||this.clientWidth},renderElement:function($super){$super();this.dim=this.elm.getDimensions();this.clientHeight<this.getTop()+this.dim.height&&this.setTop(this.clientHeight-this.dim.height)},move:function(){var a=this.getLeft();a<-this.dim.width?(this.isDelete=!0,this.remove()):(a-=this.seed%10+5,this.setLeft(a))},getSeed:function(){return Math.floor(100*Math.random())},getColor:function(){var a=null,a=this.getSeed()%
6,b=this.getSeed()%16,c={"0":"0F",1:"1F",2:"2F",3:"3F",4:"4F",5:"5F",6:"6F",7:"7F",8:"8F",9:"9F",10:"AF",11:"BF",12:"CF",13:"DF",14:"EF",15:"FF"};switch(a){case 0:a="#"+c[b]+"FFFF";break;case 1:a="#FF"+c[b]+"FF";break;case 2:a="#FFFF"+c[b];break;case 3:a="#"+c[b]+c[b]+"FF";break;case 4:a="#"+c[b]+"FF"+c[b];break;case 5:a="#FF"+c[b]+c[b];break;default:a="#FFFFFF"}return a}}),Opening=Class.create(Sprite,{timerId:null,title:null,titleOpacity:0,backgroundOpacity:1,initialize:function($super,b){this.title=
b;$super()},createElement:function(){return(new Element("div")).setStyle({display:"block",position:"fixed",zIndex:this.Z_INDEX_BASE+100,backgroundColor:"#111111",height:this.clientHeight+"px",width:this.clientWidth+"px"}).setOpacity(this.backgroundOpacity)},show:function(){this.title.renderElement();this.renderElement();this.timerId=setInterval(this.appear.bind(this),128)},appear:function(){1<=this.titleOpacity&&clearInterval(this.timerId);this.titleOpacity+=0.1;this.title.setOpacity(this.titleOpacity)},
hide:function(){clearInterval(this.timerId);this.title.remove();this.timerId=setInterval(this.fade.bind(this),32)},fade:function(){0>=this.backgroundOpacity&&(clearInterval(this.timerId),this.elm.remove());this.backgroundOpacity-=0.1;this.elm.setOpacity(this.backgroundOpacity)}}),Ship=Class.create(Sprite,{hitPoint:null,soundHit:null,soundLose:null,isEnemy:null,way:null,nextCmd:null,initialize:function($super,b){this.isEnemy=b;this.hitPoint=100;$super();this.setHitPoint(this.hitPoint)},createElement:function(){var a=
this.getColor();return this.isEnemy?this.createEnemy(a):this.createShip(a)},createEnemy:function(a){var b=(new Element("div")).setStyle({width:"90px",height:"60px",zIndex:this.Z_INDEX_BASE+10,position:"fixed",top:"0px",left:"0px"});b.insert((new Element("div")).setStyle({width:"90px",height:"30px",backgroundColor:a,borderRadius:"6px",boxShadow:"0px 0px 30px "+a,textAlign:"center",fontWeight:800,fontSize:"20px"}).update(this.hitPoint));b.insert((new Element("div")).setStyle({width:"30px",height:"30px",
backgroundColor:a,borderRadius:"6px",boxShadow:"0px 0px 30px "+a,marginLeft:"30px"}));return b},createShip:function(a){var b=(new Element("div")).setStyle({width:"90px",height:"60px",zIndex:this.Z_INDEX_BASE+10,position:"fixed",top:this.clientHeight-60+"px",left:this.clientWidth-90+"px"});b.insert((new Element("div")).setStyle({width:"30px",height:"30px",backgroundColor:a,borderRadius:"6px",boxShadow:"0px 0px 10px "+a,marginLeft:"30px"}));b.insert((new Element("div")).setStyle({width:"90px",height:"30px",
backgroundColor:a,borderRadius:"6px",boxShadow:"0px 0px 10px "+a,textAlign:"center",fontWeight:800,fontSize:"20px"}).update(this.hitPoint));return b},getInitTop:function(){return this.isEnemy?0:this.clientHeight-60},getInitLeft:function(){return this.isEnemy?0:this.clientWidth-90},setSoundHit:function(a){this.soundHit=a},setSoundLose:function(a){this.soundLose=a},playSoundHit:function(){this.soundHit&&this.soundHit.replay()},playSoundLose:function(){this.soundLose&&this.soundLose.replay()},hit:function(){1>
this.hitPoint||(this.setHitPoint(--this.hitPoint),0===this.hitPoint?this.playSoundLose():this.playSoundHit())},isHit:function(a,b){var c=this.getLeft(),d=this.getIField?this.getIField():null,e=a.getTop(),f=a.getLeft();return d&&d.isHit(a,b,c)?!0:c-25<f&&f<=c+5&&(a.isFall?e+b>this.clientHeight-60:30>e+b)||c+5<f&&f<c+60&&(a.isFall?e+b>this.clientHeight-90:60>e+b)||c+60<=f&&f<c+90&&(a.isFall?e+b>this.clientHeight-60:30>e+b)?(this.hit(),!0):0>e+b||this.clientHeight<e+b?!0:!1},setHitPoint:function(a){this.hitPoint=
a;this.elm.down(this.isEnemy?0:1).update(a)},getHitPoint:function(){return this.hitPoint},stepRight:function(){this.way=this.isEnemy?"left":"right"},stepLeft:function(){this.way=this.isEnemy?"right":"left"},moveRight:function(){this.currentLeft+10<=this.clientWidth-90&&this.setLeft(this.currentLeft+10)},moveLeft:function(){0<=this.currentLeft-10&&this.setLeft(this.currentLeft-10)},move:function(){null!==this.nextCmd&&("stepRight"!==this.nextCmd&&"stepLeft"!==this.nextCmd)&&(this.way=null);"right"===
this.way&&this.moveRight();"left"===this.way&&this.moveLeft()}}),ShipAfterimage=Class.create(Ship,{getColor:function(){return"#FF5555"},spot:function(a,b,c){this.elm.setOpacity(0.2);this.setPos({top:a,left:b});this.setHitPoint(c);this.renderElement();(function(){this.elm.remove()}).bind(this).delay(0.3)}}),ShipCreaterNavy=Class.create(ShipCreater,{createShip:function(){this.ship=new ShipNavy(this.isEnemy);this.isEnemy||(this.ship.setSoundHit(this.sounds.hit),this.ship.setSoundLose(this.sounds.lose));
return this.ship},createWeapon:function(a){this.weapon=new Weapon(this.ship,a);if(this.isEnemy)return this.weapon;this.weapon.setSoundAttack(this.sounds.attack);return this.weapon},createAction:function(){return new ActionShipNavy},createAI:function(a,b){return new AIShipNavy(this.ship,a,b)},createCommand:function(){return new CommandShipNavy(this.ship,this.weapon)}}),ShipCreaterRed=Class.create(ShipCreater,{createShip:function(){this.ship=new ShipRed(this.isEnemy);this.isEnemy||(this.ship.setSoundHit(this.sounds.hit),
this.ship.setSoundLose(this.sounds.lose),this.ship.setSoundNewtype(this.sounds.newtype));return this.ship},createWeapon:function(a){this.weapon=new Weapon(this.ship,a);this.isEnemy?this.weapon.addIField():this.weapon.addIField(this.sounds.iField);this.weapon.addFunnelDefences();if(this.isEnemy)return this.weapon;this.weapon.setSoundAttack(this.sounds.attack);this.weapon.setSoundFunnelGo(this.sounds.funnelGo);this.weapon.setSoundFunnelAttack(this.sounds.funnelAtk);return this.weapon},createAction:function(){return new ActionShipRed},
createAI:function(a,b){return new AIShipRed(this.ship,a,b)},createCommand:function(){return new CommandShipRed(this.ship,this.weapon)}}),ShipCreaterWhite=Class.create(ShipCreater,{createShip:function(){this.ship=new ShipWhite(this.isEnemy);this.isEnemy||(this.ship.setSoundHit(this.sounds.hit),this.ship.setSoundLose(this.sounds.lose));return this.ship},createWeapon:function(a){this.weapon=new Weapon(this.ship,a);this.weapon.addWeaponWaitStatusMegaCannon();if(this.isEnemy)return this.weapon;this.weapon.setSoundAttack(this.sounds.attack);
this.weapon.setSoundMegaCannon(this.sounds.megaCannon);this.weapon.setSoundFunnelGo(this.sounds.funnelGo);this.weapon.setSoundFunnelAttack(this.sounds.funnelAtk);return this.weapon},createAction:function(){return new ActionShipWhite},createAI:function(a,b){return new AIShipWhite(this.ship,a,b)},createCommand:function(){return new CommandShipWhite(this.ship,this.weapon)}}),ShipFactory={getCreater:function(a,b,c){return new (window["ShipCreater"+a.capitalize()])(c,b)}},ShipNavy=Class.create(Ship,{shadowSize:20,
colors:"FF0000 FF6600 FFFF00 00FF00 00FFFF 0000FF 990099".split(" "),getColor:function(){return"#0F0F3F"},createElement:function($super){return $super().setStyle({color:"#FFFFFF"})},move:function($super){$super();++this.shadowSize;var b="#"+this.colors[0];this.elm.down().setStyle({boxShadow:"0px 0px "+this.shadowSize+"px "+b});this.elm.down(1).setStyle({boxShadow:"0px 0px "+this.shadowSize+"px "+b});50<this.shadowSize&&(this.shadowSize=20,this.colors.push(this.colors.shift()))}}),ShipRed=Class.create(Ship,
{soundNewtype:null,iField:null,funnels:null,initialize:function($super,b){$super(b);this.funnels=[]},getColor:function(){return"#FF5555"},setSoundNewtype:function(a){this.soundNewtype=a},playSoundNewtype:function(){this.soundNewtype&&this.soundNewtype.replay()},setIField:function(a){this.iField=a},getIField:function(){return this.iField},getIFieldInfo:function(){return{isActive:this.iField.isActive,height:this.iField.getHeight()}},getFunnelInfo:function(){return{firstLeft:this.funnels[0]?this.funnels[0].initLeft:
null,firstTheta:this.funnels[0]?this.funnels[0].theta:null,secondLeft:this.funnels[1]?this.funnels[1].initLeft:null,secondTheta:this.funnels[1]?this.funnels[1].theta:null}},addFunnel:function(a){this.funnels.push(a)},isIFieldEnable:function(){return!this.iField.isActive&&!this.iField.waitCount},barrier:function(){this.iField.barrier()},avoid:function(){var a=this.getLeft()+45<this.clientWidth/2?1:-1,b=this.getTop(),c=this.getLeft();this.setLeft(c+90*a);[c,c+30*a,c+60*a].each(function(a){(new ShipAfterimage(this.isEnemy)).spot(b,
a,this.hitPoint)}.bind(this));this.playSoundNewtype()}}),ShipWhite=Class.create(Ship,{isMegaCannonEnabled:!0,isNotFunnelEmpty:!0,getColor:function(){return"#FFFFFF"},enableMegaCannonStatus:function(){this.isMegaCannonEnabled=!0},disableMegaCannonStatus:function(){this.isMegaCannonEnabled=!1},enableFunnelStatus:function(){this.isNotFunnelEmpty=!0},disableFunnelStatus:function(){this.isNotFunnelEmpty=!1}}),Sound=Class.create({hasAudioElement:null,initialize:function(){this.hasAudioElement=this.checkAudio();
this.addAudioMethods()},checkAudio:function(){return"function"==typeof Audio&&"HTMLAudioElement"==Audio.name&&"function"==typeof Audio.prototype.canPlayType&&"maybe"==(new Audio).canPlayType("audio/mpeg")},addAudioMethods:function(){this.hasAudioElement&&Element.addMethods("audio",{stop:function(a){a.pause();try{a.currentTime=0}catch(b){console&&console.log(b)}},replay:function(a){a.pause();try{a.currentTime=0}catch(b){console&&console.log(b)}a.play()}})},createAudio:function(a){return this.hasAudioElement?
(a=new Element("audio",{src:a}),Prototype.Browser.MobileSafari&&a.load(),a):null}}),Synchronizer=Class.create({socket:null,controlShip:null,ships:null,cmds:null,weapons:null,chat:null,duelistCounter:null,chatForm:null,initialize:function(a,b,c){this.ships={};this.cmds={};this.weapons={};this.chat=new Chat;this.duelistCounter=new DuelistCounter;this.duelistCounter.renderElement();this.chatForm=new ChatForm;this.chatForm.renderElement();this.socket=io.connect(a);this.setupChatEvent();this.listenShipControl();
this.listenDuelReady(b);this.listenYouWin(c);this.listenDuelistCount();this.socket.emit("duty",{})},setupChatEvent:function(){this.chatForm.elm.observe("submit",function(a){a.stop();(a=this.chatForm.getValue())&&this.socket.emit("chat",a)}.bindAsEventListener(this));this.socket.on("chat",function(a){this.chat.add(a)}.bind(this))},listenShipControl:function(){this.socket.on("You have control",this.youHaveControl.bind(this));this.socket.on("You have no control",this.youHaveNoControl.bind(this))},listenDuelReady:function(a){this.socket.on("ready",
a)},listenYouWin:function(a){this.socket.on("You win",a)},listenDuelistCount:function(){this.socket.on("duelist count",this.updateDuelistCount.bind(this))},listenShipCommand:function(){this.socket.on("attack",this.attack.bind(this))},youHaveControl:function(a){this.controlShip=a.ship;this.socket.emit("I have control",{ship:this.controlShip});"undefined"!==typeof console&&console.log("I have control: "+this.controlShip)},youHaveNoControl:function(){(function(){this.socket.emit("duty",{})}).bind(this).delay(5)},
updateDuelistCount:function(a){this.duelistCounter.update("Duelists: "+a)},attack:function(a){this.cmds[a.color]&&(a.color!=this.controlShip&&this.critical(a),this.ships[a.color].nextCmd=a.cmd,this.cmds[a.color].execute(a.cmd))},critical:function(a){var b="critical"+a.color.capitalize();this[b in this?b:"criticalDefault"](a)},criticalDefault:function(a){this.ships[a.color]&&(this.ships[a.color].setHitPoint(a.hp),"stepRight"!==this.ships[a.color].nextCmd&&"stepLeft"!==this.ships[a.color].nextCmd&&
this.ships[a.color].setLeft(this.ships[a.color].clientWidth-a.left-90))},criticalRed:function(a){if(this.ships.red&&(this.ships.red.setHitPoint(a.hp),"stepRight"!==this.ships.red.nextCmd&&"stepLeft"!==this.ships.red.nextCmd&&this.ships.red.setLeft(this.ships.red.clientWidth-a.left-90),a.iField.isActive?(this.ships.red.iField.setHeight(a.iField.height),this.ships.red.iField.invoke()):this.ships.red.iField.cancel(),this.weapons.red)){null===a.funnel.firstLeft&&null===a.funnel.secondLeft&&this.weapons.red.removeFunnelCircle(2);
null!==a.funnel.firstLeft&&(null===a.funnel.secondLeft&&2===this.weapons.red.funnelCircles.size())&&this.weapons.red.removeFunnelCircle(1);var b;null!==a.funnel.firstLeft&&(0===this.weapons.red.funnelCircles.size()&&this.weapons.red.addFunnelCircle(),b=this.ships.red.clientWidth-a.funnel.firstLeft-30,b!==this.ships.red.funnels[0].initLeft&&(this.ships.red.funnels[0].initLeft=b),this.ships.red.funnels[0].theta=a.funnel.firstTheta);null!==a.funnel.secondLeft&&(1===this.weapons.red.funnelCircles.size()&&
this.weapons.red.addFunnelCircle(),b=this.ships.red.clientWidth-a.funnel.secondLeft-30,b!==this.ships.red.funnels[1].initLeft&&(this.ships.red.funnels[1].initLeft=b),this.ships.red.funnels[1].theta=a.funnel.secondTheta)}},pushAttackInfo:function(a){a&&(a={color:this.controlShip,cmd:a,hp:this.ships[this.controlShip].getHitPoint(),left:this.ships[this.controlShip].getLeft()},"red"==this.controlShip&&(a.iField=this.ships.red.getIFieldInfo(),a.funnel=this.ships.red.getFunnelInfo()),this.socket.emit("attack",
a))},setShipAndCommand:function(a,b,c){this.ships[a]=b;this.cmds[a]=c},setShipRedWeapon:function(a){this.weapons.red=a},stop:function(){this.socket.disconnect();this.chatForm.elm.disable();this.chatForm.elm.stopObserving("submit")}}),TimeKeeper=Class.create(Sprite,{timerId:null,time:null,initialize:function($super){this.time=0;$super()},createElement:function(){return(new Element("div")).setStyle({zIndex:this.Z_INDEX_BASE+20,position:"fixed",height:"30px",width:"100px",fontSize:"20px",fontWeight:800,
color:"#FFFFFF",textAlign:"right"}).update(this.time)},getInitTop:function(){return 2},getInitLeft:function(){return this.clientWidth-110},increment:function(){this.elm.update(++this.time)},start:function(){null===this.timerId&&(this.timerId=setInterval(this.increment.bind(this),1E3))},stop:function(){clearInterval(this.timerId);this.timerId=null}}),Title=Class.create(Sprite,{TITLE_TEXT:"Duel Shooting",createElement:function(){return(new Element("div")).setStyle({display:"none",position:"fixed",zIndex:this.Z_INDEX_BASE+
101,fontSize:"36px",color:"#FFFFFF",top:"0px",left:"0px"}).update(this.TITLE_TEXT).setOpacity(0)},setupPosition:function(){this.renderElement();var a=this.elm.getDimensions();this.elm.setStyle({display:"block",top:this.clientHeight/2-(a.height/2-0)+"px",left:this.clientWidth/2-(a.width/2-0)+"px"});this.remove()}}),Weapon=Class.create({FUNNEL_SLIDER_MAX:5,FUNNEL_CIRCLE_MAX:2,MEGA_CANNON_WAIT:250,MEGA_CANNON_HEIGHT:29,ship:null,enemy:null,funnelSliderCount:null,funnelCircles:null,megaCannonWaitCount:null,
megaCannonHeightCount:null,soundFunnelGo:null,soundFunnelAttack:null,soundAttack:null,soundMegaCannon:null,elms:null,initialize:function(a,b){this.ship=a;this.enemy=b;this.funnelSliderCount=0;this.funnelCircles=[];this.megaCannonHeightCount=this.megaCannonWaitCount=0;this.elms=[]},move:function(){0<this.megaCannonWaitCount&&(--this.megaCannonWaitCount,this.megaCannonWaitCount||this.ship.enableMegaCannonStatus());0<this.megaCannonHeightCount&&(0===this.megaCannonHeightCount%3&&this.addBulletLinearFromMegaCannon(),
--this.megaCannonHeightCount);this.funnelCircles.each(function(a){a.move()});for(var a=0,b=this.elms.size();a<b;a++)this.elms[a].move(),this.elms[a].isFunnelSliderAttack&&(this.addBulletLinearFromFunnel(this.elms[a].getLeft()),this.elms[a].isFunnelSliderAttack=!1),this.elms[a].isWeaponWaitStatusMegaCannon&&this.elms[a].setWidth(this.megaCannonWaitCount,this.MEGA_CANNON_WAIT),this.elms[a].isFunnelSlider&&(this.funnelSliderCount<=this.FUNNEL_SLIDER_MAX?this.ship.enableFunnelStatus():this.ship.disableFunnelStatus()),
this.elms[a].isDelete&&(this.elms[a].isFunnelSlider&&--this.funnelSliderCount,this.elms[a]=null);this.elms=this.elms.compact()},setSoundFunnelGo:function(a){this.soundFunnelGo=a},setSoundFunnelAttack:function(a){this.soundFunnelAttack=a},setSoundAttack:function(a){this.soundAttack=a},setSoundMegaCannon:function(a){this.soundMegaCannon=a},playSoundFunnelGo:function(){this.soundFunnelGo&&this.soundFunnelGo.replay()},playSoundFunnelAttack:function(){this.soundFunnelAttack&&this.soundFunnelAttack.replay()},
playSoundAttack:function(){this.soundAttack&&this.soundAttack.replay()},playSoundMegaCannon:function(){this.soundMegaCannon&&this.soundMegaCannon.replay()},addBulletLinear:function(){var a=new BulletLinear(this.ship,this.enemy);this.elms.push(a);a.renderElement();this.playSoundAttack()},addBulletHoming:function(){var a=new BulletHoming(this.ship,this.enemy);this.elms.push(a);a.renderElement();this.playSoundAttack()},addBulletBezierAuto:function(){var a=this.enemy.getLeft(),b=new BulletBezier(this.ship,
this.enemy,a-60),c=new BulletBezier(this.ship,this.enemy,a+30),a=new BulletBezier(this.ship,this.enemy,a+120);this.elms.push(b);this.elms.push(c);this.elms.push(a);b.renderElement();c.renderElement();a.renderElement();this.playSoundAttack()},addBulletBezierManual:function(a){a=new BulletBezier(this.ship,this.enemy,a);this.elms.push(a);a.renderElement();this.playSoundAttack()},addBulletLinearFromFunnel:function(a){var b=new BulletLinear(this.ship,this.enemy);b.setPos({top:this.ship.isEnemy?90:b.clientHeight-
120,left:a});this.elms.push(b);b.renderElement();this.playSoundFunnelAttack()},addBulletLinearFromMegaCannon:function(){var a=new BulletLinear(this.ship,this.enemy),b=new BulletLinear(this.ship,this.enemy),c=new BulletLinear(this.ship,this.enemy);a.setPos({top:this.ship.isEnemy?60:this.ship.clientHeight-90,left:this.ship.getLeft()});b.setPos({top:this.ship.isEnemy?60:this.ship.clientHeight-90,left:this.ship.getLeft()+30});c.setPos({top:this.ship.isEnemy?60:this.ship.clientHeight-90,left:this.ship.getLeft()+
60});this.elms.push(a);this.elms.push(b);this.elms.push(c);a.renderElement();b.renderElement();c.renderElement()},addBulletHomingFromFunnel:function(a,b){var c=new BulletHoming(this.ship,this.enemy);c.setPos({top:a,left:b});this.elms.push(c);c.renderElement()},addFunnelSlider:function(){if(!(this.FUNNEL_SLIDER_MAX<=this.funnelSliderCount)){var a=new FunnelSlider(this.ship,this.enemy);this.elms.push(a);++this.funnelSliderCount;a.renderElement();this.playSoundFunnelGo()}},addFunnelCircle:function(){if(this.FUNNEL_CIRCLE_MAX<=
this.funnelCircles.size())this.funnelCircles.each(function(a){this.addBulletHomingFromFunnel(a.getTop()+(a.isEnemy?30:-30),a.getLeft())}.bind(this)),this.playSoundFunnelAttack();else{var a=new FunnelCircle(this.ship);this.ship.addFunnel(a);this.funnelCircles.push(a);a.renderElement();this.playSoundFunnelGo()}},addIField:function(a){var b=new IField(this.ship),c=new WeaponWaitStatusIField(this.ship);b.setSound(a);b.setWaitStatus(c);this.elms.push(b);this.elms.push(c);b.renderElement();c.renderElement()},
addFunnelDefences:function(){var a=new FunnelDefenceLeft(this.ship,this.ship.getIField()),b=new FunnelDefenceRight(this.ship,this.ship.getIField());this.elms.push(a);this.elms.push(b);a.renderElement();b.renderElement()},addWeaponWaitStatusMegaCannon:function(){var a=new WeaponWaitStatusMegaCannon(this.ship);this.elms.push(a);a.renderElement()},removeFunnelCircle:function(a){var b;(b=this.funnelCircles.shift())&&b.remove();this.ship.funnels.shift();1<a&&((b=this.funnelCircles.shift())&&b.remove(),
this.ship.funnels.shift())},fireMegaCannon:function(){0<this.megaCannonWaitCount||(this.ship.disableMegaCannonStatus(),this.megaCannonWaitCount=this.MEGA_CANNON_WAIT,this.megaCannonHeightCount=this.MEGA_CANNON_HEIGHT,this.playSoundMegaCannon())}}),WeaponWaitStatus=Class.create(Sprite,{ship:null,isWeaponWaitStatus:!0,initialize:function($super,b){this.ship=b;$super()},createElement:function(){var a=this.getColor();return(new Element("div")).setStyle({width:"0px",height:"6px",backgroundColor:a,zIndex:this.Z_INDEX_BASE+
11,position:"fixed",boxShadow:"0px 0px 1px "+a,borderRadius:"1px"})},getColor:function(){return"#FF0099"},getInitTop:function(){return this.ship.getTop()+(this.ship.isEnemy?42:12)},getInitLeft:function(){return this.ship.getLeft()+35},setWidth:function(a,b){this.elm.setStyle({width:Math.floor(20*a/b)+"px"})},move:function(){this.setLeft(this.ship.getLeft()+35)}}),WeaponWaitStatusIField=Class.create(WeaponWaitStatus,{getColor:function(){return"#99FF00"}}),WeaponWaitStatusMegaCannon=Class.create(WeaponWaitStatus,
{isWeaponWaitStatusMegaCannon:!0});
      Event.observe(window, 'load', function() { new DuelShootingDemo(); });
    </script>
  </head>
  <body>
    <div style="width: 720px; margin: 0px; padding: 0px; float: left; text-align: center;">
      <h1 style="margin-top: 220px; font-size: 20px; color: #777777;">Duel Shooting Demo</h1>
    </div>
  </body>
</html>
