/*! duel-shooting-online 16-05-2017 */

function $A(iterable){if(!iterable)return[];if("toArray"in Object(iterable))return iterable.toArray();for(var length=iterable.length||0,results=new Array(length);length--;)results[length]=iterable[length];return results}function $w(string){return Object.isString(string)?(string=string.strip(),string?string.split(/\s+/):[]):[]}function $H(object){return new Hash(object)}function $R(start,end,exclusive){return new ObjectRange(start,end,exclusive)}var Prototype={Version:"1.7.2",Browser:function(){var ua=navigator.userAgent,isOpera="[object Opera]"==Object.prototype.toString.call(window.opera);return{IE:!!window.attachEvent&&!isOpera,Opera:isOpera,WebKit:ua.indexOf("AppleWebKit/")>-1,Gecko:ua.indexOf("Gecko")>-1&&-1===ua.indexOf("KHTML"),MobileSafari:/Apple.*Mobile/.test(ua)}}(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:function(){var constructor=window.Element||window.HTMLElement;return!(!constructor||!constructor.prototype)}(),SpecificElementExtensions:function(){if(void 0!==window.HTMLDivElement)return!0;var div=document.createElement("div"),form=document.createElement("form"),isSupported=!1;return div.__proto__&&div.__proto__!==form.__proto__&&(isSupported=!0),div=form=null,isSupported}()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)</script\\s*>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(x){return x}};Prototype.Browser.MobileSafari&&(Prototype.BrowserFeatures.SpecificElementExtensions=!1);var Class=function(){function subclass(){}function create(){function klass(){this.initialize.apply(this,arguments)}var parent=null,properties=$A(arguments);Object.isFunction(properties[0])&&(parent=properties.shift()),Object.extend(klass,Class.Methods),klass.superclass=parent,klass.subclasses=[],parent&&(subclass.prototype=parent.prototype,klass.prototype=new subclass,parent.subclasses.push(klass));for(var i=0,length=properties.length;i<length;i++)klass.addMethods(properties[i]);return klass.prototype.initialize||(klass.prototype.initialize=Prototype.emptyFunction),klass.prototype.constructor=klass,klass}function addMethods(source){var ancestor=this.superclass&&this.superclass.prototype,properties=Object.keys(source);IS_DONTENUM_BUGGY&&(source.toString!=Object.prototype.toString&&properties.push("toString"),source.valueOf!=Object.prototype.valueOf&&properties.push("valueOf"));for(var i=0,length=properties.length;i<length;i++){var property=properties[i],value=source[property];if(ancestor&&Object.isFunction(value)&&"$super"==value.argumentNames()[0]){var method=value;(value=function(m){return function(){return ancestor[m].apply(this,arguments)}}(property).wrap(method)).valueOf=function(method){return function(){return method.valueOf.call(method)}}(method),value.toString=function(method){return function(){return method.toString.call(method)}}(method)}this.prototype[property]=value}return this}var IS_DONTENUM_BUGGY=function(){for(var p in{toString:1})if("toString"===p)return!1;return!0}();return{create:create,Methods:{addMethods:addMethods}}}();!function(){function Type(o){switch(o){case null:return NULL_TYPE;case void 0:return UNDEFINED_TYPE}switch(typeof o){case"boolean":return BOOLEAN_TYPE;case"number":return NUMBER_TYPE;case"string":return STRING_TYPE}return OBJECT_TYPE}function extend(destination,source){for(var property in source)destination[property]=source[property];return destination}function inspect(object){try{return isUndefined(object)?"undefined":null===object?"null":object.inspect?object.inspect():String(object)}catch(e){if(e instanceof RangeError)return"...";throw e}}function toJSON(value){return Str("",{"":value},[])}function Str(key,holder,stack){var value=holder[key];Type(value)===OBJECT_TYPE&&"function"==typeof value.toJSON&&(value=value.toJSON(key));var _class=_toString.call(value);switch(_class){case NUMBER_CLASS:case BOOLEAN_CLASS:case STRING_CLASS:value=value.valueOf()}switch(value){case null:return"null";case!0:return"true";case!1:return"false"}switch(typeof value){case"string":return value.inspect(!0);case"number":return isFinite(value)?String(value):"null";case"object":for(var i=0,length=stack.length;i<length;i++)if(stack[i]===value)throw new TypeError("Cyclic reference to '"+value+"' in object");stack.push(value);var partial=[];if(_class===ARRAY_CLASS){for(var i=0,length=value.length;i<length;i++){var str=Str(i,value,stack);partial.push(void 0===str?"null":str)}partial="["+partial.join(",")+"]"}else{for(var keys=Object.keys(value),i=0,length=keys.length;i<length;i++)void 0!==(str=Str(key=keys[i],value,stack))&&partial.push(key.inspect(!0)+":"+str);partial="{"+partial.join(",")+"}"}return stack.pop(),partial}}function stringify(object){return JSON.stringify(object)}function toQueryString(object){return $H(object).toQueryString()}function toHTML(object){return object&&object.toHTML?object.toHTML():String.interpret(object)}function keys(object){if(Type(object)!==OBJECT_TYPE)throw new TypeError;var results=[];for(var property in object)_hasOwnProperty.call(object,property)&&results.push(property);if(IS_DONTENUM_BUGGY)for(var i=0;property=DONT_ENUMS[i];i++)_hasOwnProperty.call(object,property)&&results.push(property);return results}function values(object){var results=[];for(var property in object)results.push(object[property]);return results}function clone(object){return extend({},object)}function isElement(object){return!(!object||1!=object.nodeType)}function isArray(object){return _toString.call(object)===ARRAY_CLASS}function isHash(object){return object instanceof Hash}function isFunction(object){return _toString.call(object)===FUNCTION_CLASS}function isString(object){return _toString.call(object)===STRING_CLASS}function isNumber(object){return _toString.call(object)===NUMBER_CLASS}function isDate(object){return _toString.call(object)===DATE_CLASS}function isUndefined(object){return void 0===object}var _toString=Object.prototype.toString,_hasOwnProperty=Object.prototype.hasOwnProperty,NULL_TYPE="Null",UNDEFINED_TYPE="Undefined",BOOLEAN_TYPE="Boolean",NUMBER_TYPE="Number",STRING_TYPE="String",OBJECT_TYPE="Object",FUNCTION_CLASS="[object Function]",BOOLEAN_CLASS="[object Boolean]",NUMBER_CLASS="[object Number]",STRING_CLASS="[object String]",ARRAY_CLASS="[object Array]",DATE_CLASS="[object Date]",NATIVE_JSON_STRINGIFY_SUPPORT=window.JSON&&"function"==typeof JSON.stringify&&"0"===JSON.stringify(0)&&void 0===JSON.stringify(Prototype.K),DONT_ENUMS=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],IS_DONTENUM_BUGGY=function(){for(var p in{toString:1})if("toString"===p)return!1;return!0}();"function"==typeof Array.isArray&&Array.isArray([])&&!Array.isArray({})&&(isArray=Array.isArray),extend(Object,{extend:extend,inspect:inspect,toJSON:NATIVE_JSON_STRINGIFY_SUPPORT?stringify:toJSON,toQueryString:toQueryString,toHTML:toHTML,keys:Object.keys||keys,values:values,clone:clone,isElement:isElement,isArray:isArray,isHash:isHash,isFunction:isFunction,isString:isString,isNumber:isNumber,isDate:isDate,isUndefined:isUndefined})}(),Object.extend(Function.prototype,function(){function update(array,args){for(var arrayLength=array.length,length=args.length;length--;)array[arrayLength+length]=args[length];return array}function merge(array,args){return array=slice.call(array,0),update(array,args)}function argumentNames(){var names=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return 1!=names.length||names[0]?names:[]}function bind(context){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;if(!Object.isFunction(this))throw new TypeError("The object is not callable.");var nop=function(){},__method=this,args=slice.call(arguments,1),bound=function(){var a=merge(args,arguments),c=this instanceof bound?this:context;return __method.apply(c,a)};return nop.prototype=this.prototype,bound.prototype=new nop,bound}function bindAsEventListener(context){var __method=this,args=slice.call(arguments,1);return function(event){var a=update([event||window.event],args);return __method.apply(context,a)}}function curry(){if(!arguments.length)return this;var __method=this,args=slice.call(arguments,0);return function(){var a=merge(args,arguments);return __method.apply(this,a)}}function delay(timeout){var __method=this,args=slice.call(arguments,1);return timeout*=1e3,window.setTimeout(function(){return __method.apply(__method,args)},timeout)}function defer(){var args=update([.01],arguments);return this.delay.apply(this,args)}function wrap(wrapper){var __method=this;return function(){var a=update([__method.bind(this)],arguments);return wrapper.apply(this,a)}}function methodize(){if(this._methodized)return this._methodized;var __method=this;return this._methodized=function(){var a=update([this],arguments);return __method.apply(null,a)}}var slice=Array.prototype.slice,extensions={argumentNames:argumentNames,bindAsEventListener:bindAsEventListener,curry:curry,delay:delay,defer:defer,wrap:wrap,methodize:methodize};return Function.prototype.bind||(extensions.bind=bind),extensions}()),function(proto){function toISOString(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function toJSON(){return this.toISOString()}proto.toISOString||(proto.toISOString=toISOString),proto.toJSON||(proto.toJSON=toJSON)}(Date.prototype),RegExp.prototype.match=RegExp.prototype.test,RegExp.escape=function(str){return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(callback,frequency){this.callback=callback,this.frequency=frequency,this.currentlyExecuting=!1,this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),1e3*this.frequency)},execute:function(){this.callback(this)},stop:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.execute(),this.currentlyExecuting=!1}catch(e){throw this.currentlyExecuting=!1,e}}});Object.extend(String,{interpret:function(value){return null==value?"":String(value)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}}),Object.extend(String.prototype,function(){function prepareReplacement(replacement){if(Object.isFunction(replacement))return replacement;var template=new Template(replacement);return function(match){return template.evaluate(match)}}function isNonEmptyRegExp(regexp){return regexp.source&&"(?:)"!==regexp.source}function gsub(pattern,replacement){var match,result="",source=this;if(replacement=prepareReplacement(replacement),Object.isString(pattern)&&(pattern=RegExp.escape(pattern)),!pattern.length&&!isNonEmptyRegExp(pattern))return(replacement=replacement(""))+source.split("").join(replacement)+replacement;for(;source.length>0;)(match=source.match(pattern))&&match[0].length>0?(result+=source.slice(0,match.index),result+=String.interpret(replacement(match)),source=source.slice(match.index+match[0].length)):(result+=source,source="");return result}function sub(pattern,replacement,count){return replacement=prepareReplacement(replacement),count=Object.isUndefined(count)?1:count,this.gsub(pattern,function(match){return--count<0?match[0]:replacement(match)})}function scan(pattern,iterator){return this.gsub(pattern,iterator),String(this)}function truncate(length,truncation){return length=length||30,truncation=Object.isUndefined(truncation)?"...":truncation,this.length>length?this.slice(0,length-truncation.length)+truncation:String(this)}function strip(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function extractScripts(){var matchAll=new RegExp(Prototype.ScriptFragment,"img"),matchOne=new RegExp(Prototype.ScriptFragment,"im");return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||["",""])[1]})}function evalScripts(){return this.extractScripts().map(function(script){return eval(script)})}function escapeHTML(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function unescapeHTML(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function toQueryParams(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);return match?match[1].split(separator||"&").inject({},function(hash,pair){if((pair=pair.split("="))[0]){var key=decodeURIComponent(pair.shift()),value=pair.length>1?pair.join("="):pair[0];void 0!=value&&(value=value.gsub("+"," "),value=decodeURIComponent(value)),key in hash?(Object.isArray(hash[key])||(hash[key]=[hash[key]]),hash[key].push(value)):hash[key]=value}return hash}):{}}function toArray(){return this.split("")}function succ(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function times(count){return count<1?"":new Array(count+1).join(this)}function camelize(){return this.replace(/-+(.)?/g,function(match,chr){return chr?chr.toUpperCase():""})}function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()}function underscore(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function dasherize(){return this.replace(/_/g,"-")}function inspect(useDoubleQuotes){var escapedString=this.replace(/[\x00-\x1f\\]/g,function(character){return character in String.specialChar?String.specialChar[character]:"\\u00"+character.charCodeAt().toPaddedString(2,16)});return useDoubleQuotes?'"'+escapedString.replace(/"/g,'\\"')+'"':"'"+escapedString.replace(/'/g,"\\'")+"'"}function unfilterJSON(filter){return this.replace(filter||Prototype.JSONFilter,"$1")}function isJSON(){var str=this;return!str.blank()&&(str=str.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@"),str=str.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]"),str=str.replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(str))}function evalJSON(sanitize){var json=this.unfilterJSON(),cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;cx.test(json)&&(json=json.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));try{if(!sanitize||json.isJSON())return eval("("+json+")")}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())}function parseJSON(){var json=this.unfilterJSON();return JSON.parse(json)}function include(pattern){return this.indexOf(pattern)>-1}function startsWith(pattern,position){return position=Object.isNumber(position)?position:0,this.lastIndexOf(pattern,position)===position}function endsWith(pattern,position){pattern=String(pattern),(position=Object.isNumber(position)?position:this.length)<0&&(position=0),position>this.length&&(position=this.length);var d=position-pattern.length;return d>=0&&this.indexOf(pattern,d)===d}function empty(){return""==this}function blank(){return/^\s*$/.test(this)}function interpolate(object,pattern){return new Template(this,pattern).evaluate(object)}var NATIVE_JSON_PARSE_SUPPORT=window.JSON&&"function"==typeof JSON.parse&&JSON.parse('{"test": true}').test;return{gsub:gsub,sub:sub,scan:scan,truncate:truncate,strip:String.prototype.trim||strip,stripTags:stripTags,stripScripts:stripScripts,extractScripts:extractScripts,evalScripts:evalScripts,escapeHTML:escapeHTML,unescapeHTML:unescapeHTML,toQueryParams:toQueryParams,parseQuery:toQueryParams,toArray:toArray,succ:succ,times:times,camelize:camelize,capitalize:capitalize,underscore:underscore,dasherize:dasherize,inspect:inspect,unfilterJSON:unfilterJSON,isJSON:isJSON,evalJSON:NATIVE_JSON_PARSE_SUPPORT?parseJSON:evalJSON,include:include,startsWith:String.prototype.startsWith||startsWith,endsWith:String.prototype.endsWith||endsWith,empty:empty,blank:blank,interpolate:interpolate}}());var Template=Class.create({initialize:function(template,pattern){this.template=template.toString(),this.pattern=pattern||Template.Pattern},evaluate:function(object){return object&&Object.isFunction(object.toTemplateReplacements)&&(object=object.toTemplateReplacements()),this.template.gsub(this.pattern,function(match){if(null==object)return match[1]+"";var before=match[1]||"";if("\\"==before)return match[2];var ctx=object,expr=match[3],pattern=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;if(null==(match=pattern.exec(expr)))return before;for(;null!=match&&null!=(ctx=ctx[match[1].startsWith("[")?match[2].replace(/\\\\]/g,"]"):match[1]])&&""!=match[3];)expr=expr.substring("["==match[3]?match[1].length:match[0].length),match=pattern.exec(expr);return before+String.interpret(ctx)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={},Enumerable=function(){function each(iterator,context){try{this._each(iterator,context)}catch(e){if(e!=$break)throw e}return this}function eachSlice(number,iterator,context){var index=-number,slices=[],array=this.toArray();if(number<1)return array;for(;(index+=number)<array.length;)slices.push(array.slice(index,index+number));return slices.collect(iterator,context)}function all(iterator,context){iterator=iterator||Prototype.K;var result=!0;return this.each(function(value,index){if(!(result=result&&!!iterator.call(context,value,index,this)))throw $break},this),result}function any(iterator,context){iterator=iterator||Prototype.K;var result=!1;return this.each(function(value,index){if(result=!!iterator.call(context,value,index,this))throw $break},this),result}function collect(iterator,context){iterator=iterator||Prototype.K;var results=[];return this.each(function(value,index){results.push(iterator.call(context,value,index,this))},this),results}function detect(iterator,context){var result;return this.each(function(value,index){if(iterator.call(context,value,index,this))throw result=value,$break},this),result}function findAll(iterator,context){var results=[];return this.each(function(value,index){iterator.call(context,value,index,this)&&results.push(value)},this),results}function grep(filter,iterator,context){iterator=iterator||Prototype.K;var results=[];return Object.isString(filter)&&(filter=new RegExp(RegExp.escape(filter))),this.each(function(value,index){filter.match(value)&&results.push(iterator.call(context,value,index,this))},this),results}function include(object){if(Object.isFunction(this.indexOf)&&-1!=this.indexOf(object))return!0;var found=!1;return this.each(function(value){if(value==object)throw found=!0,$break}),found}function inGroupsOf(number,fillWith){return fillWith=Object.isUndefined(fillWith)?null:fillWith,this.eachSlice(number,function(slice){for(;slice.length<number;)slice.push(fillWith);return slice})}function inject(memo,iterator,context){return this.each(function(value,index){memo=iterator.call(context,memo,value,index,this)},this),memo}function invoke(method){var args=$A(arguments).slice(1);return this.map(function(value){return value[method].apply(value,args)})}function max(iterator,context){iterator=iterator||Prototype.K;var result;return this.each(function(value,index){value=iterator.call(context,value,index,this),(null==result||value>=result)&&(result=value)},this),result}function min(iterator,context){iterator=iterator||Prototype.K;var result;return this.each(function(value,index){value=iterator.call(context,value,index,this),(null==result||value<result)&&(result=value)},this),result}function partition(iterator,context){iterator=iterator||Prototype.K;var trues=[],falses=[];return this.each(function(value,index){(iterator.call(context,value,index,this)?trues:falses).push(value)},this),[trues,falses]}function pluck(property){var results=[];return this.each(function(value){results.push(value[property])}),results}function reject(iterator,context){var results=[];return this.each(function(value,index){iterator.call(context,value,index,this)||results.push(value)},this),results}function sortBy(iterator,context){return this.map(function(value,index){return{value:value,criteria:iterator.call(context,value,index,this)}},this).sort(function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0}).pluck("value")}function toArray(){return this.map()}function zip(){var iterator=Prototype.K,args=$A(arguments);Object.isFunction(args.last())&&(iterator=args.pop());var collections=[this].concat(args).map($A);return this.map(function(value,index){return iterator(collections.pluck(index))})}function size(){return this.toArray().length}function inspect(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:each,eachSlice:eachSlice,all:all,every:all,any:any,some:any,collect:collect,map:collect,detect:detect,findAll:findAll,select:findAll,filter:findAll,grep:grep,include:include,member:include,inGroupsOf:inGroupsOf,inject:inject,invoke:invoke,max:max,min:min,partition:partition,pluck:pluck,reject:reject,sortBy:sortBy,toArray:toArray,entries:toArray,zip:zip,size:size,inspect:inspect,find:detect}}();Array.from=$A,function(){function each(iterator,context){for(var i=0,length=this.length>>>0;i<length;i++)i in this&&iterator.call(context,this[i],i,this)}function clear(){return this.length=0,this}function first(){return this[0]}function last(){return this[this.length-1]}function compact(){return this.select(function(value){return null!=value})}function flatten(){return this.inject([],function(array,value){return Object.isArray(value)?array.concat(value.flatten()):(array.push(value),array)})}function without(){var values=slice.call(arguments,0);return this.select(function(value){return!values.include(value)})}function reverse(inline){return(!1===inline?this.toArray():this)._reverse()}function uniq(sorted){return this.inject([],function(array,value,index){return 0!=index&&(sorted?array.last()==value:array.include(value))||array.push(value),array})}function intersect(array){return this.uniq().findAll(function(item){return-1!==array.indexOf(item)})}function clone(){return slice.call(this,0)}function size(){return this.length}function inspect(){return"["+this.map(Object.inspect).join(", ")+"]"}function indexOf(item,i){if(null==this)throw new TypeError;var array=Object(this),length=array.length>>>0;if(0===length)return-1;if(i=Number(i),isNaN(i)?i=0:0!==i&&isFinite(i)&&(i=(i>0?1:-1)*Math.floor(Math.abs(i))),i>length)return-1;for(var k=i>=0?i:Math.max(length-Math.abs(i),0);k<length;k++)if(k in array&&array[k]===item)return k;return-1}function lastIndexOf(item,i){if(null==this)throw new TypeError;var array=Object(this),length=array.length>>>0;if(0===length)return-1;Object.isUndefined(i)?i=length:(i=Number(i),isNaN(i)?i=0:0!==i&&isFinite(i)&&(i=(i>0?1:-1)*Math.floor(Math.abs(i))));for(var k=i>=0?Math.min(i,length-1):length-Math.abs(i);k>=0;k--)if(k in array&&array[k]===item)return k;return-1}function concat(_){var item,array=[],items=slice.call(arguments,0),n=0;items.unshift(this);for(var i=0,length=items.length;i<length;i++)if(item=items[i],!Object.isArray(item)||"callee"in item)array[n++]=item;else for(var j=0,arrayLength=item.length;j<arrayLength;j++)j in item&&(array[n]=item[j]),n++;return array.length=n,array}function wrapNative(method){return function(){if(0===arguments.length)return method.call(this,Prototype.K);if(void 0===arguments[0]){var args=slice.call(arguments,1);return args.unshift(Prototype.K),method.apply(this,args)}return method.apply(this,arguments)}}function map(iterator){if(null==this)throw new TypeError;iterator=iterator||Prototype.K;for(var object=Object(this),results=[],context=arguments[1],n=0,i=0,length=object.length>>>0;i<length;i++)i in object&&(results[n]=iterator.call(context,object[i],i,object)),n++;return results.length=n,results}function filter(iterator){if(null==this||!Object.isFunction(iterator))throw new TypeError;for(var value,object=Object(this),results=[],context=arguments[1],i=0,length=object.length>>>0;i<length;i++)i in object&&(value=object[i],iterator.call(context,value,i,object)&&results.push(value));return results}function some(iterator){if(null==this)throw new TypeError;iterator=iterator||Prototype.K;for(var context=arguments[1],object=Object(this),i=0,length=object.length>>>0;i<length;i++)if(i in object&&iterator.call(context,object[i],i,object))return!0;return!1}function every(iterator){if(null==this)throw new TypeError;iterator=iterator||Prototype.K;for(var context=arguments[1],object=Object(this),i=0,length=object.length>>>0;i<length;i++)if(i in object&&!iterator.call(context,object[i],i,object))return!1;return!0}function inject(memo,iterator){iterator=iterator||Prototype.K;var context=arguments[2];return _reduce.call(this,iterator.bind(context),memo)}var arrayProto=Array.prototype,slice=arrayProto.slice,_each=arrayProto.forEach;if(_each||(_each=each),arrayProto.map&&(map=wrapNative(Array.prototype.map)),arrayProto.filter&&(filter=Array.prototype.filter),arrayProto.some)var some=wrapNative(Array.prototype.some);if(arrayProto.every)var every=wrapNative(Array.prototype.every);var _reduce=arrayProto.reduce;if(!arrayProto.reduce)var inject=Enumerable.inject;Object.extend(arrayProto,Enumerable),arrayProto._reverse||(arrayProto._reverse=arrayProto.reverse),Object.extend(arrayProto,{_each:_each,map:map,collect:map,select:filter,filter:filter,findAll:filter,some:some,any:some,every:every,all:every,inject:inject,clear:clear,first:first,last:last,compact:compact,flatten:flatten,without:without,reverse:reverse,uniq:uniq,intersect:intersect,clone:clone,toArray:clone,size:size,inspect:inspect}),function(){return 1!==[].concat(arguments)[0][0]}(1,2)&&(arrayProto.concat=concat),arrayProto.indexOf||(arrayProto.indexOf=indexOf),arrayProto.lastIndexOf||(arrayProto.lastIndexOf=lastIndexOf)}();var Hash=Class.create(Enumerable,function(){function initialize(object){this._object=Object.isHash(object)?object.toObject():Object.clone(object)}function _each(iterator,context){var i=0;for(var key in this._object){var value=this._object[key],pair=[key,value];pair.key=key,pair.value=value,iterator.call(context,pair,i),i++}}function set(key,value){return this._object[key]=value}function get(key){if(this._object[key]!==Object.prototype[key])return this._object[key]}function unset(key){var value=this._object[key];return delete this._object[key],value}function toObject(){return Object.clone(this._object)}function keys(){return this.pluck("key")}function values(){return this.pluck("value")}function index(value){var match=this.detect(function(pair){return pair.value===value});return match&&match.key}function merge(object){return this.clone().update(object)}function update(object){return new Hash(object).inject(this,function(result,pair){return result.set(pair.key,pair.value),result})}function toQueryPair(key,value){return Object.isUndefined(value)?key:(value=String.interpret(value),value=value.gsub(/(\r)?\n/,"\r\n"),value=encodeURIComponent(value),value=value.gsub(/%20/,"+"),key+"="+value)}function toQueryString(){return this.inject([],function(results,pair){var key=encodeURIComponent(pair.key),values=pair.value;if(values&&"object"==typeof values){if(Object.isArray(values)){for(var value,queryValues=[],i=0,len=values.length;i<len;i++)value=values[i],queryValues.push(toQueryPair(key,value));return results.concat(queryValues)}}else results.push(toQueryPair(key,values));return results}).join("&")}function inspect(){return"#<Hash:{"+this.map(function(pair){return pair.map(Object.inspect).join(": ")}).join(", ")+"}>"}function clone(){return new Hash(this)}return{initialize:initialize,_each:_each,set:set,get:get,unset:unset,toObject:toObject,toTemplateReplacements:toObject,keys:keys,values:values,index:index,merge:merge,update:update,toQueryString:toQueryString,inspect:inspect,toJSON:toObject,clone:clone}}());Hash.from=$H,Object.extend(Number.prototype,function(){function toColorPart(){return this.toPaddedString(2,16)}function succ(){return this+1}function times(iterator,context){return $R(0,this,!0).each(iterator,context),this}function toPaddedString(length,radix){var string=this.toString(radix||10);return"0".times(length-string.length)+string}function abs(){return Math.abs(this)}function round(){return Math.round(this)}function ceil(){return Math.ceil(this)}function floor(){return Math.floor(this)}return{toColorPart:toColorPart,succ:succ,times:times,toPaddedString:toPaddedString,abs:abs,round:round,ceil:ceil,floor:floor}}());var ObjectRange=Class.create(Enumerable,function(){function initialize(start,end,exclusive){this.start=start,this.end=end,this.exclusive=exclusive}function _each(iterator,context){var i,value=this.start;for(i=0;this.include(value);i++)iterator.call(context,value,i),value=value.succ()}function include(value){return!(value<this.start)&&(this.exclusive?value<this.end:value<=this.end)}return{initialize:initialize,_each:_each,include:include}}()),Abstract={},Try={these:function(){for(var returnValue,i=0,length=arguments.length;i<length;i++){var lambda=arguments[i];try{returnValue=lambda();break}catch(e){}}return returnValue}},Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(iterator,context){this.responders._each(iterator,context)},register:function(responder){this.include(responder)||this.responders.push(responder)},unregister:function(responder){this.responders=this.responders.without(responder)},dispatch:function(callback,request,transport,json){this.each(function(responder){if(Object.isFunction(responder[callback]))try{responder[callback].apply(responder,[request,transport,json])}catch(e){}})}},Object.extend(Ajax.Responders,Enumerable),Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}}),Ajax.Base=Class.create({initialize:function(options){this.options={method:"post",asynchronous:!0,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:!0,evalJS:!0},Object.extend(this.options,options||{}),this.options.method=this.options.method.toLowerCase(),Object.isHash(this.options.parameters)&&(this.options.parameters=this.options.parameters.toObject())}}),Ajax.Request=Class.create(Ajax.Base,{_complete:!1,initialize:function($super,url,options){$super(options),this.transport=Ajax.getTransport(),this.request(url)},request:function(url){this.url=url,this.method=this.options.method;var params=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);["get","post"].include(this.method)||(params+=(params?"&":"")+"_method="+this.method,this.method="post"),params&&"get"===this.method&&(this.url+=(this.url.include("?")?"&":"?")+params),this.parameters=params.toQueryParams();try{var response=new Ajax.Response(this);this.options.onCreate&&this.options.onCreate(response),Ajax.Responders.dispatch("onCreate",this,response),this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous),this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1),this.transport.onreadystatechange=this.onStateChange.bind(this),this.setRequestHeaders(),this.body="post"==this.method?this.options.postBody||params:null,this.transport.send(this.body),!this.options.asynchronous&&this.transport.overrideMimeType&&this.onStateChange()}catch(e){this.dispatchException(e)}},onStateChange:function(){var readyState=this.transport.readyState;readyState>1&&(4!=readyState||!this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var headers={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if("post"==this.method&&(headers["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:""),this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005&&(headers.Connection="close")),"object"==typeof this.options.requestHeaders){var extras=this.options.requestHeaders;if(Object.isFunction(extras.push))for(var i=0,length=extras.length;i<length;i+=2)headers[extras[i]]=extras[i+1];else $H(extras).each(function(pair){headers[pair.key]=pair.value})}for(var name in headers)null!=headers[name]&&this.transport.setRequestHeader(name,headers[name])},success:function(){var status=this.getStatus();return!status||status>=200&&status<300||304==status},getStatus:function(){try{return 1223===this.transport.status?204:this.transport.status||0}catch(e){return 0}},respondToReadyState:function(readyState){var state=Ajax.Request.Events[readyState],response=new Ajax.Response(this);if("Complete"==state){try{this._complete=!0,(this.options["on"+response.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(response,response.headerJSON)}catch(e){this.dispatchException(e)}var contentType=response.getHeader("Content-type");("force"==this.options.evalJS||this.options.evalJS&&this.isSameOrigin()&&contentType&&contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))&&this.evalResponse()}try{(this.options["on"+state]||Prototype.emptyFunction)(response,response.headerJSON),Ajax.Responders.dispatch("on"+state,this,response,response.headerJSON)}catch(e){this.dispatchException(e)}"Complete"==state&&(this.transport.onreadystatechange=Prototype.emptyFunction)},isSameOrigin:function(){var m=this.url.match(/^\s*https?:\/\/[^\/]*/);return!m||m[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(name){try{return this.transport.getResponseHeader(name)||null}catch(e){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(exception){(this.options.onException||Prototype.emptyFunction)(this,exception),Ajax.Responders.dispatch("onException",this,exception)}}),Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"],Ajax.Response=Class.create({initialize:function(request){this.request=request;var transport=this.transport=request.transport,readyState=this.readyState=transport.readyState;if((readyState>2&&!Prototype.Browser.IE||4==readyState)&&(this.status=this.getStatus(),this.statusText=this.getStatusText(),this.responseText=String.interpret(transport.responseText),this.headerJSON=this._getHeaderJSON()),4==readyState){var xml=transport.responseXML;this.responseXML=Object.isUndefined(xml)?null:xml,this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(e){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(e){return null}},getResponseHeader:function(name){return this.transport.getResponseHeader(name)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var json=this.getHeader("X-JSON");if(!json)return null;try{json=decodeURIComponent(escape(json))}catch(e){}try{return json.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(e){this.request.dispatchException(e)}},_getResponseJSON:function(){var options=this.request.options;if(!options.evalJSON||"force"!=options.evalJSON&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(options.sanitizeJSON||!this.request.isSameOrigin())}catch(e){this.request.dispatchException(e)}}}),Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,container,url,options){this.container={success:container.success||container,failure:container.failure||(container.success?null:container)};var onComplete=(options=Object.clone(options)).onComplete;options.onComplete=function(response,json){this.updateContent(response.responseText),Object.isFunction(onComplete)&&onComplete(response,json)}.bind(this),$super(url,options)},updateContent:function(responseText){var receiver=this.container[this.success()?"success":"failure"],options=this.options;if(options.evalScripts||(responseText=responseText.stripScripts()),receiver=$(receiver))if(options.insertion)if(Object.isString(options.insertion)){var insertion={};insertion[options.insertion]=responseText,receiver.insert(insertion)}else options.insertion(receiver,responseText);else receiver.update(responseText)}}),Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,container,url,options){$super(options),this.onComplete=this.options.onComplete,this.frequency=this.options.frequency||2,this.decay=this.options.decay||1,this.updater={},this.container=container,this.url=url,this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this),this.onTimerEvent()},stop:function(){this.updater.options.onComplete=void 0,clearTimeout(this.timer),(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(response){this.options.decay&&(this.decay=response.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=response.responseText),this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}}),function(GLOBAL){function $(element){if(arguments.length>1){for(var i=0,elements=[],length=arguments.length;i<length;i++)elements.push($(arguments[i]));return elements}return Object.isString(element)&&(element=document.getElementById(element)),Element.extend(element)}function shouldUseCreationCache(tagName,attributes){return"select"!==tagName&&!("type"in attributes)}function Element(tagName,attributes){if(attributes=attributes||{},tagName=tagName.toLowerCase(),HAS_EXTENDED_CREATE_ELEMENT_SYNTAX&&attributes.name)return tagName="<"+tagName+' name="'+attributes.name+'">',delete attributes.name,Element.writeAttribute(document.createElement(tagName),attributes);ELEMENT_CACHE[tagName]||(ELEMENT_CACHE[tagName]=Element.extend(document.createElement(tagName)));var node=shouldUseCreationCache(tagName,attributes)?ELEMENT_CACHE[tagName].cloneNode(!1):document.createElement(tagName);return Element.writeAttribute(node,attributes)}function inspect(element){var attribute,value,result="<"+(element=$(element)).tagName.toLowerCase();for(var property in INSPECT_ATTRIBUTES)attribute=INSPECT_ATTRIBUTES[property],(value=(element[property]||"").toString())&&(result+=" "+attribute+"="+value.inspect(!0));return result+">"}function visible(element){return"none"!==$(element).style.display}function toggle(element,bool){return element=$(element),Object.isUndefined(bool)&&(bool=!Element.visible(element)),Element[bool?"show":"hide"](element),element}function hide(element){return element=$(element),element.style.display="none",element}function show(element){return element=$(element),element.style.display="",element}function remove(element){return(element=$(element)).parentNode.removeChild(element),element}function update(element,content){for(var descendants=(element=$(element)).getElementsByTagName("*"),i=descendants.length;i--;)purgeElement(descendants[i]);if(content&&content.toElement&&(content=content.toElement()),Object.isElement(content))return element.update().insert(content);content=Object.toHTML(content);var tagName=element.tagName.toUpperCase();if("SCRIPT"===tagName&&SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING)return element.text=content,element;if(ANY_INNERHTML_BUGGY)if(tagName in INSERTION_TRANSLATIONS.tags){for(;element.firstChild;)element.removeChild(element.firstChild);for(var nodes=getContentFromAnonymousElement(tagName,content.stripScripts()),i=0;node=nodes[i];i++)element.appendChild(node)}else if(LINK_ELEMENT_INNERHTML_BUGGY&&Object.isString(content)&&content.indexOf("<link")>-1){for(;element.firstChild;)element.removeChild(element.firstChild);for(var node,nodes=getContentFromAnonymousElement(tagName,content.stripScripts(),!0),i=0;node=nodes[i];i++)element.appendChild(node)}else element.innerHTML=content.stripScripts();else element.innerHTML=content.stripScripts();return content.evalScripts.bind(content).defer(),element}function replace(element,content){if(element=$(element),content&&content.toElement)content=content.toElement();else if(!Object.isElement(content)){content=Object.toHTML(content);var range=element.ownerDocument.createRange();range.selectNode(element),content.evalScripts.bind(content).defer(),content=range.createContextualFragment(content.stripScripts())}return element.parentNode.replaceChild(content,element),element}function replace_IE(element,content){if(element=$(element),content&&content.toElement&&(content=content.toElement()),Object.isElement(content))return element.parentNode.replaceChild(content,element),element;content=Object.toHTML(content);var parent=element.parentNode,tagName=parent.tagName.toUpperCase();if(tagName in INSERTION_TRANSLATIONS.tags){var nextSibling=Element.next(element),fragments=getContentFromAnonymousElement(tagName,content.stripScripts());parent.removeChild(element);var iterator;iterator=nextSibling?function(node){parent.insertBefore(node,nextSibling)}:function(node){parent.appendChild(node)},fragments.each(iterator)}else element.outerHTML=content.stripScripts();return content.evalScripts.bind(content).defer(),element}function isContent(content){return!Object.isUndefined(content)&&null!==content&&(!(!Object.isString(content)&&!Object.isNumber(content))||(!!Object.isElement(content)||!(!content.toElement&&!content.toHTML)))}function insertContentAt(element,content,position){position=position.toLowerCase();var method=INSERTION_TRANSLATIONS[position];if(content&&content.toElement&&(content=content.toElement()),Object.isElement(content))return method(element,content),element;content=Object.toHTML(content);var childNodes=getContentFromAnonymousElement(("before"===position||"after"===position?element.parentNode:element).tagName.toUpperCase(),content.stripScripts());"top"!==position&&"after"!==position||childNodes.reverse();for(var node,i=0;node=childNodes[i];i++)method(element,node);content.evalScripts.bind(content).defer()}function insert(element,insertions){element=$(element),isContent(insertions)&&(insertions={bottom:insertions});for(var position in insertions)insertContentAt(element,insertions[position],position);return element}function wrap(element,wrapper,attributes){return element=$(element),Object.isElement(wrapper)?$(wrapper).writeAttribute(attributes||{}):wrapper=Object.isString(wrapper)?new Element(wrapper,attributes):new Element("div",wrapper),element.parentNode&&element.parentNode.replaceChild(wrapper,element),wrapper.appendChild(element),wrapper}function cleanWhitespace(element){for(var node=(element=$(element)).firstChild;node;){var nextNode=node.nextSibling;node.nodeType!==Node.TEXT_NODE||/\S/.test(node.nodeValue)||element.removeChild(node),node=nextNode}return element}function empty(element){return $(element).innerHTML.blank()}function getContentFromAnonymousElement(tagName,html,force){var t=INSERTION_TRANSLATIONS.tags[tagName],div=DIV,workaround=!!t;if(!workaround&&force&&(workaround=!0,t=["","",0]),workaround){div.innerHTML="&#160;"+t[0]+html+t[1],div.removeChild(div.firstChild);for(var i=t[2];i--;)div=div.firstChild}else div.innerHTML=html;return $A(div.childNodes)}function clone(element,deep){if(element=$(element)){var clone=element.cloneNode(deep);if(!HAS_UNIQUE_ID_PROPERTY&&(clone._prototypeUID=UNDEFINED,deep))for(var descendants=Element.select(clone,"*"),i=descendants.length;i--;)descendants[i]._prototypeUID=UNDEFINED;return Element.extend(clone)}}function purgeElement(element){var uid=getUniqueElementID(element);uid&&(Element.stopObserving(element),HAS_UNIQUE_ID_PROPERTY||(element._prototypeUID=UNDEFINED),delete Element.Storage[uid])}function purgeCollection_IE(elements){for(var uid,i=elements.length;i--;)uid=getUniqueElementID(elements[i]),delete Element.Storage[uid],delete Event.cache[uid]}function purge(element){if(element=$(element)){purgeElement(element);for(var descendants=element.getElementsByTagName("*"),i=descendants.length;i--;)purgeElement(descendants[i]);return null}}function recursivelyCollect(element,property,maximumLength){element=$(element),maximumLength=maximumLength||-1;for(var elements=[];(element=element[property])&&(element.nodeType===Node.ELEMENT_NODE&&elements.push(Element.extend(element)),elements.length!==maximumLength););return elements}function ancestors(element){return recursivelyCollect(element,"parentNode")}function descendants(element){return Element.select(element,"*")}function firstDescendant(element){for(element=$(element).firstChild;element&&element.nodeType!==Node.ELEMENT_NODE;)element=element.nextSibling;return $(element)}function immediateDescendants(element){for(var results=[],child=$(element).firstChild;child;)child.nodeType===Node.ELEMENT_NODE&&results.push(Element.extend(child)),child=child.nextSibling;return results}function previousSiblings(element){return recursivelyCollect(element,"previousSibling")}function nextSiblings(element){return recursivelyCollect(element,"nextSibling")}function siblings(element){var previous=previousSiblings(element=$(element)),next=nextSiblings(element);return previous.reverse().concat(next)}function match(element,selector){return element=$(element),Object.isString(selector)?Prototype.Selector.match(element,selector):selector.match(element)}function _recursivelyFind(element,property,expression,index){for(element=$(element),expression=expression||0,index=index||0,Object.isNumber(expression)&&(index=expression,expression=null);element=element[property];)if(1===element.nodeType&&(!expression||Prototype.Selector.match(element,expression))&&!(--index>=0))return Element.extend(element)}function up(element,expression,index){return element=$(element),1===arguments.length?$(element.parentNode):_recursivelyFind(element,"parentNode",expression,index)}function down(element,expression,index){if(1===arguments.length)return firstDescendant(element);element=$(element),expression=expression||0,index=index||0,Object.isNumber(expression)&&(index=expression,expression="*");var node=Prototype.Selector.select(expression,element)[index];return Element.extend(node)}function previous(element,expression,index){return _recursivelyFind(element,"previousSibling",expression,index)}function next(element,expression,index){return _recursivelyFind(element,"nextSibling",expression,index)}function select(element){element=$(element);var expressions=SLICE.call(arguments,1).join(", ");return Prototype.Selector.select(expressions,element)}function adjacent(element){element=$(element);for(var sibling,expressions=SLICE.call(arguments,1).join(", "),siblings=Element.siblings(element),results=[],i=0;sibling=siblings[i];i++)Prototype.Selector.match(sibling,expressions)&&results.push(sibling);return results}function descendantOf_DOM(element,ancestor){for(element=$(element),ancestor=$(ancestor);element=element.parentNode;)if(element===ancestor)return!0;return!1}function descendantOf_contains(element,ancestor){return element=$(element),ancestor=$(ancestor),ancestor.contains?ancestor.contains(element)&&ancestor!==element:descendantOf_DOM(element,ancestor)}function descendantOf_compareDocumentPosition(element,ancestor){return element=$(element),ancestor=$(ancestor),8==(8&element.compareDocumentPosition(ancestor))}function identify(element){element=$(element);var id=Element.readAttribute(element,"id");if(id)return id;do{id="anonymous_element_"+idCounter++}while($(id));return Element.writeAttribute(element,"id",id),id}function readAttribute(element,name){return $(element).getAttribute(name)}function readAttribute_IE(element,name){element=$(element);var table=ATTRIBUTE_TRANSLATIONS.read;return table.values[name]?table.values[name](element,name):(table.names[name]&&(name=table.names[name]),name.include(":")?element.attributes&&element.attributes[name]?element.attributes[name].value:null:element.getAttribute(name))}function readAttribute_Opera(element,name){return"title"===name?element.title:element.getAttribute(name)}function writeAttribute(element,name,value){element=$(element);var attributes={},table=ATTRIBUTE_TRANSLATIONS.write;"object"==typeof name?attributes=name:attributes[name]=!!Object.isUndefined(value)||value;for(var attr in attributes)name=table.names[attr]||attr,value=attributes[attr],table.values[attr]&&(name=table.values[attr](element,value)||name),!1===value||null===value?element.removeAttribute(name):!0===value?element.setAttribute(name,name):element.setAttribute(name,value);return element}function hasAttribute(element,attribute){attribute=ATTRIBUTE_TRANSLATIONS.has[attribute]||attribute;var node=$(element).getAttributeNode(attribute);return!(!node||!node.specified)}function hasAttribute_IE(element,attribute){return"checked"===attribute?element.checked:hasAttribute(element,attribute)}function classNames(element){return new Element.ClassNames(element)}function getRegExpForClassName(className){if(regExpCache[className])return regExpCache[className];var re=new RegExp("(^|\\s+)"+className+"(\\s+|$)");return regExpCache[className]=re,re}function hasClassName(element,className){if(element=$(element)){var elementClassName=element.className;return 0!==elementClassName.length&&(elementClassName===className||getRegExpForClassName(className).test(elementClassName))}}function addClassName(element,className){if(element=$(element))return hasClassName(element,className)||(element.className+=(element.className?" ":"")+className),element}function removeClassName(element,className){if(element=$(element))return element.className=element.className.replace(getRegExpForClassName(className)," ").strip(),element}function toggleClassName(element,className,bool){if(element=$(element))return Object.isUndefined(bool)&&(bool=!hasClassName(element,className)),(0,Element[bool?"addClassName":"removeClassName"])(element,className)}function _getAttr(element,attribute){return element.getAttribute(attribute)}function _getAttr2(element,attribute){return element.getAttribute(attribute,2)}function _getAttrNode(element,attribute){var node=element.getAttributeNode(attribute);return node?node.value:""}function _getFlag(element,attribute){return $(element).hasAttribute(attribute)?attribute:null}function normalizeStyleName(style){return"float"===style||"styleFloat"===style?"cssFloat":style.camelize()}function normalizeStyleName_IE(style){return"float"===style||"cssFloat"===style?"styleFloat":style.camelize()}function setStyle(element,styles){var elementStyle=(element=$(element)).style;if(Object.isString(styles)){if(elementStyle.cssText+=";"+styles,styles.include("opacity")){var opacity=styles.match(/opacity:\s*(\d?\.?\d*)/)[1];Element.setOpacity(element,opacity)}return element}for(var property in styles)if("opacity"===property)Element.setOpacity(element,styles[property]);else{var value=styles[property];"float"!==property&&"cssFloat"!==property||(property=Object.isUndefined(elementStyle.styleFloat)?"cssFloat":"styleFloat"),elementStyle[property]=value}return element}function getStyle(element,style){element=$(element),style=normalizeStyleName(style);var value=element.style[style];if(!value||"auto"===value){var css=document.defaultView.getComputedStyle(element,null);value=css?css[style]:null}return"opacity"===style?value?parseFloat(value):1:"auto"===value?null:value}function getStyle_IE(element,style){element=$(element),style=normalizeStyleName_IE(style);var value=element.style[style];return!value&&element.currentStyle&&(value=element.currentStyle[style]),"opacity"!==style||STANDARD_CSS_OPACITY_SUPPORTED?"auto"===value?"width"!==style&&"height"!==style||!Element.visible(element)?null:Element.measure(element,style)+"px":value:getOpacity_IE(element)}function stripAlphaFromFilter_IE(filter){return(filter||"").replace(/alpha\([^\)]*\)/gi,"")}function hasLayout_IE(element){return element.currentStyle&&element.currentStyle.hasLayout||(element.style.zoom=1),element}function setOpacity(element,value){return element=$(element),1==value||""===value?value="":value<1e-5&&(value=0),element.style.opacity=value,element}function setOpacity_IE(element,value){if(STANDARD_CSS_OPACITY_SUPPORTED)return setOpacity(element,value);element=hasLayout_IE($(element));var filter=Element.getStyle(element,"filter"),style=element.style;return 1==value||""===value?(filter=stripAlphaFromFilter_IE(filter),filter?style.filter=filter:style.removeAttribute("filter"),element):(value<1e-5&&(value=0),style.filter=stripAlphaFromFilter_IE(filter)+"alpha(opacity="+100*value+")",element)}function getOpacity(element){return Element.getStyle(element,"opacity")}function getOpacity_IE(element){if(STANDARD_CSS_OPACITY_SUPPORTED)return getOpacity(element);var filter=Element.getStyle(element,"filter");if(0===filter.length)return 1;var match=(filter||"").match(/alpha\(opacity=(.*)\)/);return match&&match[1]?parseFloat(match[1])/100:1}function getUniqueElementID(element){return element===window?0:(void 0===element._prototypeUID&&(element._prototypeUID=Element.Storage.UID++),element._prototypeUID)}function getUniqueElementID_IE(element){return element===window?0:element==document?1:element.uniqueID}function getStorage(element){if(element=$(element)){var uid=getUniqueElementID(element);return Element.Storage[uid]||(Element.Storage[uid]=$H()),Element.Storage[uid]}}function store(element,key,value){if(element=$(element)){var storage=getStorage(element);return 2===arguments.length?storage.update(key):storage.set(key,value),element}}function retrieve(element,key,defaultValue){if(element=$(element)){var storage=getStorage(element),value=storage.get(key);return Object.isUndefined(value)&&(storage.set(key,defaultValue),value=defaultValue),value}}function extendElementWith(element,methods){for(var property in methods){var value=methods[property];!Object.isFunction(value)||property in element||(element[property]=value.methodize())}}function elementIsExtended(element){return getUniqueElementID(element)in EXTENDED}function extend(element){if(!element||elementIsExtended(element))return element;if(element.nodeType!==Node.ELEMENT_NODE||element==window)return element;var methods=Object.clone(Methods),tagName=element.tagName.toUpperCase();return ByTag[tagName]&&Object.extend(methods,ByTag[tagName]),extendElementWith(element,methods),EXTENDED[getUniqueElementID(element)]=!0,element}function extend_IE8(element){if(!element||elementIsExtended(element))return element;var t=element.tagName;return t&&/^(?:object|applet|embed)$/i.test(t)&&(extendElementWith(element,Element.Methods),extendElementWith(element,Element.Methods.Simulated),extendElementWith(element,Element.Methods.ByTag[t.toUpperCase()])),element}function addMethodsToTagName(tagName,methods){tagName=tagName.toUpperCase(),ByTag[tagName]||(ByTag[tagName]={}),Object.extend(ByTag[tagName],methods)}function mergeMethods(destination,methods,onlyIfAbsent){Object.isUndefined(onlyIfAbsent)&&(onlyIfAbsent=!1);for(var property in methods){var value=methods[property];Object.isFunction(value)&&(onlyIfAbsent&&property in destination||(destination[property]=value.methodize()))}}function findDOMClass(tagName){var klass,trans={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(trans[tagName]&&(klass="HTML"+trans[tagName]+"Element"),window[klass])return window[klass];if(klass="HTML"+tagName+"Element",window[klass])return window[klass];if(klass="HTML"+tagName.capitalize()+"Element",window[klass])return window[klass];var element=document.createElement(tagName),proto=element.__proto__||element.constructor.prototype;return element=null,proto}function addMethods(methods){if(0===arguments.length&&addFormMethods(),2===arguments.length){var tagName=methods;methods=arguments[1]}if(tagName)if(Object.isArray(tagName))for(var i=0;tag=tagName[i];i++)addMethodsToTagName(tag,methods);else addMethodsToTagName(tagName,methods);else Object.extend(Element.Methods,methods||{});var ELEMENT_PROTOTYPE=window.HTMLElement?HTMLElement.prototype:Element.prototype;if(F.ElementExtensions&&(mergeMethods(ELEMENT_PROTOTYPE,Element.Methods),mergeMethods(ELEMENT_PROTOTYPE,Element.Methods.Simulated,!0)),F.SpecificElementExtensions)for(var tag in Element.Methods.ByTag){var klass=findDOMClass(tag);Object.isUndefined(klass)||mergeMethods(klass.prototype,ByTag[tag])}Object.extend(Element,Element.Methods),Object.extend(Element,Element.Methods.Simulated),delete Element.ByTag,delete Element.Simulated,Element.extend.refresh(),ELEMENT_CACHE={}}function addFormMethods(){Object.extend(Form,Form.Methods),Object.extend(Form.Element,Form.Element.Methods),Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods),BUTTON:Object.clone(Form.Element.Methods)})}function destroyCache_IE(){DIV=null,ELEMENT_CACHE=null}var UNDEFINED,SLICE=Array.prototype.slice,DIV=document.createElement("div");GLOBAL.$=$,GLOBAL.Node||(GLOBAL.Node={}),GLOBAL.Node.ELEMENT_NODE||Object.extend(GLOBAL.Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});var ELEMENT_CACHE={},HAS_EXTENDED_CREATE_ELEMENT_SYNTAX=function(){try{var el=document.createElement('<input name="x">');return"input"===el.tagName.toLowerCase()&&"x"===el.name}catch(err){return!1}}(),oldElement=GLOBAL.Element;GLOBAL.Element=Element,Object.extend(GLOBAL.Element,oldElement||{}),oldElement&&(GLOBAL.Element.prototype=oldElement.prototype),Element.Methods={ByTag:{},Simulated:{}};var methods={},INSPECT_ATTRIBUTES={id:"id",className:"class"};methods.inspect=inspect,Object.extend(methods,{visible:visible,toggle:toggle,hide:hide,show:show});var SELECT_ELEMENT_INNERHTML_BUGGY=function(){var el=document.createElement("select"),isBuggy=!0;return el.innerHTML='<option value="test">test</option>',el.options&&el.options[0]&&(isBuggy="OPTION"!==el.options[0].nodeName.toUpperCase()),el=null,isBuggy}(),TABLE_ELEMENT_INNERHTML_BUGGY=function(){try{var el=document.createElement("table");if(el&&el.tBodies){el.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var isBuggy=void 0===el.tBodies[0];return el=null,isBuggy}}catch(e){return!0}}(),LINK_ELEMENT_INNERHTML_BUGGY=function(){try{var el=document.createElement("div");el.innerHTML="<link />";var isBuggy=0===el.childNodes.length;return el=null,isBuggy}catch(e){return!0}}(),ANY_INNERHTML_BUGGY=SELECT_ELEMENT_INNERHTML_BUGGY||TABLE_ELEMENT_INNERHTML_BUGGY||LINK_ELEMENT_INNERHTML_BUGGY,SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING=function(){var s=document.createElement("script"),isBuggy=!1;try{s.appendChild(document.createTextNode("")),isBuggy=!s.firstChild||s.firstChild&&3!==s.firstChild.nodeType}catch(e){isBuggy=!0}return s=null,isBuggy}(),INSERTION_TRANSLATIONS={before:function(element,node){element.parentNode.insertBefore(node,element)},top:function(element,node){element.insertBefore(node,element.firstChild)},bottom:function(element,node){element.appendChild(node)},after:function(element,node){element.parentNode.insertBefore(node,element.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}},tags=INSERTION_TRANSLATIONS.tags;Object.extend(tags,{THEAD:tags.TBODY,TFOOT:tags.TBODY,TH:tags.TD}),"outerHTML"in document.documentElement&&(replace=replace_IE),Object.extend(methods,{remove:remove,update:update,replace:replace,insert:insert,wrap:wrap,cleanWhitespace:cleanWhitespace,empty:empty,clone:clone,purge:purge});var descendantOf;descendantOf=DIV.compareDocumentPosition?descendantOf_compareDocumentPosition:DIV.contains?descendantOf_contains:descendantOf_DOM,Object.extend(methods,{recursivelyCollect:recursivelyCollect,ancestors:ancestors,descendants:descendants,firstDescendant:firstDescendant,immediateDescendants:immediateDescendants,previousSiblings:previousSiblings,nextSiblings:nextSiblings,siblings:siblings,match:match,up:up,down:down,previous:previous,next:next,select:select,adjacent:adjacent,descendantOf:descendantOf,getElementsBySelector:select,childElements:immediateDescendants});var idCounter=1;(function(){DIV.setAttribute("onclick",[]);var value=DIV.getAttribute("onclick"),isFunction=Object.isArray(value);return DIV.removeAttribute("onclick"),isFunction})()?readAttribute=readAttribute_IE:Prototype.Browser.Opera&&(readAttribute=readAttribute_Opera);var PROBLEMATIC_HAS_ATTRIBUTE_WITH_CHECKBOXES=function(){if(!HAS_EXTENDED_CREATE_ELEMENT_SYNTAX)return!1;var checkbox=document.createElement('<input type="checkbox">');checkbox.checked=!0;var node=checkbox.getAttributeNode("checked");return!node||!node.specified}();GLOBAL.Element.Methods.Simulated.hasAttribute=PROBLEMATIC_HAS_ATTRIBUTE_WITH_CHECKBOXES?hasAttribute_IE:hasAttribute;var regExpCache={},ATTRIBUTE_TRANSLATIONS={},classProp="className",forProp="for";DIV.setAttribute(classProp,"x"),"x"!==DIV.className&&(DIV.setAttribute("class","x"),"x"===DIV.className&&(classProp="class"));var LABEL=document.createElement("label");LABEL.setAttribute(forProp,"x"),"x"!==LABEL.htmlFor&&(LABEL.setAttribute("htmlFor","x"),"x"===LABEL.htmlFor&&(forProp="htmlFor")),LABEL=null,DIV.onclick=Prototype.emptyFunction;var _getEv,onclickValue=DIV.getAttribute("onclick");String(onclickValue).indexOf("{")>-1?_getEv=function(element,attribute){var value=element.getAttribute(attribute);return value?(value=value.toString(),value=value.split("{")[1],(value=value.split("}")[0]).strip()):null}:""===onclickValue&&(_getEv=function(element,attribute){var value=element.getAttribute(attribute);return value?value.strip():null}),ATTRIBUTE_TRANSLATIONS.read={names:{class:classProp,className:classProp,for:forProp,htmlFor:forProp},values:{style:function(element){return element.style.cssText.toLowerCase()},title:function(element){return element.title}}},ATTRIBUTE_TRANSLATIONS.write={names:{className:"class",htmlFor:"for",cellpadding:"cellPadding",cellspacing:"cellSpacing"},values:{checked:function(element,value){element.checked=!!value},style:function(element,value){element.style.cssText=value||""}}},ATTRIBUTE_TRANSLATIONS.has={names:{}},Object.extend(ATTRIBUTE_TRANSLATIONS.write.names,ATTRIBUTE_TRANSLATIONS.read.names);for(var attr,CAMEL_CASED_ATTRIBUTE_NAMES=$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder"),i=0;attr=CAMEL_CASED_ATTRIBUTE_NAMES[i];i++)ATTRIBUTE_TRANSLATIONS.write.names[attr.toLowerCase()]=attr,ATTRIBUTE_TRANSLATIONS.has.names[attr.toLowerCase()]=attr;Object.extend(ATTRIBUTE_TRANSLATIONS.read.values,{href:_getAttr2,src:_getAttr2,type:_getAttr,action:_getAttrNode,disabled:_getFlag,checked:_getFlag,readonly:_getFlag,multiple:_getFlag,onload:_getEv,onunload:_getEv,onclick:_getEv,ondblclick:_getEv,onmousedown:_getEv,onmouseup:_getEv,onmouseover:_getEv,onmousemove:_getEv,onmouseout:_getEv,onfocus:_getEv,onblur:_getEv,onkeypress:_getEv,onkeydown:_getEv,onkeyup:_getEv,onsubmit:_getEv,onreset:_getEv,onselect:_getEv,onchange:_getEv}),Object.extend(methods,{identify:identify,readAttribute:readAttribute,writeAttribute:writeAttribute,classNames:classNames,hasClassName:hasClassName,addClassName:addClassName,removeClassName:removeClassName,toggleClassName:toggleClassName});var STANDARD_CSS_OPACITY_SUPPORTED=function(){return DIV.style.cssText="opacity:.55",/^0.55/.test(DIV.style.opacity)}();Object.extend(methods,{setStyle:setStyle,getStyle:getStyle,setOpacity:setOpacity,getOpacity:getOpacity}),"styleFloat"in DIV.style&&(methods.getStyle=getStyle_IE,methods.setOpacity=setOpacity_IE,methods.getOpacity=getOpacity_IE);GLOBAL.Element.Storage={UID:1};var HAS_UNIQUE_ID_PROPERTY="uniqueID"in DIV;HAS_UNIQUE_ID_PROPERTY&&(getUniqueElementID=getUniqueElementID_IE),Object.extend(methods,{getStorage:getStorage,store:store,retrieve:retrieve});var Methods={},ByTag=Element.Methods.ByTag,F=Prototype.BrowserFeatures;!F.ElementExtensions&&"__proto__"in DIV&&(GLOBAL.HTMLElement={},GLOBAL.HTMLElement.prototype=DIV.__proto__,F.ElementExtensions=!0);var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY=function(tagName){if(void 0===window.Element)return!1;if(!HAS_EXTENDED_CREATE_ELEMENT_SYNTAX)return!1;var proto=window.Element.prototype;if(proto){var id="_"+(Math.random()+"").slice(2),el=document.createElement(tagName);proto[id]="x";var isBuggy="x"!==el[id];return delete proto[id],el=null,isBuggy}return!1}("object"),EXTENDED={};F.SpecificElementExtensions&&(extend=HTMLOBJECTELEMENT_PROTOTYPE_BUGGY?extend_IE8:Prototype.K),Object.extend(GLOBAL.Element,{extend:extend,addMethods:addMethods}),extend===Prototype.K?GLOBAL.Element.extend.refresh=Prototype.emptyFunction:GLOBAL.Element.extend.refresh=function(){Prototype.BrowserFeatures.ElementExtensions||(Object.extend(Methods,Element.Methods),Object.extend(Methods,Element.Methods.Simulated),EXTENDED={})},Element.addMethods(methods),window.attachEvent&&window.attachEvent("onunload",destroyCache_IE)}(this),function(){function toDecimal(pctString){var match=pctString.match(/^(\d+)%?$/i);return match?Number(match[1])/100:null}function getRawStyle(element,style){var value=(element=$(element)).style[style];if(!value||"auto"===value){var css=document.defaultView.getComputedStyle(element,null);value=css?css[style]:null}return"opacity"===style?value?parseFloat(value):1:"auto"===value?null:value}function getRawStyle_IE(element,style){var value=element.style[style];return!value&&element.currentStyle&&(value=element.currentStyle[style]),value}function getContentWidth(element,context){return element.offsetWidth-(getPixelValue(element,"borderLeftWidth",context)||0)-(getPixelValue(element,"borderRightWidth",context)||0)-(getPixelValue(element,"paddingLeft",context)||0)-(getPixelValue(element,"paddingRight",context)||0)}function getPixelValue(value,property,context){var element=null;if(Object.isElement(value)&&(value=getRawStyle(element=value,property)),null===value||Object.isUndefined(value))return null;if(/^(?:-)?\d+(\.\d+)?(px)?$/i.test(value))return window.parseFloat(value);var isPercentage=value.include("%"),isViewport=context===document.viewport;if(/\d/.test(value)&&element&&element.runtimeStyle&&(!isPercentage||!isViewport)){var style=element.style.left,rStyle=element.runtimeStyle.left;return element.runtimeStyle.left=element.currentStyle.left,element.style.left=value||0,value=element.style.pixelLeft,element.style.left=style,element.runtimeStyle.left=rStyle,value}if(element&&isPercentage){context=context||element.parentNode;var decimal=toDecimal(value),whole=null,isHorizontal=property.include("left")||property.include("right")||property.include("width"),isVertical=property.include("top")||property.include("bottom")||property.include("height");return context===document.viewport?isHorizontal?whole=document.viewport.getWidth():isVertical&&(whole=document.viewport.getHeight()):isHorizontal?whole=$(context).measure("width"):isVertical&&(whole=$(context).measure("height")),null===whole?0:whole*decimal}return 0}function isDisplayed(element){for(;element&&element.parentNode;){if("none"===element.getStyle("display"))return!1;element=$(element.parentNode)}return!0}function cssNameFor(key){return key.include("border")&&(key+="-width"),key.camelize()}function getLayout(element,preCompute){return new Element.Layout(element,preCompute)}function measure(element,property){return $(element).getLayout().get(property)}function getHeight(element){return Element.getDimensions(element).height}function getWidth(element){return Element.getDimensions(element).width}function getDimensions(element){element=$(element);var display=Element.getStyle(element,"display");if(display&&"none"!==display)return{width:element.offsetWidth,height:element.offsetHeight};var style=element.style,originalStyles={visibility:style.visibility,position:style.position,display:style.display},newStyles={visibility:"hidden",display:"block"};"fixed"!==originalStyles.position&&(newStyles.position="absolute"),Element.setStyle(element,newStyles);var dimensions={width:element.offsetWidth,height:element.offsetHeight};return Element.setStyle(element,originalStyles),dimensions}function getOffsetParent(element){if(element=$(element),isDocument(element)||isDetached(element)||isBody(element)||isHtml(element))return $(document.body);if(!("inline"===Element.getStyle(element,"display"))&&element.offsetParent)return $(element.offsetParent);for(;(element=element.parentNode)&&element!==document.body;)if("static"!==Element.getStyle(element,"position"))return isHtml(element)?$(document.body):$(element);return $(document.body)}function cumulativeOffset(element){var valueT=0,valueL=0;if((element=$(element)).parentNode)do{valueT+=element.offsetTop||0,valueL+=element.offsetLeft||0,element=element.offsetParent}while(element);return new Element.Offset(valueL,valueT)}function positionedOffset(element){var layout=(element=$(element)).getLayout(),valueT=0,valueL=0;do{if(valueT+=element.offsetTop||0,valueL+=element.offsetLeft||0,element=element.offsetParent){if(isBody(element))break;if("static"!==Element.getStyle(element,"position"))break}}while(element);return valueL-=layout.get("margin-top"),valueT-=layout.get("margin-left"),new Element.Offset(valueL,valueT)}function cumulativeScrollOffset(element){var valueT=0,valueL=0;do{if(element===document.body){var bodyScrollNode=document.documentElement||document.body.parentNode||document.body;valueT+=Object.isUndefined(window.pageYOffset)?bodyScrollNode.scrollTop||0:window.pageYOffset,valueL+=Object.isUndefined(window.pageXOffset)?bodyScrollNode.scrollLeft||0:window.pageXOffset;break}valueT+=element.scrollTop||0,valueL+=element.scrollLeft||0,element=element.parentNode}while(element);return new Element.Offset(valueL,valueT)}function viewportOffset(forElement){var valueT=0,valueL=0,docBody=document.body,element=forElement=$(forElement);do{if(valueT+=element.offsetTop||0,valueL+=element.offsetLeft||0,element.offsetParent==docBody&&"absolute"==Element.getStyle(element,"position"))break}while(element=element.offsetParent);element=forElement;do{element!=docBody&&(valueT-=element.scrollTop||0,valueL-=element.scrollLeft||0)}while(element=element.parentNode);return new Element.Offset(valueL,valueT)}function absolutize(element){if(element=$(element),"absolute"===Element.getStyle(element,"position"))return element;var offsetParent=getOffsetParent(element),eOffset=element.viewportOffset(),pOffset=offsetParent.viewportOffset(),offset=eOffset.relativeTo(pOffset),layout=element.getLayout();return element.store("prototype_absolutize_original_styles",{position:element.getStyle("position"),left:element.getStyle("left"),top:element.getStyle("top"),width:element.getStyle("width"),height:element.getStyle("height")}),element.setStyle({position:"absolute",top:offset.top+"px",left:offset.left+"px",width:layout.get("width")+"px",height:layout.get("height")+"px"}),element}function relativize(element){if(element=$(element),"relative"===Element.getStyle(element,"position"))return element;var originalStyles=element.retrieve("prototype_absolutize_original_styles");return originalStyles&&element.setStyle(originalStyles),element}function scrollTo(element){element=$(element);var pos=Element.cumulativeOffset(element);return window.scrollTo(pos.left,pos.top),element}function makePositioned(element){element=$(element);var position=Element.getStyle(element,"position"),styles={};return"static"!==position&&position||(styles.position="relative",Prototype.Browser.Opera&&(styles.top=0,styles.left=0),Element.setStyle(element,styles),Element.store(element,"prototype_made_positioned",!0)),element}function undoPositioned(element){element=$(element);var storage=Element.getStorage(element);return storage.get("prototype_made_positioned")&&(storage.unset("prototype_made_positioned"),Element.setStyle(element,{position:"",top:"",bottom:"",left:"",right:""})),element}function makeClipping(element){element=$(element);var storage=Element.getStorage(element),madeClipping=storage.get("prototype_made_clipping");if(Object.isUndefined(madeClipping)){var overflow=Element.getStyle(element,"overflow");storage.set("prototype_made_clipping",overflow),"hidden"!==overflow&&(element.style.overflow="hidden")}return element}function undoClipping(element){element=$(element);var storage=Element.getStorage(element),overflow=storage.get("prototype_made_clipping");return Object.isUndefined(overflow)||(storage.unset("prototype_made_clipping"),element.style.overflow=overflow||""),element}function clonePosition(element,source,options){options=Object.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},options||{}),source=$(source),element=$(element);var p,delta,layout,styles={};if((options.setLeft||options.setTop)&&(p=Element.viewportOffset(source),delta=[0,0],"absolute"===Element.getStyle(element,"position"))){var parent=Element.getOffsetParent(element);parent!==document.body&&(delta=Element.viewportOffset(parent))}return(options.setWidth||options.setHeight)&&(layout=Element.getLayout(source)),options.setLeft&&(styles.left=p[0]-delta[0]+options.offsetLeft+"px"),options.setTop&&(styles.top=p[1]-delta[1]+options.offsetTop+"px"),options.setWidth&&(styles.width=layout.get("border-box-width")+"px"),options.setHeight&&(styles.height=layout.get("border-box-height")+"px"),Element.setStyle(element,styles)}function isBody(element){return"BODY"===element.nodeName.toUpperCase()}function isHtml(element){return"HTML"===element.nodeName.toUpperCase()}function isDocument(element){return element.nodeType===Node.DOCUMENT_NODE}function isDetached(element){return element!==document.body&&!Element.descendantOf(element,document.body)}"currentStyle"in document.documentElement&&(getRawStyle=getRawStyle_IE);var hasLayout=Prototype.K;"currentStyle"in document.documentElement&&(hasLayout=function(element){return element.currentStyle.hasLayout||(element.style.zoom=1),element}),Element.Layout=Class.create(Hash,{initialize:function($super,element,preCompute){$super(),this.element=$(element),Element.Layout.PROPERTIES.each(function(property){this._set(property,null)},this),preCompute&&(this._preComputing=!0,this._begin(),Element.Layout.PROPERTIES.each(this._compute,this),this._end(),this._preComputing=!1)},_set:function(property,value){return Hash.prototype.set.call(this,property,value)},set:function(property,value){throw"Properties of Element.Layout are read-only."},get:function($super,property){var value=$super(property);return null===value?this._compute(property):value},_begin:function(){if(!this._isPrepared()){var element=this.element;if(isDisplayed(element))return void this._setPrepared(!0);var originalStyles={position:element.style.position||"",width:element.style.width||"",visibility:element.style.visibility||"",display:element.style.display||""};element.store("prototype_original_styles",originalStyles);var position=getRawStyle(element,"position"),width=element.offsetWidth;0!==width&&null!==width||(element.style.display="block",width=element.offsetWidth);var context="fixed"===position?document.viewport:element.parentNode,tempStyles={visibility:"hidden",display:"block"};"fixed"!==position&&(tempStyles.position="absolute"),element.setStyle(tempStyles);var newWidth,positionedWidth=element.offsetWidth;if(width&&positionedWidth===width)newWidth=getContentWidth(element,context);else if("absolute"===position||"fixed"===position)newWidth=getContentWidth(element,context);else{var parent=element.parentNode;newWidth=$(parent).getLayout().get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right")}element.setStyle({width:newWidth+"px"}),this._setPrepared(!0)}},_end:function(){var element=this.element,originalStyles=element.retrieve("prototype_original_styles");element.store("prototype_original_styles",null),element.setStyle(originalStyles),this._setPrepared(!1)},_compute:function(property){var COMPUTATIONS=Element.Layout.COMPUTATIONS;if(!(property in COMPUTATIONS))throw"Property not found.";return this._set(property,COMPUTATIONS[property].call(this,this.element))},_isPrepared:function(){return this.element.retrieve("prototype_element_layout_prepared",!1)},_setPrepared:function(bool){return this.element.store("prototype_element_layout_prepared",bool)},toObject:function(){var args=$A(arguments),obj={};return(0===args.length?Element.Layout.PROPERTIES:args.join(" ").split(" ")).each(function(key){if(Element.Layout.PROPERTIES.include(key)){var value=this.get(key);null!=value&&(obj[key]=value)}},this),obj},toHash:function(){var obj=this.toObject.apply(this,arguments);return new Hash(obj)},toCSS:function(){var args=$A(arguments),css={};return(0===args.length?Element.Layout.PROPERTIES:args.join(" ").split(" ")).each(function(key){if(Element.Layout.PROPERTIES.include(key)&&!Element.Layout.COMPOSITE_PROPERTIES.include(key)){var value=this.get(key);null!=value&&(css[cssNameFor(key)]=value+"px")}},this),css},inspect:function(){return"#<Element.Layout>"}}),Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(element){this._preComputing||this._begin();var bHeight=this.get("border-box-height");if(bHeight<=0)return this._preComputing||this._end(),0;var bTop=this.get("border-top"),bBottom=this.get("border-bottom"),pTop=this.get("padding-top"),pBottom=this.get("padding-bottom");return this._preComputing||this._end(),bHeight-bTop-bBottom-pTop-pBottom},width:function(element){this._preComputing||this._begin();var bWidth=this.get("border-box-width");if(bWidth<=0)return this._preComputing||this._end(),0;var bLeft=this.get("border-left"),bRight=this.get("border-right"),pLeft=this.get("padding-left"),pRight=this.get("padding-right");return this._preComputing||this._end(),bWidth-bLeft-bRight-pLeft-pRight},"padding-box-height":function(element){return this.get("height")+this.get("padding-top")+this.get("padding-bottom")},"padding-box-width":function(element){return this.get("width")+this.get("padding-left")+this.get("padding-right")},"border-box-height":function(element){this._preComputing||this._begin();var height=element.offsetHeight;return this._preComputing||this._end(),height},"border-box-width":function(element){this._preComputing||this._begin();var width=element.offsetWidth;return this._preComputing||this._end(),width},"margin-box-height":function(element){var bHeight=this.get("border-box-height"),mTop=this.get("margin-top"),mBottom=this.get("margin-bottom");return bHeight<=0?0:bHeight+mTop+mBottom},"margin-box-width":function(element){var bWidth=this.get("border-box-width"),mLeft=this.get("margin-left"),mRight=this.get("margin-right");return bWidth<=0?0:bWidth+mLeft+mRight},top:function(element){return element.positionedOffset().top},bottom:function(element){var offset=element.positionedOffset();return element.getOffsetParent().measure("height")-this.get("border-box-height")-offset.top},left:function(element){return element.positionedOffset().left},right:function(element){var offset=element.positionedOffset();return element.getOffsetParent().measure("width")-this.get("border-box-width")-offset.left},"padding-top":function(element){return getPixelValue(element,"paddingTop")},"padding-bottom":function(element){return getPixelValue(element,"paddingBottom")},"padding-left":function(element){return getPixelValue(element,"paddingLeft")},"padding-right":function(element){return getPixelValue(element,"paddingRight")},"border-top":function(element){return getPixelValue(element,"borderTopWidth")},"border-bottom":function(element){return getPixelValue(element,"borderBottomWidth")},"border-left":function(element){return getPixelValue(element,"borderLeftWidth")},"border-right":function(element){return getPixelValue(element,"borderRightWidth")},"margin-top":function(element){return getPixelValue(element,"marginTop")},"margin-bottom":function(element){return getPixelValue(element,"marginBottom")},"margin-left":function(element){return getPixelValue(element,"marginLeft")},"margin-right":function(element){return getPixelValue(element,"marginRight")}}}),"getBoundingClientRect"in document.documentElement&&Object.extend(Element.Layout.COMPUTATIONS,{right:function(element){var parent=hasLayout(element.getOffsetParent()),rect=element.getBoundingClientRect();return(parent.getBoundingClientRect().right-rect.right).round()},bottom:function(element){var parent=hasLayout(element.getOffsetParent()),rect=element.getBoundingClientRect();return(parent.getBoundingClientRect().bottom-rect.bottom).round()}}),Element.Offset=Class.create({initialize:function(left,top){this.left=left.round(),this.top=top.round(),this[0]=this.left,this[1]=this.top},relativeTo:function(offset){return new Element.Offset(this.left-offset.left,this.top-offset.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}}),Prototype.Browser.IE?(getOffsetParent=getOffsetParent.wrap(function(proceed,element){if(element=$(element),isDocument(element)||isDetached(element)||isBody(element)||isHtml(element))return $(document.body);var position=element.getStyle("position");if("static"!==position)return proceed(element);element.setStyle({position:"relative"});var value=proceed(element);return element.setStyle({position:position}),value}),positionedOffset=positionedOffset.wrap(function(proceed,element){if(!(element=$(element)).parentNode)return new Element.Offset(0,0);var position=element.getStyle("position");if("static"!==position)return proceed(element);var offsetParent=element.getOffsetParent();offsetParent&&"fixed"===offsetParent.getStyle("position")&&hasLayout(offsetParent),element.setStyle({position:"relative"});var value=proceed(element);return element.setStyle({position:position}),value})):Prototype.Browser.Webkit&&(cumulativeOffset=function(element){element=$(element);var valueT=0,valueL=0;do{if(valueT+=element.offsetTop||0,valueL+=element.offsetLeft||0,element.offsetParent==document.body&&"absolute"==Element.getStyle(element,"position"))break;element=element.offsetParent}while(element);return new Element.Offset(valueL,valueT)}),Element.addMethods({getLayout:getLayout,measure:measure,getWidth:getWidth,getHeight:getHeight,getDimensions:getDimensions,getOffsetParent:getOffsetParent,cumulativeOffset:cumulativeOffset,positionedOffset:positionedOffset,cumulativeScrollOffset:cumulativeScrollOffset,viewportOffset:viewportOffset,absolutize:absolutize,relativize:relativize,scrollTo:scrollTo,makePositioned:makePositioned,undoPositioned:undoPositioned,makeClipping:makeClipping,undoClipping:undoClipping,clonePosition:clonePosition}),"getBoundingClientRect"in document.documentElement&&Element.addMethods({viewportOffset:function(element){if(element=$(element),isDetached(element))return new Element.Offset(0,0);var rect=element.getBoundingClientRect(),docEl=document.documentElement;return new Element.Offset(rect.left-docEl.clientLeft,rect.top-docEl.clientTop)}})}(),function(){function getRootElement(){return ROOT||(ROOT=IS_OLD_OPERA?document.body:document.documentElement)}function getDimensions(){return{width:this.getWidth(),height:this.getHeight()}}function getWidth(){return getRootElement().clientWidth}function getHeight(){return getRootElement().clientHeight}function getScrollOffsets(){var x=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,y=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;return new Element.Offset(x,y)}var IS_OLD_OPERA=Prototype.Browser.Opera&&window.parseFloat(window.opera.version())<9.5,ROOT=null;document.viewport={getDimensions:getDimensions,getWidth:getWidth,getHeight:getHeight,getScrollOffsets:getScrollOffsets}}(),window.$$=function(){var expression=$A(arguments).join(", ");return Prototype.Selector.select(expression,document)},Prototype.Selector=function(){function select(){throw new Error('Method "Prototype.Selector.select" must be defined.')}function match(){throw new Error('Method "Prototype.Selector.match" must be defined.')}function find(elements,expression,index){index=index||0;var i,match=Prototype.Selector.match,length=elements.length,matchIndex=0;for(i=0;i<length;i++)if(match(elements[i],expression)&&index==matchIndex++)return Element.extend(elements[i])}function extendElements(elements){for(var i=0,length=elements.length;i<length;i++)Element.extend(elements[i]);return elements}var K=Prototype.K;return{select:select,match:match,find:find,extendElements:Element.extend===K?K:extendElements,extendElement:Element.extend}}(),Prototype._original_property=window.Sizzle,function(window){function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document&&setDocument(context),context=context||document,results=results||[],!selector||"string"!=typeof selector)return results;if(1!==(nodeType=context.nodeType)&&9!==nodeType)return[];if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector))if(m=match[1]){if(9===nodeType){if(!(elem=context.getElementById(m))||!elem.parentNode)return results;if(elem.id===m)return results.push(elem),results}else if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nid=old=expando,newContext=context,newSelector=9===nodeType&&selector,1===nodeType&&"object"!==context.nodeName.toLowerCase()){for(groups=tokenize(selector),(old=context.getAttribute("id"))?nid=old.replace(rescape,"\\$&"):context.setAttribute("id",nid),nid="[id='"+nid+"'] ",i=groups.length;i--;)groups[i]=nid+toSelector(groups[i]);newContext=rsibling.test(selector)&&testContext(context.parentNode)||context,newSelector=groups.join(",")}if(newSelector)try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{old||context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}var keys=[];return cache}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return!1}finally{div.parentNode&&div.parentNode.removeChild(div),div=null}}function addHandle(attrs,handler){for(var arr=attrs.split("|"),i=attrs.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function testContext(context){return context&&typeof context.getElementsByTagName!==strundefined&&context}function setFilters(){}function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length));for(type in Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&"parentNode"===dir,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements){if(outerCache=elem[expando]||(elem[expando]={}),(oldCache=outerCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if(outerCache[dir]=newCache,newCache[2]=matcher(elem,context,xml))return!0}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function multipleContexts(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)(elem=unmatched[i])&&(filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i)));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,!0),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if((matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches))[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context!==document&&context);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0;matcher=elementMatchers[j++];)if(matcher(elem,context,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}var i,support,Expr,getText,isXML,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},strundefined="undefined",MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){for(var i=0,len=this.length;i<len;i++)if(this[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:([*^$|!~]?=)"+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+attributes.replace(3,8)+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return!!documentElement&&"HTML"!==documentElement.nodeName},setDocument=Sizzle.setDocument=function(node){var hasCompare,doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;return doc!==document&&9===doc.nodeType&&doc.documentElement?(document=doc,docElem=doc.documentElement,documentIsHTML=!isXML(doc),parent&&parent!==parent.top&&(parent.addEventListener?parent.addEventListener("unload",function(){setDocument()},!1):parent.attachEvent&&parent.attachEvent("onunload",function(){setDocument()})),support.attributes=assert(function(div){return div.className="i",!div.getAttribute("className")}),support.getElementsByTagName=assert(function(div){return div.appendChild(doc.createComment("")),!div.getElementsByTagName("*").length}),support.getElementsByClassName=rnative.test(doc.getElementsByClassName)&&assert(function(div){return div.innerHTML="<div class='a'></div><div class='a i'></div>",div.firstChild.className="i",2===div.getElementsByClassName("i").length}),support.getById=assert(function(div){return docElem.appendChild(div).id=expando,!doc.getElementsByName||!doc.getElementsByName(expando).length}),support.getById?(Expr.find.ID=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}},Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}):(delete Expr.find.ID,Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined)return context.getElementsByTagName(tag)}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!==strundefined&&documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],(support.qsa=rnative.test(doc.querySelectorAll))&&(assert(function(div){div.innerHTML="<select t=''><option selected=''></option></select>",div.querySelectorAll("[t^='']").length&&rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")"),div.querySelectorAll("[selected]").length||rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")"),div.querySelectorAll(":checked").length||rbuggyQSA.push(":checked")}),assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden"),div.appendChild(input).setAttribute("name","D"),div.querySelectorAll("[name=d]").length&&rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?="),div.querySelectorAll(":enabled").length||rbuggyQSA.push(":enabled",":disabled"),div.querySelectorAll("*,:x"),rbuggyQSA.push(",.*:")})),(support.matchesSelector=rnative.test(matches=docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert(function(div){support.disconnectedMatch=matches.call(div,"div"),matches.call(div,"[s!='']:x"),rbuggyMatches.push("!=",pseudos)}),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare||(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&compare||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)?-1:b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},doc):document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return Sizzle(expr,document,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==val?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},(Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[5]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]&&void 0!==match[4]?match[2]=match[4]:unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test("string"==typeof elem.className&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:!operator||(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&result.indexOf(check)>-1:"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?(" "+result+" ").indexOf(check)>-1:"|="===operator&&(result===check||result.slice(0,check.length+1)===check+"-"))}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(nodeIndex=(cache=(outerCache=parent[expando]||(parent[expando]={}))[type]||[])[0]===dirruns&&cache[1],diff=cache[0]===dirruns&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns)diff=cache[1];else for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((node[expando]||(node[expando]={}))[type]=[dirruns,diff]),node!==elem)););return(diff-=last)===first||diff%first==0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)seed[idx=indexOf.call(seed,matched[i])]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return(elemLang=elemLang.toLowerCase())===lang||0===elemLang.indexOf(lang+"-")}while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return!1===elem.disabled},disabled:function(elem){return!0===elem.disabled},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,!0===elem.selected},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}}).pseudos.nth=Expr.pseudos.eq;for(i in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=function(type){return function(elem){return"input"===elem.nodeName.toLowerCase()&&elem.type===type}}(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=function(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}(i);setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(match||(match=tokenize(selector)),i=match.length;i--;)(cached=matcherFromTokens(match[i]))[expando]?setMatchers.push(cached):elementMatchers.push(cached);(cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))).selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if((tokens=match[0]=match[0].slice(0)).length>2&&"ID"===(token=tokens[0]).type&&support.getById&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(!(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0]))return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),!(selector=seed.length&&toSelector(tokens)))return push.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=assert(function(div1){return 1&div1.compareDocumentPosition(document.createElement("div"))}),assert(function(div){return div.innerHTML="<a href='#'></a>","#"===div.firstChild.getAttribute("href")})||addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML)return elem.getAttribute(name,"type"===name.toLowerCase()?1:2)}),support.attributes&&assert(function(div){return div.innerHTML="<input/>",div.firstChild.setAttribute("value",""),""===div.firstChild.getAttribute("value")})||addHandle("value",function(elem,name,isXML){if(!isXML&&"input"===elem.nodeName.toLowerCase())return elem.defaultValue}),assert(function(div){return null==div.getAttribute("disabled")})||addHandle(booleans,function(elem,name,isXML){var val;if(!isXML)return!0===elem[name]?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}),"function"==typeof define&&define.amd?define(function(){return Sizzle}):"undefined"!=typeof module&&module.exports?module.exports=Sizzle:window.Sizzle=Sizzle}(window),function(engine){function select(selector,scope){return extendElements(engine(selector,scope||document))}function match(element,selector){return 1==engine.matches(selector,[element]).length}var extendElements=Prototype.Selector.extendElements;Prototype.Selector.engine=engine,Prototype.Selector.select=select,Prototype.Selector.match=match}(Sizzle),window.Sizzle=Prototype._original_property,delete Prototype._original_property;var Form={reset:function(form){return(form=$(form)).reset(),form},serializeElements:function(elements,options){"object"!=typeof options?options={hash:!!options}:Object.isUndefined(options.hash)&&(options.hash=!0);var key,value,accumulator,initial,submitted=!1,submit=options.submit;return options.hash?(initial={},accumulator=function(result,key,value){return key in result?(Object.isArray(result[key])||(result[key]=[result[key]]),result[key]=result[key].concat(value)):result[key]=value,result}):(initial="",accumulator=function(result,key,values){if(Object.isArray(values)||(values=[values]),!values.length)return result;var encodedKey=encodeURIComponent(key).gsub(/%20/,"+");return result+(result?"&":"")+values.map(function(value){return value=value.gsub(/(\r)?\n/,"\r\n"),value=encodeURIComponent(value),value=value.gsub(/%20/,"+"),encodedKey+"="+value}).join("&")}),elements.inject(initial,function(result,element){return!element.disabled&&element.name&&(key=element.name,null==(value=$(element).getValue())||"file"==element.type||"submit"==element.type&&(submitted||!1===submit||submit&&key!=submit||!(submitted=!0))||(result=accumulator(result,key,value))),result})}};Form.Methods={serialize:function(form,options){return Form.serializeElements(Form.getElements(form),options)},getElements:function(form){for(var element,elements=$(form).getElementsByTagName("*"),results=[],serializers=Form.Element.Serializers,i=0;element=elements[i];i++)serializers[element.tagName.toLowerCase()]&&results.push(Element.extend(element));return results},getInputs:function(form,typeName,name){var inputs=(form=$(form)).getElementsByTagName("input");if(!typeName&&!name)return $A(inputs).map(Element.extend);for(var i=0,matchingInputs=[],length=inputs.length;i<length;i++){var input=inputs[i];typeName&&input.type!=typeName||name&&input.name!=name||matchingInputs.push(Element.extend(input))}return matchingInputs},disable:function(form){return form=$(form),Form.getElements(form).invoke("disable"),form},enable:function(form){return form=$(form),Form.getElements(form).invoke("enable"),form},findFirstElement:function(form){var elements=$(form).getElements().findAll(function(element){return"hidden"!=element.type&&!element.disabled}),firstByIndex=elements.findAll(function(element){return element.hasAttribute("tabIndex")&&element.tabIndex>=0}).sortBy(function(element){return element.tabIndex}).first();return firstByIndex||elements.find(function(element){return/^(?:input|select|textarea)$/i.test(element.tagName)})},focusFirstElement:function(form){var element=(form=$(form)).findFirstElement();return element&&element.activate(),form},request:function(form,options){form=$(form);var params=(options=Object.clone(options||{})).parameters,action=form.readAttribute("action")||"";return action.blank()&&(action=window.location.href),options.parameters=form.serialize(!0),params&&(Object.isString(params)&&(params=params.toQueryParams()),Object.extend(options.parameters,params)),form.hasAttribute("method")&&!options.method&&(options.method=form.method),new Ajax.Request(action,options)}},Form.Element={focus:function(element){return $(element).focus(),element},select:function(element){return $(element).select(),element}},Form.Element.Methods={serialize:function(element){if(!(element=$(element)).disabled&&element.name){var value=element.getValue();if(void 0!=value){var pair={};return pair[element.name]=value,Object.toQueryString(pair)}}return""},getValue:function(element){var method=(element=$(element)).tagName.toLowerCase();return Form.Element.Serializers[method](element)},setValue:function(element,value){var method=(element=$(element)).tagName.toLowerCase();return Form.Element.Serializers[method](element,value),element},clear:function(element){return $(element).value="",element},present:function(element){return""!=$(element).value},activate:function(element){element=$(element);try{element.focus(),!element.select||"input"==element.tagName.toLowerCase()&&/^(?:button|reset|submit)$/i.test(element.type)||element.select()}catch(e){}return element},disable:function(element){return element=$(element),element.disabled=!0,element},enable:function(element){return element=$(element),element.disabled=!1,element}};var Field=Form.Element,$F=Form.Element.Methods.getValue;Form.Element.Serializers=function(){function input(element,value){switch(element.type.toLowerCase()){case"checkbox":case"radio":return inputSelector(element,value);default:return valueSelector(element,value)}}function inputSelector(element,value){if(Object.isUndefined(value))return element.checked?element.value:null;element.checked=!!value}function valueSelector(element,value){if(Object.isUndefined(value))return element.value;element.value=value}function select(element,value){if(Object.isUndefined(value))return("select-one"===element.type?selectOne:selectMany)(element);for(var opt,currentValue,single=!Object.isArray(value),i=0,length=element.length;i<length;i++)if(opt=element.options[i],currentValue=this.optionValue(opt),single){if(currentValue==value)return void(opt.selected=!0)}else opt.selected=value.include(currentValue)}function selectOne(element){var index=element.selectedIndex;return index>=0?optionValue(element.options[index]):null}function selectMany(element){var length=element.length;if(!length)return null;for(var i=0,values=[];i<length;i++){var opt=element.options[i];opt.selected&&values.push(optionValue(opt))}return values}function optionValue(opt){return Element.hasAttribute(opt,"value")?opt.value:opt.text}return{input:input,inputSelector:inputSelector,textarea:valueSelector,select:select,selectOne:selectOne,selectMany:selectMany,optionValue:optionValue,button:valueSelector}}(),Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,element,frequency,callback){$super(callback,frequency),this.element=$(element),this.lastValue=this.getValue()},execute:function(){var value=this.getValue();(Object.isString(this.lastValue)&&Object.isString(value)?this.lastValue!=value:String(this.lastValue)!=String(value))&&(this.callback(this.element,value),this.lastValue=value)}}),Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}}),Abstract.EventObserver=Class.create({initialize:function(element,callback){this.element=$(element),this.callback=callback,this.lastValue=this.getValue(),"form"==this.element.tagName.toLowerCase()?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var value=this.getValue();this.lastValue!=value&&(this.callback(this.element,value),this.lastValue=value)},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(element){if(element.type)switch(element.type.toLowerCase()){case"checkbox":case"radio":Event.observe(element,"click",this.onElementEvent.bind(this));break;default:Event.observe(element,"change",this.onElementEvent.bind(this))}}}),Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}}),function(GLOBAL){function _isButtonForDOMEvents(event,code){return event.which?event.which===code+1:event.button===code}function _isButtonForLegacyEvents(event,code){return event.button===legacyButtonMap[code]}function _isButtonForWebKit(event,code){switch(code){case 0:return 1==event.which&&!event.metaKey;case 1:return 2==event.which||1==event.which&&event.metaKey;case 2:return 3==event.which;default:return!1}}function isLeftClick(event){return _isButton(event,0)}function isMiddleClick(event){return _isButton(event,1)}function isRightClick(event){return _isButton(event,2)}function element(event){return Element.extend(_element(event))}function _element(event){var node=(event=Event.extend(event)).target,type=event.type,currentTarget=event.currentTarget;return currentTarget&&currentTarget.tagName&&("load"===type||"error"===type||"click"===type&&"input"===currentTarget.tagName.toLowerCase()&&"radio"===currentTarget.type)&&(node=currentTarget),node.nodeType==Node.TEXT_NODE?node.parentNode:node}function findElement(event,expression){var element=_element(event),selector=Prototype.Selector;if(!expression)return Element.extend(element);for(;element;){if(Object.isElement(element)&&selector.match(element,expression))return Element.extend(element);element=element.parentNode}}function pointer(event){return{x:pointerX(event),y:pointerY(event)}}function pointerX(event){var docElement=document.documentElement,body=document.body||{scrollLeft:0};return event.pageX||event.clientX+(docElement.scrollLeft||body.scrollLeft)-(docElement.clientLeft||0)}function pointerY(event){var docElement=document.documentElement,body=document.body||{scrollTop:0};return event.pageY||event.clientY+(docElement.scrollTop||body.scrollTop)-(docElement.clientTop||0)}function stop(event){Event.extend(event),event.preventDefault(),event.stopPropagation(),event.stopped=!0}function _relatedTarget(event){var element;switch(event.type){case"mouseover":case"mouseenter":element=event.fromElement;break;case"mouseout":case"mouseleave":element=event.toElement;break;default:return null}return Element.extend(element)}function getDOMEventName(eventName){return EVENT_TRANSLATIONS[eventName]||eventName}function getUniqueElementID(element){return element===window?0:(void 0===element._prototypeUID&&(element._prototypeUID=Element.Storage.UID++),element._prototypeUID)}function getUniqueElementID_IE(element){return element===window?0:element==document?1:element.uniqueID}function isCustomEvent(eventName){return eventName.include(":")}function getRegistryForElement(element,uid){var CACHE=GLOBAL.Event.cache;return Object.isUndefined(uid)&&(uid=getUniqueElementID(element)),CACHE[uid]||(CACHE[uid]={element:element}),CACHE[uid]}function destroyRegistryForElement(element,uid){Object.isUndefined(uid)&&(uid=getUniqueElementID(element)),delete GLOBAL.Event.cache[uid]}function register(element,eventName,handler){var registry=getRegistryForElement(element);registry[eventName]||(registry[eventName]=[]);for(var entries=registry[eventName],i=entries.length;i--;)if(entries[i].handler===handler)return null;var uid=getUniqueElementID(element),entry={responder:GLOBAL.Event._createResponder(uid,eventName,handler),handler:handler};return entries.push(entry),entry}function unregister(element,eventName,handler){var entries=getRegistryForElement(element)[eventName];if(entries){for(var entry,i=entries.length;i--;)if(entries[i].handler===handler){entry=entries[i];break}if(entry){var index=entries.indexOf(entry);return entries.splice(index,1),entry}}}function observe(element,eventName,handler){var entry=register(element=$(element),eventName,handler);if(null===entry)return element;var responder=entry.responder;return isCustomEvent(eventName)?observeCustomEvent(element,eventName,responder):observeStandardEvent(element,eventName,responder),element}function observeStandardEvent(element,eventName,responder){var actualEventName=getDOMEventName(eventName);element.addEventListener?element.addEventListener(actualEventName,responder,!1):element.attachEvent("on"+actualEventName,responder)}function observeCustomEvent(element,eventName,responder){element.addEventListener?element.addEventListener("dataavailable",responder,!1):(element.attachEvent("ondataavailable",responder),element.attachEvent("onlosecapture",responder))}function stopObserving(element,eventName,handler){element=$(element);var handlerGiven=!Object.isUndefined(handler);if(!!Object.isUndefined(eventName)&&!handlerGiven)return stopObservingElement(element),element;if(!handlerGiven)return stopObservingEventName(element,eventName),element;var entry=unregister(element,eventName,handler);return entry?(removeEvent(element,eventName,entry.responder),element):element}function stopObservingStandardEvent(element,eventName,responder){var actualEventName=getDOMEventName(eventName);element.removeEventListener?element.removeEventListener(actualEventName,responder,!1):element.detachEvent("on"+actualEventName,responder)}function stopObservingCustomEvent(element,eventName,responder){element.removeEventListener?element.removeEventListener("dataavailable",responder,!1):(element.detachEvent("ondataavailable",responder),element.detachEvent("onlosecapture",responder))}function stopObservingElement(element){var uid=getUniqueElementID(element),registry=GLOBAL.Event.cache[uid];if(registry){destroyRegistryForElement(element,uid);var entries,i;for(var eventName in registry)if("element"!==eventName)for(i=(entries=registry[eventName]).length;i--;)removeEvent(element,eventName,entries[i].responder)}}function stopObservingEventName(element,eventName){var registry=getRegistryForElement(element),entries=registry[eventName];if(entries){delete registry[eventName];for(var i=entries.length;i--;)removeEvent(element,eventName,entries[i].responder)}}function removeEvent(element,eventName,handler){isCustomEvent(eventName)?stopObservingCustomEvent(element,eventName,handler):stopObservingStandardEvent(element,eventName,handler)}function getFireTarget(element){return element!==document?element:document.createEvent&&!element.dispatchEvent?document.documentElement:element}function fire(element,eventName,memo,bubble){element=getFireTarget($(element)),Object.isUndefined(bubble)&&(bubble=!0);var event=fireEvent(element,eventName,memo=memo||{},bubble);return Event.extend(event)}function fireEvent_DOM(element,eventName,memo,bubble){var event=document.createEvent("HTMLEvents");return event.initEvent("dataavailable",bubble,!0),event.eventName=eventName,event.memo=memo,element.dispatchEvent(event),event}function fireEvent_IE(element,eventName,memo,bubble){var event=document.createEventObject();return event.eventType=bubble?"ondataavailable":"onlosecapture",event.eventName=eventName,event.memo=memo,element.fireEvent(event.eventType,event),event}function on(element,eventName,selector,callback){return element=$(element),Object.isFunction(selector)&&Object.isUndefined(callback)&&(callback=selector,selector=null),new Event.Handler(element,eventName,selector,callback).start()}function destroyCache_IE(){GLOBAL.Event.cache=null}var DIV=document.createElement("div"),docEl=document.documentElement,MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED="onmouseenter"in docEl&&"onmouseleave"in docEl,Event={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45},isIELegacyEvent=function(event){return!1};window.attachEvent&&(isIELegacyEvent=window.addEventListener?function(event){return!(event instanceof window.Event)}:function(event){return!0});var _isButton,legacyButtonMap={0:1,1:4,2:2};_isButton=window.attachEvent?window.addEventListener?function(event,code){return isIELegacyEvent(event)?_isButtonForLegacyEvents(event,code):_isButtonForDOMEvents(event,code)}:_isButtonForLegacyEvents:Prototype.Browser.WebKit?_isButtonForWebKit:_isButtonForDOMEvents,Event.Methods={isLeftClick:isLeftClick,isMiddleClick:isMiddleClick,isRightClick:isRightClick,element:element,findElement:findElement,pointer:pointer,pointerX:pointerX,pointerY:pointerY,stop:stop};var methods=Object.keys(Event.Methods).inject({},function(m,name){return m[name]=Event.Methods[name].methodize(),m});if(window.attachEvent){var additionalMethods={stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.returnValue=!1},inspect:function(){return"[object Event]"}};Event.extend=function(event,element){if(!event)return!1;if(!isIELegacyEvent(event))return event;if(event._extendedByPrototype)return event;event._extendedByPrototype=Prototype.emptyFunction;var pointer=Event.pointer(event);return Object.extend(event,{target:event.srcElement||element,relatedTarget:_relatedTarget(event),pageX:pointer.x,pageY:pointer.y}),Object.extend(event,methods),Object.extend(event,additionalMethods),event}}else Event.extend=Prototype.K;window.addEventListener&&(Event.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__,Object.extend(Event.prototype,methods));var EVENT_TRANSLATIONS={mouseenter:"mouseover",mouseleave:"mouseout"};MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED&&(getDOMEventName=Prototype.K),"uniqueID"in DIV&&(getUniqueElementID=getUniqueElementID_IE),Event._isCustomEvent=isCustomEvent;var fireEvent=document.createEvent?fireEvent_DOM:fireEvent_IE;Event.Handler=Class.create({initialize:function(element,eventName,selector,callback){this.element=$(element),this.eventName=eventName,this.selector=selector,this.callback=callback,this.handler=this.handleEvent.bind(this)},start:function(){return Event.observe(this.element,this.eventName,this.handler),this},stop:function(){return Event.stopObserving(this.element,this.eventName,this.handler),this},handleEvent:function(event){var element=Event.findElement(event,this.selector);element&&this.callback.call(this.element,event,element)}}),Object.extend(Event,Event.Methods),Object.extend(Event,{fire:fire,observe:observe,stopObserving:stopObserving,on:on}),Element.addMethods({fire:fire,observe:observe,stopObserving:stopObserving,on:on}),Object.extend(document,{fire:fire.methodize(),observe:observe.methodize(),stopObserving:stopObserving.methodize(),on:on.methodize(),loaded:!1}),GLOBAL.Event?Object.extend(window.Event,Event):GLOBAL.Event=Event,GLOBAL.Event.cache={},window.attachEvent&&window.attachEvent("onunload",destroyCache_IE),DIV=null,docEl=null}(this),function(GLOBAL){function isSimulatedMouseEnterLeaveEvent(eventName){return!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED&&("mouseenter"===eventName||"mouseleave"===eventName)}function createResponder(uid,eventName,handler){return Event._isCustomEvent(eventName)?createResponderForCustomEvent(uid,eventName,handler):isSimulatedMouseEnterLeaveEvent(eventName)?createMouseEnterLeaveResponder(uid,eventName,handler):function(event){if(Event.cache){var element=Event.cache[uid].element;Event.extend(event,element),handler.call(element,event)}}}function createResponderForCustomEvent(uid,eventName,handler){return function(event){var element=Event.cache[uid].element;return!Object.isUndefined(event.eventName)&&(event.eventName===eventName&&(Event.extend(event,element),void handler.call(element,event)))}}function createMouseEnterLeaveResponder(uid,eventName,handler){return function(event){var element=Event.cache[uid].element;Event.extend(event,element);for(var parent=event.relatedTarget;parent&&parent!==element;)try{parent=parent.parentNode}catch(e){parent=element}parent!==element&&handler.call(element,event)}}var docEl=document.documentElement,MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED="onmouseenter"in docEl&&"onmouseleave"in docEl;GLOBAL.Event._createResponder=createResponder,docEl=null}(this),function(GLOBAL){function fireContentLoadedEvent(){document.loaded||(TIMER&&window.clearTimeout(TIMER),document.loaded=!0,document.fire("dom:loaded"))}function checkReadyState(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",checkReadyState),fireContentLoadedEvent())}function pollDoScroll(){try{document.documentElement.doScroll("left")}catch(e){return void(TIMER=pollDoScroll.defer())}fireContentLoadedEvent()}var TIMER;if("complete"===document.readyState)return void fireContentLoadedEvent();document.addEventListener?document.addEventListener("DOMContentLoaded",fireContentLoadedEvent,!1):(document.attachEvent("onreadystatechange",checkReadyState),window==top&&(TIMER=pollDoScroll.defer())),Event.observe(window,"load",fireContentLoadedEvent)}(),Element.addMethods(),Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(element,content){return Element.insert(element,{before:content})},Top:function(element,content){return Element.insert(element,{top:content})},Bottom:function(element,content){return Element.insert(element,{bottom:content})},After:function(element,content){return Element.insert(element,{after:content})}},$continue=new Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(element,x,y){return this.includeScrollOffsets?this.withinIncludingScrolloffsets(element,x,y):(this.xcomp=x,this.ycomp=y,this.offset=Element.cumulativeOffset(element),y>=this.offset[1]&&y<this.offset[1]+element.offsetHeight&&x>=this.offset[0]&&x<this.offset[0]+element.offsetWidth)},withinIncludingScrolloffsets:function(element,x,y){var offsetcache=Element.cumulativeScrollOffset(element);return this.xcomp=x+offsetcache[0]-this.deltaX,this.ycomp=y+offsetcache[1]-this.deltaY,this.offset=Element.cumulativeOffset(element),this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+element.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+element.offsetWidth},overlap:function(mode,element){return mode?"vertical"==mode?(this.offset[1]+element.offsetHeight-this.ycomp)/element.offsetHeight:"horizontal"==mode?(this.offset[0]+element.offsetWidth-this.xcomp)/element.offsetWidth:void 0:0},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(element){return Position.prepare(),Element.absolutize(element)},relativize:function(element){return Position.prepare(),Element.relativize(element)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(source,target,options){return options=options||{},Element.clonePosition(target,source,options)}};document.getElementsByClassName||(document.getElementsByClassName=function(instanceMethods){function iter(name){return name.blank()?null:"[contains(concat(' ', @class, ' '), ' "+name+" ')]"}return instanceMethods.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(element,className){className=className.toString().strip();var cond=/\s/.test(className)?$w(className).map(iter).join(""):iter(className);return cond?document._getElementsByXPath(".//*"+cond,element):[]}:function(element,className){className=className.toString().strip();var elements=[],classNames=/\s/.test(className)?$w(className):null;if(!classNames&&!className)return elements;var nodes=$(element).getElementsByTagName("*");className=" "+className+" ";for(var child,cn,i=0;child=nodes[i];i++)child.className&&(cn=" "+child.className+" ")&&(cn.include(className)||classNames&&classNames.all(function(name){return!name.toString().blank()&&cn.include(" "+name+" ")}))&&elements.push(Element.extend(child));return elements},function(className,parentElement){return $(parentElement||document.body).getElementsByClassName(className)}}(Element.Methods)),Element.ClassNames=Class.create(),Element.ClassNames.prototype={initialize:function(element){this.element=$(element)},_each:function(iterator,context){this.element.className.split(/\s+/).select(function(name){return name.length>0})._each(iterator,context)},set:function(className){this.element.className=className},add:function(classNameToAdd){this.include(classNameToAdd)||this.set($A(this).concat(classNameToAdd).join(" "))},remove:function(classNameToRemove){this.include(classNameToRemove)&&this.set($A(this).without(classNameToRemove).join(" "))},toString:function(){return $A(this).join(" ")}},Object.extend(Element.ClassNames.prototype,Enumerable),function(){window.Selector=Class.create({initialize:function(expression){this.expression=expression.strip()},findElements:function(rootElement){return Prototype.Selector.select(this.expression,rootElement)},match:function(element){return Prototype.Selector.match(element,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}}),Object.extend(Selector,{matchElements:function(elements,expression){for(var match=Prototype.Selector.match,results=[],i=0,length=elements.length;i<length;i++){var element=elements[i];match(element,expression)&&results.push(Element.extend(element))}return results},findElement:function(elements,expression,index){index=index||0;for(var element,matchIndex=0,i=0,length=elements.length;i<length;i++)if(element=elements[i],Prototype.Selector.match(element,expression)&&index===matchIndex++)return Element.extend(element)},findChildElements:function(element,expressions){var selector=expressions.toArray().join(", ");return Prototype.Selector.select(selector,element||document)}})}();var Action=Class.create({hasTouchEvent:null,hasMousedownEvent:null,hasKeydownEvent:null,nextCommand:null,sprite:null,initialize:function(){this.hasTouchEvent="function"==typeof new Element("div",{ontouchstart:"return;"}).ontouchstart,this.hasMousedownEvent="function"==typeof new Element("div",{onmousedown:"return;"}).onmousedown,this.hasKeydownEvent="function"==typeof new Element("div",{onkeydown:"return;"}).onkeydown,this.sprite=new Sprite,this.setEventListener()},setEventListener:function(){this.hasTouchEvent&&$(document).observe("touchstart",this.handlerTouch.bindAsEventListener(this)),this.hasMousedownEvent&&$(document).observe("mousedown",this.handlerMouse.bindAsEventListener(this)),this.hasKeydownEvent&&$(document).observe("keydown",this.handler.bindAsEventListener(this))},stop:function(){this.hasTouchEvent&&$(document).stopObserving("touchstart"),this.hasMousedownEvent&&$(document).stopObserving("mousedown"),this.hasKeydownEvent&&$(document).stopObserving("keydown")},getCommand:function(){return this.nextCommand},resetCommand:function(){this.nextCommand=null},handlerTouch:function(e){this.convertToAction(e.touches[0].pageX,e.touches[0].pageY)&&e.stop()},handlerMouse:function(e){this.convertToAction(e.pageX,e.pageY)&&e.stop()}}),AI=Class.create({ship:null,enemy:null,enemyWeapon:null,height:null,shipTop:null,risksByArea:null,wait:null,stayAreaIndexes:null,seekAreaIndex:null,initialize:function(ship,enemy,enemyWeapon){this.ship=ship,this.enemy=enemy,this.enemyWeapon=enemyWeapon,this.height=ship.getClientHeight(),this.shipTop=ship.getTop(),this.wait=0,this.stayAreaIndexes={}},getCommand:function(){return 0<this.wait?(--this.wait,null):(this.wait+=Math.floor(100*Math.random())%this.WAIT_MAX,this.updateStayAreaIndexes(),this.updateRisksByArea(),this.updateSeekAreaIndex(),this.getNextCommand(this.getRecommendedCommand()))},resetCommand:Prototype.emptyFunction,updateStayAreaIndexes:function(){this.stayAreaIndexes.ship=Math.floor((this.ship.getLeft()+45)/90),this.stayAreaIndexes.enemy=Math.floor((this.enemy.getLeft()+45)/90)},updateRisksByArea:function(){this.risksByArea=[0,0,0,0,0,0,0,0],this.enemyWeapon.elms.each(function(elm){if(elm.instanceOfBullet&&elm.instanceOfBullet()){var top=elm.getTop(),left=elm.getLeft(),risk=Math.floor(this.height-Math.abs(top-this.shipTop)),areaIndex=Math.floor((left+15)/90);this.risksByArea[7<areaIndex?7:areaIndex]+=risk}}.bind(this))},updateSeekAreaIndex:function(){for(var seekInfo={idx:null,minDiffEnemy:null,minRisk:null},i=0,length=this.risksByArea.size();i<length;++i){var diffEnemy=Math.abs(i-this.stayAreaIndexes.enemy);(null===seekInfo.minRisk||this.risksByArea[i]<seekInfo.minRisk||this.risksByArea[i]===seekInfo.minRisk&&diffEnemy<seekInfo.minDiffEnemy)&&(seekInfo.idx=i,seekInfo.minDiffEnemy=diffEnemy,seekInfo.minRisk=this.risksByArea[i])}this.seekAreaIndex=seekInfo.idx},getRecommendedCommand:function(){var shipLeftAreaIndex=Math.floor(this.ship.getLeft()/90),shipRightAreaIndex=Math.floor((this.ship.getLeft()+89)/90);return this.seekAreaIndex<this.stayAreaIndexes.ship||this.seekAreaIndex<shipLeftAreaIndex||this.seekAreaIndex<shipRightAreaIndex?this.ship.isEnemy?"stepRight":"stepLeft":this.stayAreaIndexes.ship<this.seekAreaIndex||shipLeftAreaIndex<this.seekAreaIndex||shipRightAreaIndex<this.seekAreaIndex?this.ship.isEnemy?"stepLeft":"stepRight":"attack"},stop:Prototype.emptyFunction}),Command=Class.create({ship:null,weapon:null,initialize:function(ship,weapon){this.ship=ship,this.weapon=weapon},execute:function(command){command&&command in this&&this[command]()}}),ShipBuilder=Class.create({sounds:null,isEnemy:null,initialize:function(sounds,isEnemy){this.sounds=sounds,this.isEnemy=isEnemy},buildShip:Prototype.emptyFunction,buildWeapon:Prototype.emptyFunction,buildAction:Prototype.emptyFunction,buildAI:Prototype.emptyFunction,buildCommand:Prototype.emptyFunction});!function(global){"use strict";global.DuelShooting=global.Class.create({opening:null,background:null,condition:null,forkMe:null,sounds:null,timeKeeper:null,game:null,ships:null,actions:null,cmds:null,weapons:null,initialize:function(audioPath){this.opening=this.buildOpening(),this.opening.show(),this.addMonkeyPatch(),this.background=this.buildBackground(),this.condition=this.buildCondition(),this.forkMe=this.buildForkMeOnGitHub(),this.sounds=this.buildSounds(audioPath),this.timeKeeper=this.buildTimeKeeper(),this.ships={},this.weapons={},this.actions={},this.ais={},this.cmds={}},addMonkeyPatch:function(){Number.prototype.isTiming=function(num){return Math.floor(100*Math.random())%num==0}.methodize()},buildBackground:function(){return new global.Background},buildCondition:function(){return new global.Condition},buildForkMeOnGitHub:function(){return new global.ForkMeOnGitHub},buildOpening:function(){return new global.Opening(new global.Title)},buildSounds:function(audioPath){var sound=new global.Sound;return{hit:sound.createAudio(audioPath+"/hit.mp3"),lose:sound.createAudio(audioPath+"/lose.mp3"),newtype:sound.createAudio(audioPath+"/newtype.mp3"),attack:sound.createAudio(audioPath+"/attack.mp3"),megaCannon:sound.createAudio(audioPath+"/mega.mp3"),funnelGo:sound.createAudio(audioPath+"/funnel1.mp3"),funnelAtk:sound.createAudio(audioPath+"/funnel2.mp3"),iField:sound.createAudio(audioPath+"/at_field.mp3")}},buildTimeKeeper:function(){return new global.TimeKeeper},getShipColors:function(){for(var s=this.getRandomColor(),e=this.getRandomColor();s===e;e=this.getRandomColor());return{ship:s,enemy:e}},getRandomColor:function(){return["white","red","navy"][Math.floor(100*Math.random())%3]},getShipBuilder:function(color,sounds){return global.ShipFactory.getBuilderAsShip(color,sounds)},getEnemyBuilder:function(color,sounds){return global.ShipFactory.getBuilderAsEnemy(color,sounds)},beforeRoutine:global.Prototype.emptyFunction,routine:function(){this.beforeRoutine(),this.ships.ship.move(),this.ships.enemy.move(),this.weapons.ship.move(),this.weapons.enemy.move(),0===this.ships.enemy.getHitPoint()&&this.onEnemyDown(),0===this.ships.ship.getHitPoint()&&this.onShipDown(),this.afterRoutine()},onEnemyDown:function(){this.stop(!0)},onShipDown:function(){this.stop(!1)},afterRoutine:global.Prototype.emptyFunction,beforeStart:global.Prototype.emptyFunction,start:function(){this.beforeStart(),this.game.start(),this.timeKeeper.start(),this.afterStart()},afterStart:global.Prototype.emptyFunction,beforeStop:global.Prototype.emptyFunction,stop:function(isWin){this.beforeStop(),isWin?(this.forkMe.renderElement(),this.condition.update("You win.","#9999FF")):this.condition.update("You lose.","#FF9999"),this.actions.ship&&this.actions.ship.stop(),this.actions.enemy&&this.actions.enemy.stop(),this.timeKeeper.stop(),this.game.stop(),this.afterStop()},afterStop:global.Prototype.emptyFunction})}(window);var Sprite=Class.create({Z_INDEX_BASE:3e3,clientHeight:null,clientWidth:null,elm:null,initTop:null,initLeft:null,initTransformRotate:null,currentTop:null,currentLeft:null,currentTransformRotate:null,initialize:function(){this.clientHeight=this.getClientHeight(),this.clientWidth=this.getClientWidth(),this.elm=this.createElement(),this.initTop=this.getInitTop(),this.initLeft=this.getInitLeft(),this.initTransformRotate=this.getInitTransformRotate(),this.setupPosition()},createElement:function(){return new Element("div")},getInitTop:function(){return 0},getInitLeft:function(){return 0},getInitTransformRotate:function(){return 0},setupPosition:function(){this.setPos({top:this.initTop,left:this.initLeft})},resetPosition:function(){this.clientHeight=this.getClientHeight(),this.clientWidth=this.getClientWidth(),this.setupPosition()},getClientHeight:function(){return 480},getClientWidth:function(){return 720},renderElement:function(){$(document.body).insert(this.elm)},getTop:function(){return this.currentTop},getLeft:function(){return this.currentLeft},getPos:function(){return{top:this.currentTop,left:this.currentLeft}},getTransformRotate:function(){return this.currentTransformRotate},setTop:function(px){this.elm.setStyle({top:px+"px"}),this.currentTop=px},setLeft:function(px){this.elm.setStyle({left:px+"px"}),this.currentLeft=px},setPos:function(pxs){void 0!==pxs.top&&this.setTop(pxs.top),void 0!==pxs.left&&this.setLeft(pxs.left)},setTransformRotate:function(theta){this.elm.setStyle({webkitTransform:"rotate("+theta+"deg)",MozTransform:"rotate("+theta+"deg)",msTransform:"rotate("+theta+"deg)",transform:"rotate("+theta+"deg)"}),this.currentTransformRotate=theta},setOpacity:function(v){this.elm.setOpacity(v)},remove:function(){this.elm.remove()}}),Bullet=Class.create(Sprite,{ship:null,enemy:null,isFall:null,isDelete:null,initialize:function($super,ship,enemy){this.ship=ship,this.enemy=enemy,this.isFall=ship.isEnemy,this.isDelete=!1,$super()},getInitTop:function(){return this.isFall?60:this.clientHeight-90},getInitLeft:function(){return this.ship.getLeft()+30},createElement:function(){var color=this.getColor(),outer=new Element("div").setStyle({width:"30px",height:"30px",zIndex:this.Z_INDEX_BASE+6,position:"fixed"});return new Element("div").setStyle({width:"20px",height:"20px",margin:"5px",backgroundColor:color,borderRadius:"20px",boxShadow:"0px 0px 10px "+color}).wrap(outer)},instanceOfBullet:function(){return!0}}),Funnel=Class.create(Sprite,{carrier:null,isEnemy:null,isDelete:null,initialize:function($super,carrier){this.carrier=carrier,this.isEnemy=carrier.isEnemy,this.isDelete=!1,$super()},createElement:function(){var color=this.getColor();return this.isEnemy?this.createForEnemy(color):this.createForShip(color)},createForShip:function(color){var obj=new Element("div").setStyle({width:"30px",height:"30px",zIndex:this.Z_INDEX_BASE+4,position:"fixed"});return obj.insert(new Element("div").setStyle({width:"6px",height:"20px",marginLeft:"12px",backgroundColor:color,borderRadius:"2px",boxShadow:"0px 0px 10px "+color})),obj.insert(new Element("div").setStyle({width:"20px",height:"10px",margin:"0px 5px 0px 5px",backgroundColor:color,borderRadius:"20px",boxShadow:"0px 0px 10px "+color})),obj},createForEnemy:function(color){var obj=new Element("div").setStyle({width:"30px",height:"30px",zIndex:this.Z_INDEX_BASE+4,position:"fixed"});return obj.insert(new Element("div").setStyle({width:"20px",height:"10px",margin:"0px 5px 0px 5px",backgroundColor:color,borderRadius:"20px",boxShadow:"0px 0px 10px "+color})),obj.insert(new Element("div").setStyle({width:"6px",height:"20px",marginLeft:"12px",backgroundColor:color,borderRadius:"2px",boxShadow:"0px 0px 10px "+color})),obj}}),Ship=Class.create(Sprite,{hitPoint:null,soundHit:null,soundLose:null,isEnemy:null,way:null,nextCmd:null,initialize:function($super,isEnemy){this.isEnemy=isEnemy,this.hitPoint=100,$super(),this.setHitPoint(this.hitPoint)},createElement:function(){var color=this.getColor();return this.isEnemy?this.createEnemy(color):this.createShip(color)},createEnemy:function(color){var elm=new Element("div").setStyle({width:"90px",height:"60px",zIndex:this.Z_INDEX_BASE+10,position:"fixed",top:"0px",left:"0px"});return elm.insert(new Element("div").setStyle({width:"90px",height:"30px",backgroundColor:color,borderRadius:"6px",boxShadow:"0px 0px 30px "+color,textAlign:"center",fontWeight:800,fontSize:"20px"}).update(this.hitPoint)),elm.insert(new Element("div").setStyle({width:"30px",height:"30px",backgroundColor:color,borderRadius:"6px",boxShadow:"0px 0px 30px "+color,marginLeft:"30px"})),elm},createShip:function(color){var elm=new Element("div").setStyle({width:"90px",height:"60px",zIndex:this.Z_INDEX_BASE+10,position:"fixed",top:this.clientHeight-60+"px",left:this.clientWidth-90+"px"});return elm.insert(new Element("div").setStyle({width:"30px",height:"30px",backgroundColor:color,borderRadius:"6px",boxShadow:"0px 0px 10px "+color,marginLeft:"30px"})),elm.insert(new Element("div").setStyle({width:"90px",height:"30px",backgroundColor:color,borderRadius:"6px",boxShadow:"0px 0px 10px "+color,textAlign:"center",fontWeight:800,fontSize:"20px"}).update(this.hitPoint)),elm},getInitTop:function(){return this.isEnemy?0:this.clientHeight-60},getInitLeft:function(){return this.isEnemy?0:this.clientWidth-90},setSoundHit:function(audio){this.soundHit=audio},setSoundLose:function(audio){this.soundLose=audio},playSoundHit:function(){this.soundHit&&this.soundHit.replay()},playSoundLose:function(){this.soundLose&&this.soundLose.replay()},hit:function(){this.hitPoint<1||(this.setHitPoint(--this.hitPoint),0===this.hitPoint?this.playSoundLose():this.playSoundHit())},isHit:function(bullet,range){var enemyLeft=this.getLeft(),enemyIField=this.getIField?this.getIField():null,top=bullet.getTop(),left=bullet.getLeft();return!(!enemyIField||!enemyIField.isHit(bullet,range,enemyLeft))||(enemyLeft-25<left&&left<=enemyLeft+5&&(bullet.isFall?top+range>this.clientHeight-60:top+range<30)?(this.hit(),!0):enemyLeft+5<left&&left<enemyLeft+60&&(bullet.isFall?top+range>this.clientHeight-90:top+range<60)?(this.hit(),!0):enemyLeft+60<=left&&left<enemyLeft+90&&(bullet.isFall?top+range>this.clientHeight-60:top+range<30)?(this.hit(),!0):top+range<0||this.clientHeight<top+range)},setHitPoint:function(num){this.hitPoint=num,this.elm.down(this.isEnemy?0:1).update(num)},getHitPoint:function(){return this.hitPoint},stepRight:function(){this.way=this.isEnemy?"left":"right"},stepLeft:function(){this.way=this.isEnemy?"right":"left"},moveRight:function(){var max=this.clientWidth-90;this.currentLeft+10<=max&&this.setLeft(this.currentLeft+10)},moveLeft:function(){0<=this.currentLeft-10&&this.setLeft(this.currentLeft-10)},move:function(){null!==this.nextCmd&&"stepRight"!==this.nextCmd&&"stepLeft"!==this.nextCmd&&(this.way=null),"right"===this.way&&this.moveRight(),"left"===this.way&&this.moveLeft()}}),WeaponWaitStatus=Class.create(Sprite,{ship:null,isWeaponWaitStatus:!0,initialize:function($super,ship){this.ship=ship,$super()},createElement:function(){var color=this.getColor();return new Element("div").setStyle({width:"0px",height:"6px",backgroundColor:color,zIndex:this.Z_INDEX_BASE+11,position:"fixed",boxShadow:"0px 0px 1px "+color,borderRadius:"1px"})},getColor:function(){return"#FF0099"},getInitTop:function(){return this.ship.getTop()+(this.ship.isEnemy?42:12)},getInitLeft:function(){return this.ship.getLeft()+35},setWidth:function(current,max){this.elm.setStyle({width:Math.floor(20*current/max)+"px"})},move:function(){this.setLeft(this.ship.getLeft()+35)}}),ActionShipNavy=Class.create(Action,{KEY_A:65,KEY_S:83,KEY_D:68,KEY_F:70,KEY_Z:90,KEY_X:88,KEY_C:67,KEY_V:86,handler:function(e){if(!(e.altGraphKey||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey))switch(e.keyCode){case Event.KEY_RIGHT:this.nextCommand="stepRight",e.stop();break;case Event.KEY_LEFT:this.nextCommand="stepLeft",e.stop();break;case Event.KEY_UP:this.nextCommand="attack",e.stop();break;case this.KEY_A:this.nextCommand="attack1",e.stop();break;case this.KEY_S:this.nextCommand="attack2",e.stop();break;case this.KEY_D:this.nextCommand="attack3",e.stop();break;case this.KEY_F:this.nextCommand="attack4",e.stop();break;case this.KEY_Z:this.nextCommand="attack5",e.stop();break;case this.KEY_X:this.nextCommand="attack6",e.stop();break;case this.KEY_C:this.nextCommand="attack7",e.stop();break;case this.KEY_V:this.nextCommand="attack8",e.stop()}},convertToAction:function(x,y){var screenUpperPart=0<y&&y<this.sprite.clientHeight/2,screenLowerPart=this.sprite.clientHeight/2<y&&y<this.sprite.clientHeight,screenLeft=0<x&&x<this.sprite.clientWidth/3,screenCenter=this.sprite.clientWidth/3<x&&x<this.sprite.clientWidth/3*2,screenRight=this.sprite.clientWidth/3*2<x&&x<this.sprite.clientWidth;return screenLowerPart&&screenLeft?(this.nextCommand="stepLeft",!0):screenLowerPart&&screenCenter?(this.nextCommand="attack",!0):screenLowerPart&&screenRight?(this.nextCommand="stepRight",!0):screenUpperPart&&screenLeft?(this.nextCommand="stepLeft",!0):screenUpperPart&&screenCenter?(this.nextCommand="attack",!0):!(!screenUpperPart||!screenRight)&&(this.nextCommand="stepRight",!0)}}),ActionShipRed=Class.create(Action,{KEY_F:70,KEY_I:73,KEY_N:78,handler:function(e){if(!(e.altGraphKey||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey))switch(e.keyCode){case Event.KEY_RIGHT:this.nextCommand="stepRight",e.stop();break;case Event.KEY_LEFT:this.nextCommand="stepLeft",e.stop();break;case Event.KEY_UP:this.nextCommand="attack",e.stop();break;case this.KEY_I:this.nextCommand="barrier",e.stop();break;case this.KEY_F:this.nextCommand="funnel",e.stop();break;case this.KEY_N:this.nextCommand="avoid",e.stop()}},convertToAction:function(x,y){var screenUpperPart=0<y&&y<this.sprite.clientHeight/2,screenLowerPart=this.sprite.clientHeight/2<y&&y<this.sprite.clientHeight,screenLeft=0<x&&x<this.sprite.clientWidth/3,screenCenter=this.sprite.clientWidth/3<x&&x<this.sprite.clientWidth/3*2,screenRight=this.sprite.clientWidth/3*2<x&&x<this.sprite.clientWidth;return screenLowerPart&&screenLeft?(this.nextCommand="stepLeft",!0):screenLowerPart&&screenCenter?(this.nextCommand="avoid",!0):screenLowerPart&&screenRight?(this.nextCommand="stepRight",!0):screenUpperPart&&screenLeft?(this.nextCommand="funnel",!0):screenUpperPart&&screenCenter?(this.nextCommand="attack",!0):!(!screenUpperPart||!screenRight)&&(this.nextCommand="barrier",!0)}}),ActionShipWhite=Class.create(Action,{KEY_F:70,KEY_M:77,handler:function(e){if(!(e.altGraphKey||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey))switch(e.keyCode){case Event.KEY_RIGHT:this.nextCommand="stepRight",e.stop();break;case Event.KEY_LEFT:this.nextCommand="stepLeft",e.stop();break;case Event.KEY_UP:this.nextCommand="attack",e.stop();break;case Event.KEY_DOWN:this.nextCommand="wait",e.stop();break;case this.KEY_F:this.nextCommand="funnel",e.stop();break;case this.KEY_M:this.nextCommand="megaCannon",e.stop()}},convertToAction:function(x,y){var screenUpperPart=0<y&&y<this.sprite.clientHeight/2,screenLowerPart=this.sprite.clientHeight/2<y&&y<this.sprite.clientHeight,screenLeft=0<x&&x<this.sprite.clientWidth/3,screenCenter=this.sprite.clientWidth/3<x&&x<this.sprite.clientWidth/3*2,screenRight=this.sprite.clientWidth/3*2<x&&x<this.sprite.clientWidth;return screenLowerPart&&screenLeft?(this.nextCommand="stepLeft",!0):screenLowerPart&&screenCenter?(this.nextCommand="wait",!0):screenLowerPart&&screenRight?(this.nextCommand="stepRight",!0):screenUpperPart&&screenLeft?(this.nextCommand="funnel",!0):screenUpperPart&&screenCenter?(this.nextCommand="attack",!0):!(!screenUpperPart||!screenRight)&&(this.nextCommand="megaCannon",!0)}}),AIShipNavy=Class.create(AI,{WAIT_MAX:3,getNextCommand:function(recommendedCommand){if("attack"!==recommendedCommand||2..isTiming())return recommendedCommand;var idxs;switch(this.stayAreaIndexes.enemy){case 0:idxs=this.ship.isEnemy?[5,4,3]:[2,3,4];break;case 1:idxs=this.ship.isEnemy?[4,3,2]:[3,4,5];break;case 2:idxs=this.ship.isEnemy?[7,3,2]:[0,4,5];break;case 3:idxs=this.ship.isEnemy?[6,2,1]:[1,5,6];break;case 4:idxs=this.ship.isEnemy?[6,5,1]:[1,2,6];break;case 5:idxs=this.ship.isEnemy?[5,4,0]:[3,4,7];break;case 6:idxs=this.ship.isEnemy?[5,4,3]:[2,3,4];break;case 7:idxs=this.ship.isEnemy?[4,3,2]:[3,4,5]}return"attack"+(idxs[Math.floor(100*Math.random())%3]+1)}}),AIShipRed=Class.create(AI,{WAIT_MAX:7,funnelCount:0,getNextCommand:function(recommendedCommand){return this.updateFunnelCount(),this.funnelCount<2?this.isShipFixedOnArea()?"funnel":"stepLeft":"attack"!==recommendedCommand?this.isAvoidTiming(recommendedCommand)?"avoid":recommendedCommand:this.ship.isIFieldEnable()?"barrier":this.ship.getIFieldInfo().isActive||13..isTiming()?"funnel":recommendedCommand},updateFunnelCount:function(){var funnelInfo=this.ship.getFunnelInfo();null!==funnelInfo.firstLeft&&null!==funnelInfo.secondLeft?this.funnelCount=2:null!==funnelInfo.firstLeft&&null===funnelInfo.secondLeft?this.funnelCount=1:this.funnelCount=0},isShipFixedOnArea:function(){return 0===this.funnelCount&&this.stayAreaIndexes.ship===(this.ship.isEnemy?1:6)||1===this.funnelCount&&this.stayAreaIndexes.ship===(this.ship.isEnemy?6:1)},isAvoidTiming:function(recommendedCommand){return 49..isTiming()&&(!this.ship.isEnemy&&"stepLeft"===recommendedCommand&&3<this.stayAreaIndexes.ship||!this.ship.isEnemy&&"stepRight"===recommendedCommand&&this.stayAreaIndexes.ship<4||this.ship.isEnemy&&"stepLeft"===recommendedCommand&&this.stayAreaIndexes.ship<4||this.ship.isEnemy&&"stepRight"===recommendedCommand&&3<this.stayAreaIndexes.ship)}}),AIShipWhite=Class.create(AI,{WAIT_MAX:3,getNextCommand:function(recommendedCommand){return"attack"!==recommendedCommand?recommendedCommand:this.ship.isMegaCannonEnabled&&Math.abs(this.stayAreaIndexes.enemy-this.stayAreaIndexes.ship)<3?"megaCannon":this.ship.isNotFunnelEmpty&&this.stayAreaIndexes.ship!==this.stayAreaIndexes.enemy?"funnel":49..isTiming()&&13..isTiming()?"wait":recommendedCommand}}),CommandShipNavy=Class.create(Command,{stepRight:function(){this.ship.stepRight()},stepLeft:function(){this.ship.stepLeft()},attack:function(){this.weapon.addBulletBezierAuto()},attack1:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?660:30)},attack2:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?570:120)},attack3:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?480:210)},attack4:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?390:300)},attack5:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?300:390)},attack6:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?210:480)},attack7:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?120:570)},attack8:function(){this.weapon.addBulletBezierManual(this.ship.isEnemy?30:660)}}),CommandShipRed=Class.create(Command,{stepRight:function(){this.ship.stepRight()},stepLeft:function(){this.ship.stepLeft()},avoid:function(){this.ship.avoid()},barrier:function(){this.ship.barrier()},attack:function(){this.ship.iField&&this.ship.iField.isActive||this.weapon.addBulletHoming()},funnel:function(){this.weapon.addFunnelCircle()}}),CommandShipWhite=Class.create(Command,{stepRight:function(){this.ship.stepRight()},stepLeft:function(){this.ship.stepLeft()},wait:Prototype.emptyFunction,attack:function(){this.weapon.addBulletLinear()},funnel:function(){this.weapon.addFunnelSlider()},megaCannon:function(){this.weapon.fireMegaCannon()}}),ShipBuilderNavy=Class.create(ShipBuilder,{buildShip:function(){var ship=new ShipNavy(this.isEnemy);return this.isEnemy||(ship.setSoundHit(this.sounds.hit),ship.setSoundLose(this.sounds.lose)),ship},buildWeapon:function(ship,enemy){var weapon=new Weapon(ship,enemy);return this.isEnemy?weapon:(weapon.setSoundAttack(this.sounds.attack),weapon)},buildAction:function(){return new ActionShipNavy},buildAI:function(ship,enemy,enemyWeapon){return new AIShipNavy(ship,enemy,enemyWeapon)},buildCommand:function(ship,weapon){return new CommandShipNavy(ship,weapon)}}),ShipBuilderRed=Class.create(ShipBuilder,{buildShip:function(){var ship=new ShipRed(this.isEnemy);return this.isEnemy||(ship.setSoundHit(this.sounds.hit),ship.setSoundLose(this.sounds.lose),ship.setSoundNewtype(this.sounds.newtype)),ship},buildWeapon:function(ship,enemy){var weapon=new Weapon(ship,enemy);return this.isEnemy?weapon.addIField():weapon.addIField(this.sounds.iField),weapon.addFunnelDefences(),this.isEnemy?weapon:(weapon.setSoundAttack(this.sounds.attack),weapon.setSoundFunnelGo(this.sounds.funnelGo),weapon.setSoundFunnelAttack(this.sounds.funnelAtk),weapon)},buildAction:function(){return new ActionShipRed},buildAI:function(ship,enemy,enemyWeapon){return new AIShipRed(ship,enemy,enemyWeapon)},buildCommand:function(ship,weapon){return new CommandShipRed(ship,weapon)}}),ShipBuilderWhite=Class.create(ShipBuilder,{buildShip:function(){var ship=new ShipWhite(this.isEnemy);return this.isEnemy||(ship.setSoundHit(this.sounds.hit),ship.setSoundLose(this.sounds.lose)),ship},buildWeapon:function(ship,enemy){var weapon=new Weapon(ship,enemy);return weapon.addWeaponWaitStatusMegaCannon(),this.isEnemy?weapon:(weapon.setSoundAttack(this.sounds.attack),weapon.setSoundMegaCannon(this.sounds.megaCannon),weapon.setSoundFunnelGo(this.sounds.funnelGo),weapon.setSoundFunnelAttack(this.sounds.funnelAtk),weapon)},buildAction:function(){return new ActionShipWhite},buildAI:function(ship,enemy,enemyWeapon){return new AIShipWhite(ship,enemy,enemyWeapon)},buildCommand:function(ship,weapon){return new CommandShipWhite(ship,weapon)}}),ShipFactory={};ShipFactory.getBuilderAsShip=function(color,sounds){return new(window["ShipBuilder"+color.capitalize()])(sounds,!1)},ShipFactory.getBuilderAsEnemy=function(color,sounds){return new(window["ShipBuilder"+color.capitalize()])(sounds,!0)},function(global){"use strict";global.DuelShootingDemo=global.Class.create(global.DuelShooting,{initialize:function($super,audioPath){$super(audioPath),this.setupMainObjects(),this.game=new global.Game(this.routine.bind(this)),this.renderInitialElements(),this.start.bind(this).delay(3)},setupMainObjects:function(){var colors=this.getShipColors(),shipBuilder=this.getShipBuilder(colors.ship,this.sounds),enemyBuilder=this.getEnemyBuilder(colors.enemy,this.sounds);this.ships.ship=shipBuilder.buildShip(),this.ships.enemy=enemyBuilder.buildShip(),this.weapons.ship=shipBuilder.buildWeapon(this.ships.ship,this.ships.enemy),this.weapons.enemy=enemyBuilder.buildWeapon(this.ships.enemy,this.ships.ship),this.cmds.ship=shipBuilder.buildCommand(this.ships.ship,this.weapons.ship),this.cmds.enemy=enemyBuilder.buildCommand(this.ships.enemy,this.weapons.enemy),this.actions.ship=shipBuilder.buildAI(this.ships.ship,this.ships.enemy,this.weapons.enemy),this.actions.enemy=enemyBuilder.buildAI(this.ships.enemy,this.ships.ship,this.weapons.ship)},renderInitialElements:function(){this.background.renderElement(),this.condition.renderElement(),this.timeKeeper.renderElement(),this.ships.ship.renderElement(),this.ships.enemy.renderElement()},beforeStart:function(){this.opening.hide()},afterRoutine:function(){this.ships.ship.nextCmd=this.actions.ship.getCommand(),this.ships.enemy.nextCmd=this.actions.enemy.getCommand(),this.cmds.ship.execute(this.actions.ship.getCommand()),this.cmds.enemy.execute(this.actions.enemy.getCommand())}})}(window),function(global){"use strict";global.DuelShootingOffline=global.Class.create(global.DuelShooting,{initialize:function($super,audioPath){$super(audioPath),this.setupMainObjects(),this.game=new global.Game(this.routine.bind(this)),this.renderInitialElements(),this.start.bind(this).delay(3)},setupMainObjects:function(){var colors=this.getShipColors(),shipBuilder=this.getShipBuilder(colors.ship,this.sounds),enemyBuilder=this.getEnemyBuilder(colors.enemy,this.sounds);this.ships.ship=shipBuilder.buildShip(),this.ships.enemy=enemyBuilder.buildShip(),this.weapons.ship=shipBuilder.buildWeapon(this.ships.ship,this.ships.enemy),this.weapons.enemy=enemyBuilder.buildWeapon(this.ships.enemy,this.ships.ship),this.cmds.ship=shipBuilder.buildCommand(this.ships.ship,this.weapons.ship),this.cmds.enemy=enemyBuilder.buildCommand(this.ships.enemy,this.weapons.enemy),this.actions.ship=shipBuilder.buildAction(),this.actions.enemy=enemyBuilder.buildAI(this.ships.enemy,this.ships.ship,this.weapons.ship)},renderInitialElements:function(){this.background.renderElement(),this.condition.renderElement(),this.timeKeeper.renderElement(),this.ships.ship.renderElement(),this.ships.enemy.renderElement()},beforeStart:function(){this.opening.hide()},afterRoutine:function(){var shipCmd=this.actions.ship.getCommand(),enemyCmd=this.actions.enemy.getCommand();this.ships.ship.nextCmd=shipCmd,this.ships.enemy.nextCmd=enemyCmd,this.cmds.ship.execute(shipCmd),this.cmds.enemy.execute(enemyCmd),this.actions.ship.resetCommand(),this.actions.enemy.resetCommand()}})}(window),function(global){"use strict";global.DuelShootingOnline=global.Class.create(global.DuelShooting,{sync:null,initialize:function($super,audioPath){$super(audioPath),this.condition.renderElement(),this.condition.update("Please wait for player matching.","#99FF99"),this.sync=new global.Synchronizer("/",this.start.bind(this),this.stop.bind(this))},setupMainObjects:function(data){var shipBuilder=this.getShipBuilder(data.ship,this.sounds),enemyBuilder=this.getEnemyBuilder(data.enemy,this.sounds);this.ships.ship=shipBuilder.buildShip(),this.ships.enemy=enemyBuilder.buildShip(),this.weapons.ship=shipBuilder.buildWeapon(this.ships.ship,this.ships.enemy),this.weapons.enemy=enemyBuilder.buildWeapon(this.ships.enemy,this.ships.ship),this.cmds.ship=shipBuilder.buildCommand(this.ships.ship,this.weapons.ship),this.cmds.enemy=enemyBuilder.buildCommand(this.ships.enemy,this.weapons.enemy),this.actions.ship=shipBuilder.buildAction()},renderInitialElements:function(){this.background.renderElement(),this.timeKeeper.renderElement(),this.ships.ship.renderElement(),this.ships.enemy.renderElement()},beforeRoutine:function(){this.sync.chat.move()},onEnemyDown:global.Prototype.emptyFunction,afterRoutine:function(){var shipCmd=this.actions.ship.getCommand();this.actions.ship.resetCommand(),this.sync.pushAttackInfo(shipCmd)},beforeStart:function(data){var type;this.setupMainObjects(data),this.sync.setShipAndCommand(data.ship,this.ships.ship,this.cmds.ship),this.sync.setShipAndCommand(data.enemy,this.ships.enemy,this.cmds.enemy),this.sync.listenShipCommand(),"red"!==data.ship&&"red"!==data.enemy||(type="red"===data.ship?"ship":"enemy",this.sync.setShipRedWeapon(this.weapons[type])),this.game=new global.Game(this.routine.bind(this)),this.renderInitialElements()},start:function(data){this.beforeStart(data),this.game.start(),this.timeKeeper.start(),this.afterStart()},afterStart:function(){this.condition.updateAndDelayHide("Engaged!","#FF9999"),this.opening.hide()},afterStop:function(){this.sync.stop()}})}(window),function(global){"use strict";global.Game=global.Class.create({INTERVAL_WAIT_MSEC:16,timerId:null,routine:null,initialize:function(routine){this.routine=routine},start:function(){null===this.timerId&&(this.timerId=setInterval(this.routine,this.INTERVAL_WAIT_MSEC))},pause:function(){null===this.timerId?this.start():this.stop()},stop:function(){clearInterval(this.timerId),this.timerId=null}})}(window);var Sound=Class.create({hasAudioElement:null,initialize:function(){this.hasAudioElement=this.checkAudio(),this.addAudioMethods()},checkAudio:function(){var canPlayMpeg="function"==typeof Audio&&"HTMLAudioElement"==Audio.name&&"function"==typeof Audio.prototype.canPlayType&&(new Audio).canPlayType("audio/mpeg");return"probably"==canPlayMpeg||"maybe"==canPlayMpeg},addAudioMethods:function(){this.hasAudioElement&&Element.addMethods("audio",{stop:function(audio){try{audio.currentTime=0}catch(e){console&&console.log(e)}},replay:function(audio){try{audio.currentTime=0,audio.play()}catch(e){console&&console.log(e)}}})},createAudio:function(src){if(this.hasAudioElement){var audio=new Element("audio",{src:src});return Prototype.Browser.MobileSafari&&audio.load(),audio}return null}}),Background=Class.create(Sprite,{createElement:function(){return new Element("div").setStyle({display:"block",position:"fixed",zIndex:this.Z_INDEX_BASE,backgroundColor:"#333333",height:this.clientHeight+"px",width:this.clientWidth+"px",borderRight:"solid 1px #AAAAAA",borderBottom:"solid 1px #AAAAAA"}).setOpacity(.8)},resetPosition:function($super){$super(),this.elm.setStyle({height:this.clientHeight+"px",width:this.clientWidth+"px"})}}),BulletBezier=Class.create(Bullet,{ATTAINABLE_COUNT:40,pos:null,leftRange:null,topRange:null,count:null,initialize:function($super,ship,enemy,left){$super(ship,enemy),this.pos={ship:{top:ship.getTop()+(this.isFall?60:-30),left:ship.getLeft()+30},enemy:{top:enemy.getTop()+(this.isFall?-30:60),left:left}},this.leftRange=-(this.pos.ship.left-this.pos.enemy.left)/this.ATTAINABLE_COUNT,this.topRange=-(this.pos.ship.top-this.pos.enemy.top)/this.ATTAINABLE_COUNT,this.count=0},getColor:function(){return"#FFFF33"},move:function(){if(++this.count,this.enemy.isHit(this,this.topRange))return this.isDelete=!0,void this.elm.remove();var left=this.pos.ship.left+this.leftRange*this.count;this.setPos({top:this.pos.ship.top+this.topRange*this.count*this.count/this.ATTAINABLE_COUNT,left:left+(this.pos.enemy.left-left)*this.count/this.ATTAINABLE_COUNT})}}),BulletHoming=Class.create(Bullet,{getColor:function(){return"#FF55FF"},move:function(){var range=this.isFall?5:-5;if(this.enemy.isHit(this,range))return this.isDelete=!0,void this.elm.remove();var top=this.getTop(),left=this.getLeft(),enemyLeft=this.enemy.getLeft();(this.isFall?this.clientHeight/2<top:this.clientHeight/2>top)?(range*=3,distance=0):distance=left<enemyLeft?10:enemyLeft+60<left?-10:0,this.setPos({top:top+range,left:left+distance})}}),BulletLinear=Class.create(Bullet,{getColor:function(){return"#55FF55"},move:function(){var range=this.isFall?10:-10;if(this.enemy.isHit(this,range))return this.isDelete=!0,void this.elm.remove();this.setTop(this.getTop()+range)}}),ChatForm=Class.create(Sprite,{textField:null,createElement:function(){var form=new Element("form",{action:"#",method:"post"}).setStyle({zIndex:this.Z_INDEX_BASE+2e3,position:"fixed",backgroundColor:"#EFEFEF"});this.textField=new Element("input",{type:"text",value:""}).setStyle({width:"400px"});var button=new Element("input",{type:"submit",value:"send"});return form.insert(this.textField).insert(button),form},getInitTop:function(){return this.clientHeight+10},getInitLeft:function(){return 270},getValue:function(){return $F(this.textField)}}),Condition=Class.create(Sprite,{timerId:null,createElement:function(){return new Element("div").setStyle({display:"none",position:"fixed",zIndex:this.Z_INDEX_BASE+101,fontSize:"20px",fontWeight:800,top:"0px",left:"0px"})},setupPosition:function(){var dim=this.elm.getDimensions();this.elm.setStyle({display:"block",top:this.clientHeight/2-(dim.height/2-0)+100+"px",left:this.clientWidth/2-(dim.width/2-0)+"px"})},update:function(text,color){this.timerId&&clearTimeout(this.timerId),this.elm.update(text),this.elm.setStyle({color:color}),this.setupPosition(),this.elm.show()},updateAndDelayHide:function(text,color){this.update(text,color),this.timerId=this.elm.hide.bind(this.elm).delay(7)}}),DuelistCounter=Class.create(Sprite,{createElement:function(){return new Element("div").setStyle({position:"fixed",zIndex:this.Z_INDEX_BASE,fontSize:"20px",fontWeight:800})},getInitTop:function(){return this.clientHeight+10},getInitLeft:function(){return 10},update:function(text){this.elm.update(text),this.remove(),this.renderElement()}}),ForkMeOnGitHub=Class.create(Sprite,{createElement:function(){return new Element("img",{src:"https://s3.amazonaws.com/github/ribbons/forkme_left_white_ffffff.png",alt:"Fork me on GitHub"}).setStyle({border:"none"}).wrap(new Element("a",{href:"https://github.com/supercaracal/duelshooting_online"})).setStyle({position:"fixed",zIndex:this.Z_INDEX_BASE+4e3})},getInitTop:function(){return 0},getInitLeft:function(){return 0}}),FunnelCircle=Class.create(Funnel,{r:null,theta:null,speed:null,isClockwise:null,initialize:function($super,carrier){$super(carrier),this.r=70,this.theta=this.isEnemy?0:180,this.speed=3,this.isCloclwise=this.isEnemy},getInitTop:function(){return this.carrier.getTop()+(this.isEnemy?60:-30)},getInitLeft:function(){return this.carrier.getLeft()+30},getColor:function(){return"#FF9900"},move:function(){var y=this.initLeft+Math.sin(Math.PI/180*this.theta)*this.r,x=this.initTop+(this.isEnemy?0:-140)+this.r-Math.cos(Math.PI/180*this.theta)*this.r;this.setPos({top:x,left:y}),this.theta+=this.isClockwise?this.speed:-this.speed,(this.theta<0||360<this.theta)&&(this.theta=this.isClockwise?0:360)}}),FunnelDefenceLeft=Class.create(Funnel,{iField:null,initialize:function($super,carrier,iField){this.iField=iField,$super(carrier),this.setTransformRotate(this.getInitTransformRotate())},getInitTop:function(){return this.carrier.getTop()+(this.isEnemy?60:-30)},getInitLeft:function(){return this.carrier.getLeft()-40},getInitTransformRotate:function(){return 135},getColor:function(){return"#FF9900"},move:function(){if(this.iField.isActive)this.setTransformRotate(this.isEnemy?270:90);else{var deg=this.getTransformRotate();deg=deg>360?0:deg,this.setTransformRotate(++deg)}this.setPos({top:this.getInitTop(),left:this.getInitLeft()})}}),FunnelDefenceRight=Class.create(Funnel,{iField:null,initialize:function($super,carrier,iField){this.iField=iField,$super(carrier),this.setTransformRotate(this.getInitTransformRotate())},getInitTop:function(){return this.carrier.getTop()+(this.isEnemy?60:-30)},getInitLeft:function(){return this.carrier.getLeft()+100},getInitTransformRotate:function(){return 225},getColor:function(){return"#FF9900"},move:function(){if(this.iField.isActive)this.setTransformRotate(this.isEnemy?90:270);else{var deg=this.getTransformRotate();deg=deg<0?360:deg,this.setTransformRotate(--deg)}this.setPos({top:this.getInitTop(),left:this.getInitLeft()})}}),FunnelSlider=Class.create(Funnel,{target:null,isComeback:null,isFunnelSliderAttack:null,isFunnelSlider:null,initialize:function($super,carrier,target){this.isComeback=!1,this.isFunnelSliderAttack=!1,this.isFunnelSlider=!0,this.target=target,$super(carrier)},getInitTop:function(){return this.carrier.getTop()+(this.isEnemy?60:-30)},getInitLeft:function(){return this.carrier.getLeft()+30},getColor:function(){return"#9999FF"},move:function(){this.isComeback?this.moveComeback():this.moveChase()},moveComeback:function(){var shipCenterLeft=this.carrier.getLeft()+30,left=this.getLeft();if(Math.abs(shipCenterLeft-left)<30)return this.isDelete=!0,void this.elm.remove();this.setLeft(left+(shipCenterLeft-left>0?10:-10))},moveChase:function(){var enemyCenterLeft=this.target.getLeft()+30,left=this.getLeft();if(Math.abs(enemyCenterLeft-left)<30)return this.isComeback=!0,void(this.isFunnelSliderAttack=!0);this.setLeft(left+(enemyCenterLeft-left>0?10:-10))}}),IField=Class.create(Sprite,{WAIT:250,isActive:null,carrier:null,isEnemy:null,waitCount:null,sound:null,waitStatus:null,initialize:function($super,carrier){this.isActive=!1,this.carrier=carrier,this.isEnemy=carrier.isEnemy,this.waitCount=0,$super(),this.carrier.setIField(this)},createElement:function(){return new Element("div").setStyle({width:"100px",height:"20px",backgroundColor:"#FFFFFF",zIndex:this.Z_INDEX_BASE+11,position:"fixed",boxShadow:"0px 0px 10px #FFFFFF",borderRadius:"10px",display:"none"}).setOpacity(.5)},getInitTop:function(){return this.carrier.getTop()+(this.isEnemy?65:-25)},getInitLeft:function(){return this.carrier.getLeft()-5},getHeight:function(){return this.elm.getHeight()},setHeight:function(h){this.elm.setStyle({height:h+"px"}),this.setTop(this.getInitTop()+(20-h)/2)},setSound:function(audio){this.sound=audio},setWaitStatus:function(waitStatus){this.waitStatus=waitStatus},playSound:function(){this.sound&&this.sound.replay()},hit:function(){h=this.getHeight(),h-=2,this.setHeight(h),h<=0&&(this.cancel(),this.waitCount=this.WAIT)},isHit:function(bullet,range,enemyLeft){var top=bullet.getTop(),left=bullet.getLeft();if(this.isActive&&(bullet.isFall?top+range>this.clientHeight-110:top+range<80)&&enemyLeft-25<left&&left<enemyLeft+95)return this.hit(),!0},barrier:function(){0<this.waitCount||this.isActive||(this.setHeight(20),this.invoke(),this.playSound())},invoke:function(){this.isActive=!0,this.elm.show()},cancel:function(){this.isActive=!1,this.elm.hide()},move:function(){this.setLeft(this.carrier.getLeft()-5),this.isActive&&this.changeColor(),0<this.waitCount&&--this.waitCount,this.waitStatus.setWidth(this.waitCount,this.WAIT)},changeColor:function(){var color="#"+Math.floor(100*Math.random()).toColorPart()+Math.floor(100*Math.random()).toColorPart()+Math.floor(100*Math.random()).toColorPart();this.elm.setStyle({backgroundColor:color})}}),NicoNico=Class.create(Sprite,{text:null,dim:null,seed:null,initialize:function($super,text){this.text=text,this.seed=this.getSeed(),$super()},createElement:function(){return new Element("span").setStyle({color:this.getColor(),fontSize:this.getSeed()+8+"px",fontWeight:"bolder",zIndex:this.Z_INDEX_BASE+1e3+this.getSeed()+1,position:"fixed",whiteSpace:"nowrap"}).update(this.text)},getInitTop:function(){return Math.floor(this.clientHeight*(this.getSeed()/100))},getInitLeft:function(){return document.viewport.getWidth()||document.documentElement.clientWidth||document.body.clientWidth||document.body.scrollWidth||this.clientWidth},renderElement:function($super){$super(),this.dim=this.elm.getDimensions(),this.clientHeight<this.getTop()+this.dim.height&&this.setTop(this.clientHeight-this.dim.height)},move:function(){var x=this.getLeft();if(x<-this.dim.width)return this.isDelete=!0,void this.remove();x-=this.seed%10+5,this.setLeft(x)},getSeed:function(){return Math.floor(100*Math.random())},getColor:function(){var color=null,changePos=this.getSeed()%6,changeVal=this.getSeed()%16,hexs={0:"0F",1:"1F",2:"2F",3:"3F",4:"4F",5:"5F",6:"6F",7:"7F",8:"8F",9:"9F",10:"AF",11:"BF",12:"CF",13:"DF",14:"EF",15:"FF"};switch(changePos){case 0:color="#"+hexs[changeVal]+"FFFF";break;case 1:color="#FF"+hexs[changeVal]+"FF";break;case 2:color="#FFFF"+hexs[changeVal];break;case 3:color="#"+hexs[changeVal]+hexs[changeVal]+"FF";break;case 4:color="#"+hexs[changeVal]+"FF"+hexs[changeVal];break;case 5:color="#FF"+hexs[changeVal]+hexs[changeVal];break;default:color="#FFFFFF"}return color}}),Opening=Class.create(Sprite,{timerId:null,title:null,titleOpacity:0,backgroundOpacity:1,initialize:function($super,title){this.title=title,$super()},createElement:function(){return new Element("div").setStyle({display:"block",position:"fixed",zIndex:this.Z_INDEX_BASE+100,backgroundColor:"#111111",height:this.clientHeight+"px",width:this.clientWidth+"px"}).setOpacity(this.backgroundOpacity)},show:function(){this.title.renderElement(),this.renderElement(),this.timerId=setInterval(this.appear.bind(this),128)},appear:function(){this.titleOpacity>=1&&clearInterval(this.timerId),this.titleOpacity+=.1,this.title.setOpacity(this.titleOpacity)},hide:function(){clearInterval(this.timerId),this.title.remove(),this.timerId=setInterval(this.fade.bind(this),32)},fade:function(){this.backgroundOpacity<=0&&(clearInterval(this.timerId),this.elm.remove()),this.backgroundOpacity-=.1,this.elm.setOpacity(this.backgroundOpacity)}}),ShipAfterimage=Class.create(Ship,{getColor:function(){return"#FF5555"},spot:function(top,left,hitPoint){this.elm.setOpacity(.2),this.setPos({top:top,left:left}),this.setHitPoint(hitPoint),this.renderElement(),function(){this.elm.remove()}.bind(this).delay(.3)}}),ShipNavy=Class.create(Ship,{shadowSize:20,colors:["FF0000","FF6600","FFFF00","00FF00","00FFFF","0000FF","990099"],getColor:function(){return"#0F0F3F"},createElement:function($super){return $super().setStyle({color:"#FFFFFF"})},move:function($super){$super(),++this.shadowSize;var color="#"+this.colors[0];this.elm.down().setStyle({boxShadow:"0px 0px "+this.shadowSize+"px "+color}),this.elm.down(1).setStyle({boxShadow:"0px 0px "+this.shadowSize+"px "+color}),50<this.shadowSize&&(this.shadowSize=20,this.colors.push(this.colors.shift()))}}),ShipRed=Class.create(Ship,{soundNewtype:null,iField:null,funnels:null,initialize:function($super,isEnemy){$super(isEnemy),this.funnels=[]},getColor:function(){return"#FF5555"},setSoundNewtype:function(audio){this.soundNewtype=audio},playSoundNewtype:function(){this.soundNewtype&&this.soundNewtype.replay()},setIField:function(iField){this.iField=iField},getIField:function(){return this.iField},getIFieldInfo:function(){return{isActive:this.iField.isActive,height:this.iField.getHeight()}},getFunnelInfo:function(){return{firstLeft:this.funnels[0]?this.funnels[0].initLeft:null,firstTheta:this.funnels[0]?this.funnels[0].theta:null,secondLeft:this.funnels[1]?this.funnels[1].initLeft:null,secondTheta:this.funnels[1]?this.funnels[1].theta:null}},addFunnel:function(funnel){this.funnels.push(funnel)},isIFieldEnable:function(){return!this.iField.isActive&&!this.iField.waitCount},barrier:function(){this.iField.barrier()},avoid:function(){var sign=this.getLeft()+45<this.clientWidth/2?1:-1,top=this.getTop(),left=this.getLeft();this.setLeft(left+90*sign),[left,left+30*sign,left+60*sign].each(function(left){new ShipAfterimage(this.isEnemy).spot(top,left,this.hitPoint)}.bind(this)),this.playSoundNewtype()}}),ShipWhite=Class.create(Ship,{isMegaCannonEnabled:!0,isNotFunnelEmpty:!0,getColor:function(){return"#FFFFFF"},enableMegaCannonStatus:function(){this.isMegaCannonEnabled=!0},disableMegaCannonStatus:function(){this.isMegaCannonEnabled=!1},enableFunnelStatus:function(){this.isNotFunnelEmpty=!0},disableFunnelStatus:function(){this.isNotFunnelEmpty=!1}}),TimeKeeper=Class.create(Sprite,{timerId:null,time:null,initialize:function($super){this.time=0,$super()},createElement:function(){return new Element("div").setStyle({zIndex:this.Z_INDEX_BASE+20,position:"fixed",height:"30px",width:"100px",fontSize:"20px",fontWeight:800,color:"#FFFFFF",textAlign:"right"}).update(this.time)},getInitTop:function(){return 2},getInitLeft:function(){return this.clientWidth-110},increment:function(){this.elm.update(++this.time)},start:function(){null===this.timerId&&(this.timerId=setInterval(this.increment.bind(this),1e3))},stop:function(){clearInterval(this.timerId),this.timerId=null}}),Title=Class.create(Sprite,{TITLE_TEXT:"Duel Shooting",createElement:function(){return new Element("div").setStyle({display:"none",position:"fixed",zIndex:this.Z_INDEX_BASE+101,fontSize:"36px",color:"#FFFFFF",top:"0px",left:"0px"}).update(this.TITLE_TEXT).setOpacity(0)},setupPosition:function(){this.renderElement();var dim=this.elm.getDimensions();this.elm.setStyle({display:"block",top:this.clientHeight/2-(dim.height/2-0)+"px",left:this.clientWidth/2-(dim.width/2-0)+"px"}),this.remove()}}),WeaponWaitStatusIField=Class.create(WeaponWaitStatus,{getColor:function(){return"#99FF00"}}),WeaponWaitStatusMegaCannon=Class.create(WeaponWaitStatus,{isWeaponWaitStatusMegaCannon:!0}),Synchronizer=Class.create({socket:null,controlShip:null,ships:null,cmds:null,weapons:null,chat:null,duelistCounter:null,chatForm:null,initialize:function(uri,callback,finish){this.ships={},this.cmds={},this.weapons={},this.chat=new Chat,this.duelistCounter=new DuelistCounter,this.duelistCounter.renderElement(),this.chatForm=new ChatForm,this.chatForm.renderElement(),this.socket=io.connect(uri),this.setupChatEvent(),this.listenShipControl(),this.listenDuelReady(callback),this.listenYouWin(finish),this.listenDuelistCount(),this.socket.emit("duty",{})},setupChatEvent:function(){this.chatForm.elm.observe("submit",function(e){e.stop();var v=this.chatForm.getValue();v&&this.socket.emit("chat",v)}.bindAsEventListener(this)),this.socket.on("chat",function(data){this.chat.add(data)}.bind(this))},listenShipControl:function(){this.socket.on("You have control",this.youHaveControl.bind(this)),this.socket.on("You have no control",this.youHaveNoControl.bind(this))},listenDuelReady:function(callback){this.socket.on("ready",callback)},listenYouWin:function(finish){this.socket.on("You win",finish)},listenDuelistCount:function(){this.socket.on("duelist count",this.updateDuelistCount.bind(this))},listenShipCommand:function(){this.socket.on("attack",this.attack.bind(this))},youHaveControl:function(data){this.controlShip=data.ship,this.socket.emit("I have control",{ship:this.controlShip}),"undefined"!=typeof console&&console.log("I have control: "+this.controlShip)},youHaveNoControl:function(data){(function(){this.socket.emit("duty",{})}).bind(this).delay(5)},updateDuelistCount:function(cnt){this.duelistCounter.update("Duelists: "+cnt)},attack:function(data){this.cmds[data.color]&&(data.color!=this.controlShip&&this.critical(data),this.ships[data.color].nextCmd=data.cmd,this.cmds[data.color].execute(data.cmd))},critical:function(data){var methodName="critical"+data.color.capitalize();this[methodName in this?methodName:"criticalDefault"](data)},criticalDefault:function(data){this.ships[data.color]&&(this.ships[data.color].setHitPoint(data.hp),"stepRight"!==this.ships[data.color].nextCmd&&"stepLeft"!==this.ships[data.color].nextCmd&&this.ships[data.color].setLeft(this.ships[data.color].clientWidth-data.left-90))},criticalRed:function(data){if(this.ships.red&&(this.ships.red.setHitPoint(data.hp),"stepRight"!==this.ships.red.nextCmd&&"stepLeft"!==this.ships.red.nextCmd&&this.ships.red.setLeft(this.ships.red.clientWidth-data.left-90),data.iField.isActive?(this.ships.red.iField.setHeight(data.iField.height),this.ships.red.iField.invoke()):this.ships.red.iField.cancel(),this.weapons.red)){null===data.funnel.firstLeft&&null===data.funnel.secondLeft&&this.weapons.red.removeFunnelCircle(2),null!==data.funnel.firstLeft&&null===data.funnel.secondLeft&&2===this.weapons.red.funnelCircles.size()&&this.weapons.red.removeFunnelCircle(1);var left;null!==data.funnel.firstLeft&&(0===this.weapons.red.funnelCircles.size()&&this.weapons.red.addFunnelCircle(),(left=this.ships.red.clientWidth-data.funnel.firstLeft-30)!==this.ships.red.funnels[0].initLeft&&(this.ships.red.funnels[0].initLeft=left),this.ships.red.funnels[0].theta=data.funnel.firstTheta),null!==data.funnel.secondLeft&&(1===this.weapons.red.funnelCircles.size()&&this.weapons.red.addFunnelCircle(),(left=this.ships.red.clientWidth-data.funnel.secondLeft-30)!==this.ships.red.funnels[1].initLeft&&(this.ships.red.funnels[1].initLeft=left),this.ships.red.funnels[1].theta=data.funnel.secondTheta)}},pushAttackInfo:function(cmd){if(cmd){var data={color:this.controlShip,cmd:cmd,hp:this.ships[this.controlShip].getHitPoint(),left:this.ships[this.controlShip].getLeft()};"red"==this.controlShip&&(data.iField=this.ships.red.getIFieldInfo(),data.funnel=this.ships.red.getFunnelInfo()),this.socket.emit("attack",data)}},setShipAndCommand:function(color,ship,cmd){this.ships[color]=ship,this.cmds[color]=cmd},setShipRedWeapon:function(weapon){this.weapons.red=weapon},stop:function(){this.socket.disconnect(),this.chatForm.elm.disable(),this.chatForm.elm.stopObserving("submit")}}),Chat=Class.create({elms:null,initialize:function(){this.elms=[]},add:function(text){var elm=new NicoNico(text);elm.renderElement(),this.elms.push(elm)},move:function(){for(var i=0,len=this.elms.size();i<len;i++)this.elms[i].move(),this.elms[i].isDelete&&(this.elms[i]=null);this.elms=this.elms.compact()}}),Weapon=Class.create({FUNNEL_SLIDER_MAX:5,FUNNEL_CIRCLE_MAX:2,MEGA_CANNON_WAIT:250,MEGA_CANNON_HEIGHT:29,ship:null,enemy:null,funnelSliderCount:null,funnelCircles:null,megaCannonWaitCount:null,megaCannonHeightCount:null,soundFunnelGo:null,soundFunnelAttack:null,soundAttack:null,soundMegaCannon:null,elms:null,initialize:function(ship,enemy){this.ship=ship,this.enemy=enemy,this.funnelSliderCount=0,this.funnelCircles=[],this.megaCannonWaitCount=0,this.megaCannonHeightCount=0,this.elms=[]},move:function(){0<this.megaCannonWaitCount&&(--this.megaCannonWaitCount||this.ship.enableMegaCannonStatus()),0<this.megaCannonHeightCount&&(this.megaCannonHeightCount%3==0&&this.addBulletLinearFromMegaCannon(),--this.megaCannonHeightCount),this.funnelCircles.each(function(x){x.move()});for(var i=0,len=this.elms.size();i<len;i++)this.elms[i].move(),this.elms[i].isFunnelSliderAttack&&(this.addBulletLinearFromFunnel(this.elms[i].getLeft()),this.elms[i].isFunnelSliderAttack=!1),this.elms[i].isWeaponWaitStatusMegaCannon&&this.elms[i].setWidth(this.megaCannonWaitCount,this.MEGA_CANNON_WAIT),this.elms[i].isFunnelSlider&&(this.funnelSliderCount<=this.FUNNEL_SLIDER_MAX?this.ship.enableFunnelStatus():this.ship.disableFunnelStatus()),this.elms[i].isDelete&&(this.elms[i].isFunnelSlider&&--this.funnelSliderCount,this.elms[i]=null);this.elms=this.elms.compact()},setSoundFunnelGo:function(audio){this.soundFunnelGo=audio},setSoundFunnelAttack:function(audio){this.soundFunnelAttack=audio},setSoundAttack:function(audio){this.soundAttack=audio},setSoundMegaCannon:function(audio){this.soundMegaCannon=audio},playSoundFunnelGo:function(audio){this.soundFunnelGo&&this.soundFunnelGo.replay()},playSoundFunnelAttack:function(){this.soundFunnelAttack&&this.soundFunnelAttack.replay()},playSoundAttack:function(){this.soundAttack&&this.soundAttack.replay()},playSoundMegaCannon:function(){this.soundMegaCannon&&this.soundMegaCannon.replay()},addBulletLinear:function(){var elm=new BulletLinear(this.ship,this.enemy);this.elms.push(elm),elm.renderElement(),this.playSoundAttack()},addBulletHoming:function(){var elm=new BulletHoming(this.ship,this.enemy);this.elms.push(elm),elm.renderElement(),this.playSoundAttack()},addBulletBezierAuto:function(){var enemyLeft=this.enemy.getLeft(),elmL=new BulletBezier(this.ship,this.enemy,enemyLeft-60),elmC=new BulletBezier(this.ship,this.enemy,enemyLeft+30),elmR=new BulletBezier(this.ship,this.enemy,enemyLeft+120);this.elms.push(elmL),this.elms.push(elmC),this.elms.push(elmR),elmL.renderElement(),elmC.renderElement(),elmR.renderElement(),this.playSoundAttack()},addBulletBezierManual:function(left){var elm=new BulletBezier(this.ship,this.enemy,left);this.elms.push(elm),elm.renderElement(),this.playSoundAttack()},addBulletLinearFromFunnel:function(left){var elm=new BulletLinear(this.ship,this.enemy);elm.setPos({top:this.ship.isEnemy?90:elm.clientHeight-120,left:left}),this.elms.push(elm),elm.renderElement(),this.playSoundFunnelAttack()},addBulletLinearFromMegaCannon:function(){var elmL=new BulletLinear(this.ship,this.enemy),elmM=new BulletLinear(this.ship,this.enemy),elmR=new BulletLinear(this.ship,this.enemy);elmL.setPos({top:this.ship.isEnemy?60:this.ship.clientHeight-90,left:this.ship.getLeft()}),elmM.setPos({top:this.ship.isEnemy?60:this.ship.clientHeight-90,left:this.ship.getLeft()+30}),elmR.setPos({top:this.ship.isEnemy?60:this.ship.clientHeight-90,left:this.ship.getLeft()+60}),this.elms.push(elmL),this.elms.push(elmM),this.elms.push(elmR),elmL.renderElement(),elmM.renderElement(),elmR.renderElement()},addBulletHomingFromFunnel:function(top,left){var elm=new BulletHoming(this.ship,this.enemy);elm.setPos({top:top,left:left}),this.elms.push(elm),elm.renderElement()},addFunnelSlider:function(){if(!(this.FUNNEL_SLIDER_MAX<=this.funnelSliderCount)){var elm=new FunnelSlider(this.ship,this.enemy);this.elms.push(elm),++this.funnelSliderCount,elm.renderElement(),this.playSoundFunnelGo()}},addFunnelCircle:function(){if(this.FUNNEL_CIRCLE_MAX<=this.funnelCircles.size())return this.funnelCircles.each(function(x){this.addBulletHomingFromFunnel(x.getTop()+(x.isEnemy?30:-30),x.getLeft())}.bind(this)),void this.playSoundFunnelAttack();var funnel=new FunnelCircle(this.ship);this.ship.addFunnel(funnel),this.funnelCircles.push(funnel),funnel.renderElement(),this.playSoundFunnelGo()},addIField:function(audio){var iField=new IField(this.ship),wws=new WeaponWaitStatusIField(this.ship);iField.setSound(audio),iField.setWaitStatus(wws),this.elms.push(iField),this.elms.push(wws),iField.renderElement(),wws.renderElement()},addFunnelDefences:function(){var l=new FunnelDefenceLeft(this.ship,this.ship.getIField()),r=new FunnelDefenceRight(this.ship,this.ship.getIField());this.elms.push(l),this.elms.push(r),l.renderElement(),r.renderElement()},addWeaponWaitStatusMegaCannon:function(){var wws=new WeaponWaitStatusMegaCannon(this.ship);this.elms.push(wws),wws.renderElement()},removeFunnelCircle:function(num){var elm;(elm=this.funnelCircles.shift())&&elm.remove(),this.ship.funnels.shift(),1<num&&((elm=this.funnelCircles.shift())&&elm.remove(),this.ship.funnels.shift())},fireMegaCannon:function(){0<this.megaCannonWaitCount||(this.ship.disableMegaCannonStatus(),this.megaCannonWaitCount=this.MEGA_CANNON_WAIT,this.megaCannonHeightCount=this.MEGA_CANNON_HEIGHT,this.playSoundMegaCannon())}});
//# sourceMappingURL=source.map